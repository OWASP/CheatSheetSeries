
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Website with the collection of all the cheat sheets of the project.">
      
      
      
        <link rel="canonical" href="https://cheatsheetseries.owasp.org/cheatsheets/C-Based_Toolchain_Hardening_Cheat_Sheet.html">
      
      
        <link rel="prev" href="Browser_Extension_Vulnerabilities_Cheat_Sheet.html">
      
      
        <link rel="next" href="CI_CD_Security_Cheat_Sheet.html">
      
      
      <link rel="icon" href="../assets/WebSite_Favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.42">
    
    
      
        <title>C-Based Toolchain Hardening - OWASP Cheat Sheet Series</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.0253249f.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#c-based-toolchain-hardening-cheat-sheet" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../index.html" title="OWASP Cheat Sheet Series" class="md-header__button md-logo" aria-label="OWASP Cheat Sheet Series" data-md-component="logo">
      
  <img src="../assets/OWASP_Logo.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            OWASP Cheat Sheet Series
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              C-Based Toolchain Hardening
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/OWASP/CheatSheetSeries" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    OWASP/CheatSheetSeries
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../index.html" title="OWASP Cheat Sheet Series" class="md-nav__button md-logo" aria-label="OWASP Cheat Sheet Series" data-md-component="logo">
      
  <img src="../assets/OWASP_Logo.svg" alt="logo">

    </a>
    OWASP Cheat Sheet Series
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/OWASP/CheatSheetSeries" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    OWASP/CheatSheetSeries
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../Glossary.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Index Alphabetical
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../IndexASVS.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Index ASVS
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../IndexMASVS.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Index MASVS
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../IndexProactiveControls.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Index Proactive Controls
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../IndexTopTen.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Index Top 10
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" checked>
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Cheatsheets
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Cheatsheets
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="AJAX_Security_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AJAX Security
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Abuse_Case_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Abuse Case
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Access_Control_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Access Control
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Attack_Surface_Analysis_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Attack Surface Analysis
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Authentication_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Authentication
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Authorization_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Authorization
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Authorization_Testing_Automation_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Authorization Testing Automation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Bean_Validation_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Bean Validation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Browser_Extension_Vulnerabilities_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Browser Extension Vulnerabilities
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    C-Based Toolchain Hardening
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="C-Based_Toolchain_Hardening_Cheat_Sheet.html" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    C-Based Toolchain Hardening
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    <span class="md-ellipsis">
      Introduction
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#wisdom" class="md-nav__link">
    <span class="md-ellipsis">
      Wisdom
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Configuration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#build-configurations" class="md-nav__link">
    <span class="md-ellipsis">
      Build Configurations
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Build Configurations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#debug-builds" class="md-nav__link">
    <span class="md-ellipsis">
      Debug Builds
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#release-builds" class="md-nav__link">
    <span class="md-ellipsis">
      Release Builds
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test-builds" class="md-nav__link">
    <span class="md-ellipsis">
      Test Builds
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#autotools" class="md-nav__link">
    <span class="md-ellipsis">
      Autotools
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#makefiles" class="md-nav__link">
    <span class="md-ellipsis">
      Makefiles
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#integration" class="md-nav__link">
    <span class="md-ellipsis">
      Integration
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#preprocessor" class="md-nav__link">
    <span class="md-ellipsis">
      Preprocessor
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Preprocessor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#configurations" class="md-nav__link">
    <span class="md-ellipsis">
      Configurations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#assert" class="md-nav__link">
    <span class="md-ellipsis">
      ASSERT
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#additional-macros" class="md-nav__link">
    <span class="md-ellipsis">
      Additional Macros
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#compiler-and-linker" class="md-nav__link">
    <span class="md-ellipsis">
      Compiler and Linker
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Compiler and Linker">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#distribution-hardening" class="md-nav__link">
    <span class="md-ellipsis">
      Distribution Hardening
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gccbinutils" class="md-nav__link">
    <span class="md-ellipsis">
      GCC/Binutils
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clangxcode" class="md-nav__link">
    <span class="md-ellipsis">
      Clang/Xcode
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#visual-studio" class="md-nav__link">
    <span class="md-ellipsis">
      Visual Studio
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#warning-suppression" class="md-nav__link">
    <span class="md-ellipsis">
      Warning Suppression
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#runtime" class="md-nav__link">
    <span class="md-ellipsis">
      Runtime
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Runtime">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#xcode" class="md-nav__link">
    <span class="md-ellipsis">
      Xcode
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Xcode">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#windows" class="md-nav__link">
    <span class="md-ellipsis">
      Windows
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="CI_CD_Security_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CI CD Security
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Choosing_and_Using_Security_Questions_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Choosing and Using Security Questions
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Clickjacking_Defense_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Clickjacking Defense
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Content_Security_Policy_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Content Security Policy
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Credential_Stuffing_Prevention_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Credential Stuffing Prevention
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Cross-Site_Request_Forgery_Prevention_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cross-Site Request Forgery Prevention
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Cross_Site_Scripting_Prevention_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cross Site Scripting Prevention
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Cryptographic_Storage_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cryptographic Storage
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="DOM_Clobbering_Prevention_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DOM Clobbering Prevention
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="DOM_based_XSS_Prevention_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DOM based XSS Prevention
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Database_Security_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Database Security
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Denial_of_Service_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Denial of Service
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Deserialization_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Deserialization
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Django_REST_Framework_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Django REST Framework
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Django_Security_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Django Security
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Docker_Security_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Docker Security
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="DotNet_Security_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DotNet Security
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Error_Handling_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Error Handling
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="File_Upload_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    File Upload
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Forgot_Password_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Forgot Password
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="GraphQL_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    GraphQL
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="HTML5_Security_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    HTML5 Security
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="HTTP_Headers_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    HTTP Headers
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="HTTP_Strict_Transport_Security_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    HTTP Strict Transport Security
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Infrastructure_as_Code_Security_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Infrastructure as Code Security
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Injection_Prevention_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Injection Prevention
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Injection_Prevention_in_Java_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Injection Prevention in Java
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Input_Validation_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Input Validation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Insecure_Direct_Object_Reference_Prevention_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Insecure Direct Object Reference Prevention
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="JAAS_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    JAAS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="JSON_Web_Token_for_Java_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    JSON Web Token for Java
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Java_Security_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Java Security
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Key_Management_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Key Management
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Kubernetes_Security_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Kubernetes Security
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="LDAP_Injection_Prevention_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    LDAP Injection Prevention
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Laravel_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Laravel
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Legacy_Application_Management_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Legacy Application Management
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Logging_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Logging
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Logging_Vocabulary_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Logging Vocabulary
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Mass_Assignment_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Mass Assignment
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Microservices_Security_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Microservices Security
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Microservices_based_Security_Arch_Doc_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Microservices based Security Arch Doc
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Mobile_Application_Security_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Mobile Application Security
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Multifactor_Authentication_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Multifactor Authentication
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="NPM_Security_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    NPM Security
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Network_Segmentation_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Network Segmentation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="NodeJS_Docker_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    NodeJS Docker
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Nodejs_Security_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Nodejs Security
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="OAuth2_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OAuth2
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="OS_Command_Injection_Defense_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OS Command Injection Defense
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="PHP_Configuration_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PHP Configuration
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Password_Storage_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Password Storage
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Pinning_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Pinning
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Prototype_Pollution_Prevention_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Prototype Pollution Prevention
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Query_Parameterization_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Query Parameterization
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="REST_Assessment_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    REST Assessment
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="REST_Security_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    REST Security
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Ruby_on_Rails_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Ruby on Rails
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="SAML_Security_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SAML Security
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="SQL_Injection_Prevention_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SQL Injection Prevention
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Secrets_Management_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Secrets Management
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Secure_Cloud_Architecture_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Secure Cloud Architecture
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Secure_Product_Design_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Secure Product Design
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Securing_Cascading_Style_Sheets_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Securing Cascading Style Sheets
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Server_Side_Request_Forgery_Prevention_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Server Side Request Forgery Prevention
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Session_Management_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Session Management
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Software_Supply_Chain_Security_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Software Supply Chain Security
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Symfony_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Symfony
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="TLS_Cipher_String_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    TLS Cipher String
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Third_Party_Javascript_Management_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Third Party Javascript Management
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Threat_Modeling_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Threat Modeling
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Transaction_Authorization_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Transaction Authorization
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Transport_Layer_Protection_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Transport Layer Protection
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Transport_Layer_Security_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Transport Layer Security
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Unvalidated_Redirects_and_Forwards_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Unvalidated Redirects and Forwards
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="User_Privacy_Protection_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    User Privacy Protection
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Virtual_Patching_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Virtual Patching
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Vulnerability_Disclosure_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Vulnerability Disclosure
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Vulnerable_Dependency_Management_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Vulnerable Dependency Management
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Web_Service_Security_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Web Service Security
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="XML_External_Entity_Prevention_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    XML External Entity Prevention
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="XML_Security_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    XML Security
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="XSS_Filter_Evasion_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    XSS Filter Evasion
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="XS_Leaks_Cheat_Sheet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    XS Leaks
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    <span class="md-ellipsis">
      Introduction
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#wisdom" class="md-nav__link">
    <span class="md-ellipsis">
      Wisdom
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Configuration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#build-configurations" class="md-nav__link">
    <span class="md-ellipsis">
      Build Configurations
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Build Configurations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#debug-builds" class="md-nav__link">
    <span class="md-ellipsis">
      Debug Builds
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#release-builds" class="md-nav__link">
    <span class="md-ellipsis">
      Release Builds
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test-builds" class="md-nav__link">
    <span class="md-ellipsis">
      Test Builds
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#autotools" class="md-nav__link">
    <span class="md-ellipsis">
      Autotools
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#makefiles" class="md-nav__link">
    <span class="md-ellipsis">
      Makefiles
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#integration" class="md-nav__link">
    <span class="md-ellipsis">
      Integration
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#preprocessor" class="md-nav__link">
    <span class="md-ellipsis">
      Preprocessor
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Preprocessor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#configurations" class="md-nav__link">
    <span class="md-ellipsis">
      Configurations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#assert" class="md-nav__link">
    <span class="md-ellipsis">
      ASSERT
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#additional-macros" class="md-nav__link">
    <span class="md-ellipsis">
      Additional Macros
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#compiler-and-linker" class="md-nav__link">
    <span class="md-ellipsis">
      Compiler and Linker
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Compiler and Linker">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#distribution-hardening" class="md-nav__link">
    <span class="md-ellipsis">
      Distribution Hardening
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gccbinutils" class="md-nav__link">
    <span class="md-ellipsis">
      GCC/Binutils
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clangxcode" class="md-nav__link">
    <span class="md-ellipsis">
      Clang/Xcode
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#visual-studio" class="md-nav__link">
    <span class="md-ellipsis">
      Visual Studio
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#warning-suppression" class="md-nav__link">
    <span class="md-ellipsis">
      Warning Suppression
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#runtime" class="md-nav__link">
    <span class="md-ellipsis">
      Runtime
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Runtime">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#xcode" class="md-nav__link">
    <span class="md-ellipsis">
      Xcode
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Xcode">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#windows" class="md-nav__link">
    <span class="md-ellipsis">
      Windows
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="c-based-toolchain-hardening-cheat-sheet">C-Based Toolchain Hardening Cheat Sheet<a class="headerlink" href="#c-based-toolchain-hardening-cheat-sheet" title="Permanent link">&para;</a></h1>
<h2 id="introduction">Introduction<a class="headerlink" href="#introduction" title="Permanent link">&para;</a></h2>
<p>C-Based Toolchain Hardening is a treatment of project settings that will help you deliver reliable and secure code when using C, C++ and Objective C languages in a number of development environments. This article will examine Microsoft and GCC toolchains for the C, C++ and Objective C languages. It will guide you through the steps you should take to create executables with firmer defensive postures and increased integration with the available platform security. Effectively configuring the toolchain also means your project will enjoy a number of benefits during development, including enhanced warnings and static analysis, and self-debugging code.</p>
<p>There are four areas to be examined when hardening the toolchain: configuration, preprocessor, compiler, and linker. Nearly all areas are overlooked or neglected when setting up a project. The neglect appears to be pandemic, and it applies to nearly all projects including Auto-configured projects, makefile-based, Eclipse-based, Visual Studio-based, and Xcode-based. It's important to address the gaps at configuration and build time because it's difficult to impossible to <a href="https://sourceware.org/ml/binutils/2012-03/msg00309.html">add hardening on a distributed executable after the fact</a> on some platforms.</p>
<p>This is a prescriptive article, and it will not debate semantics or speculate on behavior. Some information, such as the C/C++ committee's motivation and pedigree for <a href="https://groups.google.com/a/isocpp.org/forum/?fromgroups=#!topic/std-discussion/ak8e1mzBhGs"><code>program diagnostics</code>, <code>NDEBUG</code>, <code>assert</code>, and <code>abort()</code></a>, appears to be lost like a tale in the Lord of the Rings. As such, the article will specify semantics (for example, the philosophy of 'debug' and 'release' build configurations), assign behaviors (for example, what an assert should do in 'debug' and 'release' build configurations), and present a position. If you find the posture is too aggressive, then you should back off as required to suit your taste.</p>
<p>A secure toolchain is not a silver bullet. It is one piece of an overall strategy in the engineering process to help ensure success. It will complement existing processes such as static analysis, dynamic analysis, secure coding, negative test suites, and the like. Tools such as Valgrind and Helgrind will still be needed, and a project will still require solid designs and architectures.</p>
<p>The OWASP <a href="https://code.google.com/p/owasp-esapi-cplusplus/source">ESAPI C++</a> project eats its own dog food. Many of the examples you will see in this article come directly from the ESAPI C++ project.</p>
<p>Finally, a Cheat Sheet is available for those who desire a terse treatment of the material. Please visit <a href="C-Based_Toolchain_Hardening_Cheat_Sheet.html">C-Based Toolchain Hardening Cheat Sheet</a> for the abbreviated version.</p>
<h2 id="wisdom">Wisdom<a class="headerlink" href="#wisdom" title="Permanent link">&para;</a></h2>
<p>Code <strong>must</strong> be correct. It <strong>should</strong> be secure. It <strong>can</strong> be efficient.</p>
<p><a href="https://en.wikipedia.org/wiki/Jon_Bentley">Dr. Jon Bentley</a>: <em>"If it doesn't have to be correct, I can make it as fast as you'd like it to be"</em>.</p>
<p><a href="https://en.wikipedia.org/wiki/Gary_McGraw">Dr. Gary McGraw</a>: <em>"Thou shalt not rely solely on security features and functions to build secure software as security is an emergent property of the entire system and thus relies on building and integrating all parts properly"</em>.</p>
<h2 id="configuration">Configuration<a class="headerlink" href="#configuration" title="Permanent link">&para;</a></h2>
<p>Configuration is the first opportunity to configure your project for success. Not only do you have to configure your project to meet reliability and security goals, you must also configure integrated libraries properly. You typically have three choices. First, you can use auto-configuration utilities if on Linux or Unix. Second, you can write a makefile by hand. This is predominant on Linux, macOS, and Unix, but it applies to Windows, as well. Finally, you can use an integrated development environment or IDE.</p>
<h3 id="build-configurations">Build Configurations<a class="headerlink" href="#build-configurations" title="Permanent link">&para;</a></h3>
<p>At this stage in the process, you should concentrate on configuring for two builds: Debug and Release. Debug will be used for development and include full instrumentation. Release will be configured for production. The difference between the two settings is usually <em>optimization level</em> and <em>debug level</em>. A third build configuration is Test, and it's usually a special case of Release.</p>
<p>For debug and release builds, the settings are typically diametrically opposed. Debug configurations have no optimizations and full debug information, while Release builds have optimizations and minimal to moderate debug information. In addition, debug code has full assertions and additional library integration, such as mudflaps and malloc guards such as <code>dmalloc</code>.</p>
<p>The Test configuration is often a Release configuration that makes everything public for testing and builds a test harness. For example, all member functions that are public (C++ class) and all interfaces (library or shared object) should be made available for testing. Many Object Oriented purists oppose testing private interfaces, but this is not about object oriented-ness. This (<em>q.v.</em>) is about building reliable and secure software.</p>
<p><a href="https://gcc.gnu.org/gcc-4.8/changes.html">GCC 4.8</a> introduced an optimization of <code>-Og</code>. Note that it is only an optimization, and still requires a customary debug level via <code>-g</code>.</p>
<h4 id="debug-builds">Debug Builds<a class="headerlink" href="#debug-builds" title="Permanent link">&para;</a></h4>
<p>Debug builds are where developers spend most of their time when vetting problems, so this build should concentrate forces and tools or be a 'force multiplier'. Though many do not realize, debug code is more highly valued than release code because it's adorned with additional instrumentation. The debug instrumentation will cause a program to become nearly "self-debugging", and help you catch mistakes such as bad parameters, failed API calls, and memory problems.</p>
<p>Self-debugging code reduces your time during troubleshooting and debugging. Reducing time under the debugger means you have more time for development and feature requests. If code is checked in without debug instrumentation, it should be fixed by adding instrumentation or rejected.</p>
<p>For GCC, optimizations and debug symbolication are controlled through two switches: <code>-O</code> and <code>-g</code>. You should use the following as part of your <code>CFLAGS</code> and <code>CXXFLAGS</code> for a minimal debug session:</p>
<div class="highlight"><pre><span></span><code>-O0 -g3 -ggdb
</code></pre></div>
<p><code>-O0</code> turns off optimizations and <code>-g3</code> ensures maximum debug information is available. You may need to use <code>-O1</code> so some analysis is performed. Otherwise, your debug build will be missing a number of warnings not present in release builds. <code>-g3</code> ensures maximum debugging information is available for the debug session, including symbolic constants and <code>#defines</code>. <code>-ggdb</code> includes extensions to help with a debug session under GDB. For completeness, Jan Krachtovil stated <code>-ggdb</code> currently has no effect in a private email.</p>
<p>Release builds should also consider the configuration pair of <code>-mfunction-return=thunk</code> and <code>-mindirect-branch=thunk</code>. These are the "Reptoline" fix which is an indirect branch used to thwart speculative execution CPU vulnerabilities such as Spectre and Meltdown. The CPU cannot tell what code to <code>speculatively</code> execute because it is an indirect (as opposed to a direct) branch. This is an extra layer of indirection, like calling a pointer through a pointer.</p>
<p>Debug build should also define <code>DEBUG</code>, and ensure <code>NDEBUG</code> is not defined. <code>NDEBUG</code> removes "program diagnostics" and has undesirable behavior and side effects which are discussed below in more detail. The defines should be present for all code, and not just the program. You use it for all code (your program and included libraries) because you need to know how they fail, too (remember, you take the bug report - not the third party library).</p>
<p>In addition, you should use other relevant flags, such as <code>-fno-omit-frame-pointer</code>. Ensuring a frame pointer exists makes it easier to decode stack traces. Since debug builds are not shipped, it's OK to leave symbols in the executable. Programs with debug information do not suffer performance hits. See, for example, <a href="https://gcc.gnu.org/ml/gcc-help/2005-03/msg00032.html">How does the gcc -g option affect performance?</a></p>
<p>Finally, you should ensure your project includes additional diagnostic libraries, such as <code>dmalloc</code> and <a href="https://github.com/google/sanitizers/tree/master/hwaddress-sanitizer">Address Sanitizer</a>. A comparison of some memory checking tools can be found at <a href="https://github.com/google/sanitizers/wiki/AddressSanitizerComparisonOfMemoryTools">Comparison Of Memory Tools</a>. If you don't include additional diagnostics in debug builds, then you should start using them since it's OK to find errors you are not looking for.</p>
<h4 id="release-builds">Release Builds<a class="headerlink" href="#release-builds" title="Permanent link">&para;</a></h4>
<p>Release builds are what your customer receives. They are meant to be run on production hardware and servers, and they should be reliable, secure, and efficient. A stable release build is the product of the hard work and effort during development.</p>
<p>For release builds, you should use the following as part of <code>CFLAGS</code> and <code>CXXFLAGS</code> for release builds:</p>
<div class="highlight"><pre><span></span><code>-On -g2
</code></pre></div>
<p><code>-O</code><em><code>n</code></em> sets optimizations for speed or size (for example, <code>-Os</code> or <code>-O2</code>), and <code>-g2</code> ensure debugging information is created.</p>
<p>Debugging information should be stripped and retained in case of symbolication for a crash report from the field. While not desired, debug information can be left in place without a performance penalty. See <em><a href="https://gcc.gnu.org/ml/gcc-help/2005-03/msg00032.html">How does the gcc -g option affect performance?</a></em> for details.</p>
<p>Release builds should also define <code>NDEBUG</code>, and ensure <code>DEBUG</code> is not defined. The time for debugging and diagnostics is over, so users get production code with full optimizations, no "programming diagnostics", and other efficiencies. If you can't optimize or you are performing excessive logging, it usually means the program is not ready for production.</p>
<p>If you have been relying on an <code>assert</code> and then a subsequent <code>abort()</code>, you have been abusing "program diagnostics" since it has no place in production code. If you want a memory dump, create one so users don't have to worry about secrets and other sensitive information being written to the filesystem and emailed in plain text.</p>
<p>For Windows, you would use <code>/Od</code> for debug builds and <code>/Ox</code>, <code>/O2</code> or <code>/Os</code> for release builds. See Microsoft's <a href="https://docs.microsoft.com/en-us/cpp/build/reference/o-options-optimize-code">/O Options (Optimize Code)</a> for details.</p>
<h4 id="test-builds">Test Builds<a class="headerlink" href="#test-builds" title="Permanent link">&para;</a></h4>
<p>Test builds are used to provide heuristic validation by way of positive and negative test suites. Under a test configuration, all interfaces are tested to ensure they perform to specification and satisfaction. "Satisfaction" is subjective, but it should include no crashing and no trashing of your memory arena, even when faced with negative tests.</p>
<p>Because all interfaces are tested (and not just the public ones), your <code>CFLAGS</code> and <code>CXXFLAGS</code> should include:</p>
<div class="highlight"><pre><span></span><code>-Dprotected=public -Dprivate=public
</code></pre></div>
<p>You should also change <code>__attribute__</code> <code>((visibility</code> <code>("hidden")))</code> to <code>__attribute__</code> <code>((visibility</code> <code>("default")))</code>.</p>
<p>Nearly everyone gets a positive test right, so no more needs to be said. The negative self tests are much more interesting, and you should concentrate on trying to make your program fail so you can verify it fails gracefully. Remember, a bad actor is not going to be courteous when they attempt to cause your program to fail, and it's your project that takes egg on the face by way of a bug report or guest appearance on <a href="https://nmap.org/mailman/listinfo/fulldisclosure">Full Disclosure</a> or <a href="https://www.securityfocus.com/archive">Bugtraq</a> - not <code>&lt;some library&gt;</code> you included.</p>
<h3 id="autotools">Autotools<a class="headerlink" href="#autotools" title="Permanent link">&para;</a></h3>
<p>Auto configuration tools are popular on many Linux and Unix based systems, and the tools include <em>Autoconf</em>, <em>Automake</em>, <em>config</em>, and <em>Configure</em>. The tools work together to produce project files from scripts and template files. After the process completes, your project should be set up and ready to be made with <code>make</code>.</p>
<p>When using auto configuration tools, there are a few files of interest worth mentioning. The files are part of the Autotools chain and include <code>m4</code> and the various <code>*.in</code>, <code>*.ac</code> (Autoconf), and <code>*.am</code> (Automake) files. At times, you will have to open them, or the resulting makefiles, to tune the "stock" configuration.</p>
<p>There are three downsides to the command-line configuration tools in the toolchain: (1) they often ignore user requests, (2) they cannot create configurations, and (3) security is often not a goal.</p>
<p>To demonstrate the first issue, configure your project with the following: <code>configure</code> <code>CFLAGS="-Wall</code> <code>-fPIE"</code> <code>CXXFLAGS="-Wall</code> <code>-fPIE"</code> <code>LDFLAGS="-pie"</code>. You will probably find that Autotools ignored your request, which means the command below will not produce expected results. As a workaround, you will have to open an <code>m4</code> script, <code>makefile.in</code> or <code>makefile.am</code>, and fix the configuration.</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>configure<span class="w"> </span><span class="nv">CFLAGS</span><span class="o">=</span><span class="s2">&quot;-Wall -Wextra -Wconversion -fPIE -Wno-unused-parameter</span>
<span class="s2">    -Wformat=2 -Wformat-security -fstack-protector-all -Wstrict-overflow&quot;</span>
<span class="w">    </span><span class="nv">LDFLAGS</span><span class="o">=</span><span class="s2">&quot;-pie -z,noexecstack -z,noexecheap -z,relro -z,now&quot;</span>
</code></pre></div>
<p>For the second point, you will probably be disappointed to learn <a href="https://lists.gnu.org/archive/html/automake/2012-12/msg00019.html">Automake does not support the concept of configurations</a>. It's not entirely Autoconf's or Automake's fault - <em>Make</em> and its inability to detect changes is the underlying problem. Specifically, <em>Make</em> only <a href="https://pubs.opengroup.org/onlinepubs/9699919799/utilities/make.html">checks modification times of prerequisites and targets</a>, and does not check things like <code>CFLAGS</code> and <code>CXXFLAGS</code>. The net effect is you will not receive expected results when you issue <code>make</code> <code>debug</code> and then <code>make</code> <code>test</code> or <code>make</code> <code>release</code>.</p>
<p>Finally, you will probably be disappointed to learn tools such as Autoconf and Automake miss many security related opportunities and ship insecure out of the box. There are a number of compiler switches and linker flags that improve the defensive posture of a program, but they are not 'on' by default. Tools like Autoconf - which are supposed to handle this situation - often provide settings to serve the lowest of all denominators.</p>
<p>A recent discussion on the Automake mailing list illuminates the issue: <em><a href="https://lists.gnu.org/archive/html/autoconf/2012-12/msg00038.html">Enabling compiler warning flags</a></em>. Attempts to improve default configurations were met with resistance and no action was taken. The resistance is often of the form, "<code>&lt;some useful warning&gt; also produces false positives</code>" or "<code>&lt;some obscure platform&gt; does not support &lt;established security feature&gt;</code>". It's noteworthy that David Wheeler, the author of <em><a href="https://dwheeler.com/secure-programs/">Secure Programming for Linux and Unix HOWTO</a></em>, was one of the folks trying to improve the posture.</p>
<h3 id="makefiles">Makefiles<a class="headerlink" href="#makefiles" title="Permanent link">&para;</a></h3>
<p>Make is one of the earliest build tools dating back to the 1970s. It's available on Linux, macOS and Unix, so you will frequently encounter projects using it. Unfortunately, Make has a number of shortcomings (<em><a href="https://embeddedartistry.com/blog/2017/04/10/recursive-make-considered-harmful/">Recursive Make Considered Harmful</a></em> and <em><a href="https://www.conifersystems.com/whitepapers/gnu-make/">What's Wrong With GNU make?</a></em>), and can cause some discomfort. Despite issues with Make, ESAPI C++ uses Make primarily for three reasons: first, it's omnipresent; second, it's easier to manage than the Autotools family; and third, <code>libtool</code> was out of the question.</p>
<p>Consider what happens when you: (1) type <code>make</code> <code>debug</code>, and then type <code>make</code> <code>release</code>. Each build would require different <code>CFLAGS</code> due to optimizations and level of debug support. In your makefile, you would extract the relevant target and set <code>CFLAGS</code> and <code>CXXFLAGS</code> similar to below (taken from <a href="https://code.google.com/archive/p/owasp-esapi-cplusplus/source/default/source">ESAPI C++ makefile</a>):</p>
<div class="highlight"><pre><span></span><code>## makefile
DEBUG_GOALS = $(filter $(MAKECMDGOALS), debug)
ifneq ($(DEBUG_GOALS),)
    WANT_DEBUG := 1
    WANT_TEST := 0
    WANT_RELEASE := 0
endif
…

ifeq ($(WANT_DEBUG),1)
    ESAPI_CFLAGS += -DDEBUG=1 -UNDEBUG -g3 -ggdb -O0
    ESAPI_CXXFLAGS += -DDEBUG=1 -UNDEBUG -g3 -ggdb -O0
endif

ifeq ($(WANT_RELEASE),1)
    ESAPI_CFLAGS += -DNDEBUG=1 -UDEBUG -g -O2
    ESAPI_CXXFLAGS += -DNDEBUG=1 -UDEBUG -g -O2
endif

ifeq ($(WANT_TEST),1)
    ESAPI_CFLAGS += -DESAPI_NO_ASSERT=1 -g2 -ggdb -O2 -Dprivate=public
                                                      -Dprotected=public
    ESAPI_CXXFLAGS += -DESAPI_NO_ASSERT=1 -g2 -ggdb -O2 -Dprivate=public
                                                        -Dprotected=public
endif
…

## Merge ESAPI flags with user supplied flags. We perform the extra step to ensure
## user options follow our options, which should give user option&#39;s a preference.
override CFLAGS := $(ESAPI_CFLAGS) $(CFLAGS)
override CXXFLAGS := $(ESAPI_CXXFLAGS) $(CXXFLAGS)
override LDFLAGS := $(ESAPI_LDFLAGS) $(LDFLAGS)
…
</code></pre></div>
<p>Make will first build the program in a debug configuration for a session under the debugger using a rule similar to:</p>
<div class="highlight"><pre><span></span><code>%.cpp:%.o:
        $(CXX) $(CPPFLAGS) $(CXXFLAGS) -c $&lt; -o $@
</code></pre></div>
<p>When you want the release build, Make will do nothing because it considers everything up to date despite the fact <code>CFLAGS</code> and <code>CXXFLAGS</code> have changed. Hence, your program will actually be in a debug configuration and risk a <code>SIGABRT</code> at runtime because debug instrumentation is present (recall <code>assert</code> calls <code>abort()</code> when <code>NDEBUG</code> is <strong>not</strong> defined). In essence, you have DoS'd yourself due to <code>make</code>.</p>
<p>In addition, many projects do not honor the user's command-line. ESAPI C++ does its best to ensure a user's flags are honored via <code>override</code> as shown above, but other projects do not. For example, consider a project that should be built with Position Independent Executable (PIE or ASLR) enabled and data execution prevention (DEP) enabled. Dismissing user settings combined with insecure out of the box settings (and not picking them up during auto-setup or auto-configure) means a program built with the following will likely have neither defense:</p>
<div class="highlight"><pre><span></span><code>make<span class="w"> </span><span class="nv">CFLAGS</span><span class="o">=</span><span class="s2">&quot;-fPIE&quot;</span><span class="w"> </span><span class="nv">CXXFLAGS</span><span class="o">=</span><span class="s2">&quot;-fPIE&quot;</span><span class="w"> </span><span class="nv">LDFLAGS</span><span class="o">=</span><span class="s2">&quot;-pie -z,noexecstack, -z,noexecheap&quot;</span>
</code></pre></div>
<p>Defenses such as ASLR and DEP are especially important on Linux because <a href="https://linux.die.net/man/5/elf">Data Execution - not Prevention - is the norm</a>.</p>
<h3 id="integration">Integration<a class="headerlink" href="#integration" title="Permanent link">&para;</a></h3>
<p>Project level integration presents opportunities to harden your program or library with domain specific knowledge. For example, if the platform supports Position Independent Executables (PIE or ASLR) and data execution prevention (DEP), then you should integrate with it. The consequences of not doing so could result in exploitation. As a case in point, see KingCope's 0-days for MySQL in December, 2012 (CVE-2012-5579 and CVE-2012-5612, among others). Integration with platform security would have neutered a number of the 0-days.</p>
<p>You also have the opportunity to include helpful libraries that are not needed for business logic support. For example, if you are working on a platform with <a href="http://dmalloc.com">DMalloc</a> or <a href="https://github.com/google/sanitizers/tree/master/hwaddress-sanitizer">Address Sanitizer</a>, you should probably use it in your debug builds. For Ubuntu, DMalloc is available from the package manager and can be installed with <code>sudo apt install libdmalloc5</code>. For Apple platforms, it's available as a scheme option. Address Sanitizer is available in <a href="https://gcc.gnu.org/gcc-4.8/changes.html">GCC 4.8 and above</a> for many platforms.</p>
<p>In addition, project level integration is an opportunity to harden third party libraries you chose to include. Because you chose to include them, you and your users are responsible for them. If you or your users endure a <code>SP800-53</code> audit, third party libraries will be in scope because the supply chain is included (specifically, item SA-12, Supply Chain Protection). The audits are not limited to those in the US Federal arena - financial institutions perform reviews, too. A perfect example of violating this guidance is <a href="https://nvd.nist.gov/vuln/detail/CVE-2012-1525">CVE-2012-1525</a>, which was due to <a href="https://www.agarri.fr/blog/index.html">Adobe's inclusion of a defective Sablotron library</a>.</p>
<p>Another example is including OpenSSL. You know (1) <a href="https://www.schneier.com/academic/paperfiles/paper-ssl-revised.pdf">SSLv2 is insecure</a>, (2) <a href="https://blog.qualys.com/ssllabs/2014/10/15/ssl-3-is-dead-killed-by-the-poodle-attack">SSLv3 is insecure</a>, and (3) <a href="https://arstechnica.com/security/2012/09/crime-hijacks-https-sessions/">compression is insecure</a> (among others). In addition, suppose you don't use hardware and engines, and only allow static linking. Given the knowledge and specifications, you would configure the OpenSSL library as follows:</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>Configure<span class="w"> </span>darwin64-x86_64-cc<span class="w"> </span>-no-hw<span class="w"> </span>-no-engine<span class="w"> </span>-no-comp<span class="w"> </span>-no-shared
<span class="w">    </span>-no-dso<span class="w"> </span>-no-ssl2<span class="w"> </span>-no-ssl3<span class="w"> </span>--openssldir<span class="o">=</span>…
</code></pre></div>
<p><em>Note Well</em>: you might want engines, especially on Ivy Bridge microarchitectures (3rd generation Intel Core i5 and i7 processors). To have OpenSSL use the processor's random number generator (via the <code>rdrand</code> instruction), you will need to call OpenSSL's <code>ENGINE_load_rdrand()</code> function and then <code>ENGINE_set_default</code> with <code>ENGINE_METHOD_RAND</code>. See <a href="https://wiki.openssl.org/index.php/Random_Numbers">OpenSSL's Random Numbers</a> for details.</p>
<p>If you configure without the switches, then you will likely have vulnerable code/libraries and risk failing an audit. If the program is a remote server, then the following command will reveal if compression is active on the channel:</p>
<div class="highlight"><pre><span></span><code><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;GET / HTTP1.0&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>openssl<span class="w"> </span>s_client<span class="w"> </span>-connect<span class="w"> </span>&lt;nowiki&gt;example.com:443&lt;/nowiki&gt;
</code></pre></div>
<p><code>nm</code> or <code>openssl</code> <code>s_client</code> will show that compression is enabled in the client. In fact, any symbol within the <code>OPENSSL_NO_COMP</code> preprocessor macro will bear witness since <code>-no-comp</code> is translated into a <code>CFLAGS</code> define.</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>nm<span class="w"> </span>/usr/local/ssl/iphoneos/lib/libcrypto.a<span class="w"> </span><span class="m">2</span>&gt;/dev/null<span class="w"> </span><span class="p">|</span><span class="w"> </span>egrep<span class="w"> </span>-i<span class="w"> </span><span class="s2">&quot;(COMP_CTX_new|COMP_CTX_free)&quot;</span>
<span class="m">0000000000000110</span><span class="w"> </span>T<span class="w"> </span>COMP_CTX_free
<span class="m">0000000000000000</span><span class="w"> </span>T<span class="w"> </span>COMP_CTX_new
</code></pre></div>
<p>Even more egregious is the answer given to auditors who specifically ask about configurations and protocols: "we don't use weak/wounded/broken ciphers" or "we follow best practices." The use of compression tells the auditor that you are using wounded protocols in an insecure configuration and you don't follow best practices. That will likely set off alarm bells, and ensure the auditor dives deeper on more items.</p>
<h2 id="preprocessor">Preprocessor<a class="headerlink" href="#preprocessor" title="Permanent link">&para;</a></h2>
<p>The preprocessor is crucial to setting up a project for success. The C committee provided one macro - <code>NDEBUG</code> - and the macro can be used to derive a number of configurations and drive engineering processes. Unfortunately, the committee also left many related items to chance, which has resulted in programmers abusing built-in facilities. This section will help you set up your projects to integrate well with other projects and ensure reliability and security.</p>
<p>There are three topics to discuss when hardening the preprocessor. The first is well defined configurations which produce well-defined behaviors, the second is useful behavior from assert, and the third is proper use of macros when integrating vendor code and third party libraries.</p>
<h3 id="configurations">Configurations<a class="headerlink" href="#configurations" title="Permanent link">&para;</a></h3>
<p>To remove ambiguity, you should recognize two configurations: Release and Debug. Release is for production code on live servers, and its behavior is requested via the C/C++ <code>NDEBUG</code> macro. It's also the only macro observed by the C and C++ Committees and Posix. Diametrically opposed to release is Debug. While there is a compelling argument for <code>!defined(NDEBUG)</code>, you should have an explicit macro for the configuration and that macro should be <code>DEBUG</code>. This is because vendors and outside libraries use the <code>DEBUG</code> (or similar) macro for their configuration. For example, Carnegie Mellon's Mach kernel uses <code>DEBUG</code>, Microsoft's CRT uses <a href="https://www.microsoft.com/en-us/download/details.aspx?id=55979"><code>_DEBUG</code></a>, and Wind River Workbench uses <code>DEBUG_MODE</code>.</p>
<p>In addition to <code>NDEBUG</code> (Release) and <code>DEBUG</code> (Debug), you have two additional cross products: both are defined or neither are defined. Defining both should be an error, and defining neither should default to a release configuration. Below is from <a href="https://code.google.com/archive/p/owasp-esapi-cplusplus/source/default/source">ESAPI C++ EsapiCommon.h</a>, which is the configuration file used by all source files:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// Only one or the other, but not both</span>
<span class="cp">##if (defined(DEBUG) || defined(_DEBUG)) &amp;&amp; (defined(NDEBUG)</span>
<span class="w">                                           </span><span class="o">||</span><span class="w"> </span><span class="n">defined</span><span class="p">(</span><span class="n">_NDEBUG</span><span class="p">))</span>
<span class="cp">## error Both DEBUG and NDEBUG are defined.</span>
<span class="cp">##endif</span>

<span class="c1">// The only time we switch to debug is when asked.</span>
<span class="c1">// NDEBUG or {nothing} results</span>
<span class="c1">// in release build (fewer surprises at runtime).</span>
<span class="cp">##if defined(DEBUG) || defined(_DEBUG)</span>
<span class="cp">## define ESAPI_BUILD_DEBUG 1</span>
<span class="cp">##else</span>
<span class="cp">## define ESAPI_BUILD_RELEASE 1</span>
<span class="cp">##endif</span>
</code></pre></div>
<p>When <code>DEBUG</code> is in effect, your code should receive full debug instrumentation, including the full force of assertions.</p>
<h3 id="assert">ASSERT<a class="headerlink" href="#assert" title="Permanent link">&para;</a></h3>
<p>Asserts will help you create self-debugging code by helping you find the point of first failure quickly and easily. Asserts should be used throughout your program, including parameter validation, return value checking and program state. The <code>assert</code> will silently guard your code through its lifetime. It will always be there, even when not debugging a specific component of a module. If you have thorough code coverage, you will spend less time debugging and more time developing because programs will debug themselves.</p>
<p>To use asserts effectively, you should assert everything. That includes parameters upon entering a function, return values from function calls, and any program state. Everywhere you place an <code>if</code> statement for validation or checking, you should have an assert. Everywhere you have an <code>assert</code> for validation or checking, you should have an <code>if</code> statement. They go hand-in-hand.</p>
<p>If you are still using <code>printf</code>'s, then you have an opportunity for improvement. In the time it takes for you to write a <code>printf</code> or <code>NSLog</code> statement, you could have written an <code>assert</code>. Unlike the <code>printf</code> or <code>NSLog</code> which are often removed when no longer needed, the <code>assert</code> stays active forever. Remember, this is all about finding the point of first failure quickly so you can spend your time doing other things.</p>
<p>There is one problem with using asserts - <a href="https://pubs.opengroup.org/onlinepubs/9699919799/functions/assert.html">Posix states <code>assert</code> should call <code>abort()</code></a> if <code>NDEBUG</code> is <strong>not</strong> defined. When debugging, <code>NDEBUG</code> will never be defined since you want the "program diagnostics" (quote from the Posix description). The behavior makes <code>assert</code> and its accompanying <code>abort()</code> completely useless for development. The result of "program diagnostics" calling <code>abort()</code> due to standard C/C++ behavior is disuse - developers simply don't use them. It's incredibly bad for the development community because self-debugging programs can help eradicate so many stability problems.</p>
<p>Since self-debugging programs are so powerful, you will have to supply your own assert and signal handler with improved behavior. Your assert will exchange auto-aborting behavior for auto-debugging behavior. The auto-debugging facility will ensure the debugger snaps when a problem is detected, and you will find the point of first failure quickly and easily.</p>
<p>ESAPI C++ supplies its own assert with the behavior described above. In the code below, <code>ASSERT</code> raises <code>SIGTRAP</code> when in effect or it evaluates to <code>void</code> in other cases.</p>
<div class="highlight"><pre><span></span><code><span class="c1">// A debug assert which should be sprinkled liberally.</span>
<span class="c1">// This assert fires and then continues rather</span>
<span class="c1">// than calling abort(). Useful when examining negative</span>
<span class="c1">// test cases from the command-line.</span>
<span class="cp">##if (defined(ESAPI_BUILD_DEBUG) &amp;&amp; defined(ESAPI_OS_STARNIX))</span>
<span class="cp">##  define ESAPI_ASSERT1(exp) {                                    \</span>
<span class="cp">    if(!(exp)) {                                                  \</span>
<span class="cp">        std::ostringstream oss;                                     \</span>
<span class="cp">        oss &lt;&lt; &quot;Assertion failed: &quot; &lt;&lt; (char*)(__FILE__) &lt;&lt; &quot;(&quot;     \</span>
<span class="cp">            &lt;&lt; (int)__LINE__ &lt;&lt; &quot;): &quot; &lt;&lt; (char*)(__func__)          \</span>
<span class="cp">            &lt;&lt; std::endl;                                           \</span>
<span class="cp">        std::cerr &lt;&lt; oss.str();                                     \</span>
<span class="cp">        raise(SIGTRAP);                                             \</span>
<span class="cp">    }                                                             \</span>
<span class="cp">    }</span>
<span class="cp">##  define ESAPI_ASSERT2(exp, msg) {                               \</span>
<span class="cp">    if(!(exp)) {                                                  \</span>
<span class="cp">        std::ostringstream oss;                                     \</span>
<span class="cp">        oss &lt;&lt; &quot;Assertion failed: &quot; &lt;&lt; (char*)(__FILE__) &lt;&lt; &quot;(&quot;     \</span>
<span class="cp">            &lt;&lt; (int)__LINE__ &lt;&lt; &quot;): &quot; &lt;&lt; (char*)(__func__)          \</span>
<span class="cp">            &lt;&lt; &quot;: \&quot;&quot; &lt;&lt; (msg) &lt;&lt; &quot;\&quot;&quot; &lt;&lt; std::endl;                \</span>
<span class="cp">        std::cerr &lt;&lt; oss.str();                                     \</span>
<span class="cp">        raise(SIGTRAP);                                             \</span>
<span class="cp">    }                                                             \</span>
<span class="cp">    }</span>
<span class="cp">##elif (defined(ESAPI_BUILD_DEBUG) &amp;&amp; defined(ESAPI_OS_WINDOWS))</span>
<span class="cp">##  define ESAPI_ASSERT1(exp)      assert(exp)</span>
<span class="cp">##  define ESAPI_ASSERT2(exp, msg) assert(exp)</span>
<span class="cp">##else</span>
<span class="cp">##  define ESAPI_ASSERT1(exp)      ((void)(exp))</span>
<span class="cp">##  define ESAPI_ASSERT2(exp, msg) ((void)(exp))</span>
<span class="cp">##endif</span>

<span class="cp">##if !defined(ASSERT)</span>
<span class="cp">##  define ASSERT(exp)     ESAPI_ASSERT1(exp)</span>
<span class="cp">##endif</span>
</code></pre></div>
<p>At program startup, a <code>SIGTRAP</code> handler will be installed if one is not provided by another component:</p>
<div class="highlight"><pre><span></span><code><span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">DebugTrapHandler</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="n">DebugTrapHandler</span><span class="p">()</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="k">struct</span><span class="w"> </span><span class="nc">sigaction</span><span class="w"> </span><span class="n">new_handler</span><span class="p">,</span><span class="w"> </span><span class="n">old_handler</span><span class="p">;</span>

<span class="w">        </span><span class="k">do</span>
<span class="w">          </span><span class="p">{</span>
<span class="w">            </span><span class="kt">int</span><span class="w"> </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>

<span class="w">            </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sigaction</span><span class="w"> </span><span class="p">(</span><span class="n">SIGTRAP</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">old_handler</span><span class="p">);</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ret</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">break</span><span class="p">;</span><span class="w"> </span><span class="c1">// Failed</span>

<span class="w">            </span><span class="c1">// Don&#39;t step on another&#39;s handler</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">old_handler</span><span class="p">.</span><span class="n">sa_handler</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"> </span><span class="k">break</span><span class="p">;</span>

<span class="w">            </span><span class="n">new_handler</span><span class="p">.</span><span class="n">sa_handler</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">DebugTrapHandler</span><span class="o">::</span><span class="n">NullHandler</span><span class="p">;</span>
<span class="w">            </span><span class="n">new_handler</span><span class="p">.</span><span class="n">sa_flags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>

<span class="w">            </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sigemptyset</span><span class="w"> </span><span class="p">(</span><span class="o">&amp;</span><span class="n">new_handler</span><span class="p">.</span><span class="n">sa_mask</span><span class="p">);</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ret</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">break</span><span class="p">;</span><span class="w"> </span><span class="c1">// Failed</span>

<span class="w">            </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sigaction</span><span class="w"> </span><span class="p">(</span><span class="n">SIGTRAP</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">new_handler</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ret</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">break</span><span class="p">;</span><span class="w"> </span><span class="c1">// Failed</span>

<span class="w">          </span><span class="p">}</span><span class="w"> </span><span class="k">while</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>

<span class="w">      </span><span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">NullHandler</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="cm">/*unused*/</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="p">};</span>

<span class="w">    </span><span class="c1">// We specify a relatively low priority, to make sure we run before other CTORs</span>
<span class="w">    </span><span class="c1">// http://gcc.gnu.org/onlinedocs/gcc/C_002b_002b-Attributes.html#C_002b_002b-Attributes</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">DebugTrapHandler</span><span class="w"> </span><span class="n">g_dummyHandler</span><span class="w"> </span><span class="n">__attribute__</span><span class="w"> </span><span class="p">((</span><span class="n">init_priority</span><span class="w"> </span><span class="p">(</span><span class="mi">110</span><span class="p">)));</span>
</code></pre></div>
<p>On a Windows platform, you would call <code>_set_invalid_parameter_handler</code> (and possibly <code>set_unexpected</code> or <code>set_terminate</code>) to install a new handler.</p>
<p>Live hosts running production code should always define <code>NDEBUG</code> (i.e., release configuration), which means they do not assert or auto-abort. Auto-abortion is not acceptable behavior, and anyone who asks for the behavior is completely abusing the functionality of "program diagnostics". If a program wants a core dump, then it should create the dump rather than crashing.</p>
<p>For more reading on asserting effectively, please see one of John Robbin's books, such as <em><a href="https://www.amazon.com/dp/0735608865">Debugging Applications</a></em>. John is a legendary bug slayer in Windows circles, and he will show you how to do nearly everything, from debugging a simple program to bug slaying in multithreaded programs.</p>
<h3 id="additional-macros">Additional Macros<a class="headerlink" href="#additional-macros" title="Permanent link">&para;</a></h3>
<p>Additional macros include any macros needed to integrate properly and securely. It includes integrating the program with the platform (for example MFC or Cocoa/CocoaTouch) and libraries (for example, Crypto++ or OpenSSL). It can be a challenge because you have to have proficiency with your platform and all included libraries and frameworks. The list below illustrates the level of detail you will need when integrating.</p>
<p>Though Boost is missing from the list, it appears to lack recommendations, additional debug diagnostics, and a hardening guide. See <em><a href="https://stackoverflow.com/questions/14927033/boost-hardening-guide-preprocessor-macros">BOOST Hardening Guide (Preprocessor Macros)</a></em> for details. In addition, Tim Day points to <em><a href="https://lists.boost.org/Archives/boost/2008/12/145749.php">[boost.build] should we not define _SECURE_SCL=0 by default for all msvc toolsets</a></em> for a recent discussion related to hardening (or lack thereof).</p>
<p>In addition to what you should define, defining some macros and undefining others should trigger a security related defect. For example, <code>-U_FORTIFY_SOURCES</code> on Linux and <code>_CRT_SECURE_NO_WARNINGS=1</code>, <code>_SCL_SECURE_NO_WARNINGS</code>, <code>_ATL_SECURE_NO_WARNINGS</code> or <code>STRSAFE_NO_DEPRECATE</code> on Windows.</p>
<p><img alt="AdditionalPlatformLibraryMacrosTable" src="../assets/C-Based_Toolchain_Hardening_AdditionalPlatformLibraryMacrosTable.png" /></p>
<p>a) Be careful with <code>_GLIBCXX_DEBUG</code> when using pre-compiled libraries such as Boost from a distribution. There are ABI incompatibilities, and the result will likely be a crash. You will have to compile Boost with <code>_GLIBCXX_DEBUG</code> or omit <code>_GLIBCXX_DEBUG</code>.</p>
<p>b) See <a href="https://gcc.gnu.org/onlinedocs/libstdc++/manual/concept_checking.html">Chapter 5, Diagnostics</a> of the libstdc++ manual for details.</p>
<p>c) SQLite secure deletion zeroizes memory on destruction. Define as required, and always define in US Federal since zeroization is required for FIPS 140-2, Level 1.</p>
<p>d) <em>N</em> is 0644 by default, which means everyone has some access.</p>
<p>e) Force temporary tables into memory (no unencrypted data to disk).</p>
<h2 id="compiler-and-linker">Compiler and Linker<a class="headerlink" href="#compiler-and-linker" title="Permanent link">&para;</a></h2>
<p>Compiler writers provide a rich set of warnings from the analysis of code during compilation. Both GCC and Visual Studio have static analysis capabilities to help find mistakes early in the development process. The built-in static analysis capabilities of GCC and Visual Studio are usually sufficient to ensure proper API usage and catch a number of mistakes such as using an uninitialized variable or comparing a negative signed int and a positive unsigned int.</p>
<p>As a concrete example, (and for those not familiar with C/C++ promotion rules), a warning will be issued if a signed integer is promoted to an unsigned integer and then compared because a side effect is <code>-1 &gt; 1</code> after promotion! GCC and Visual Studio will not currently catch, for example, SQL injections and other tainted data usage. For that, you will need a tool designed to perform data flow analysis or taint analysis.</p>
<p>Some in the development community resist static analysis or refute its results. For example, when static analysis warned the Linux kernel's <code>sys_prctl</code> was comparing an unsigned value against less than zero, Jesper Juhl offered a patch to clean up the code. Linus Torvalds howled "No, you don't do this… GCC is crap" (referring to compiling with warnings). For the full discussion, see <em><a href="https://groups.google.com/g/fa.linux.kernel/c/jjk_K4HOemQ/">[PATCH] Don't compare unsigned variable for &lt;0 in sys_prctl()</a></em> from the Linux Kernel mailing list.</p>
<p>The following sections will detail steps for three platforms. First is a typical GNU Linux based distribution offering GCC and Binutils, second is Clang and Xcode, and third is modern Windows platforms.</p>
<h3 id="distribution-hardening">Distribution Hardening<a class="headerlink" href="#distribution-hardening" title="Permanent link">&para;</a></h3>
<p>Before discussing GCC and Binutils, it would be a good time to point out some of the defenses discussed below are already present in a distribution. Unfortunately, it's design by committee, so what is present is usually only a mild variation of what is available (this way, everyone is mildly offended). For those who are purely worried about performance, you might be surprised to learn you have already taken the small performance hint without even knowing.</p>
<p>Linux and BSD distributions often apply some hardening without intervention via <em><a href="https://gcc.gnu.org/onlinedocs/gcc/Spec-Files.html">GCC Spec Files</a></em>. If you are using Debian, Ubuntu, Linux Mint and family, see <em><a href="https://wiki.debian.org/Hardening">Debian Hardening</a></em>. For Red Hat and Fedora systems, see <em><a href="https://lists.fedoraproject.org/pipermail/devel-announce/2011-August/000821.html">New hardened build support (coming) in F16</a></em>. Gentoo users should visit <em><a href="https://wiki.gentoo.org/wiki/Project:Hardened">Hardened Gentoo</a></em>.</p>
<p>You can see the settings being used by a distribution via <code>gcc</code> <code>-dumpspecs</code>. From Linux Mint 12 below, <code>-fstack-protector</code> (but not -fstack-protector-all) is used by default.</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>gcc<span class="w"> </span>-dumpspecs
…
*link_ssp:<span class="w"> </span>%<span class="o">{</span>fstack-protector:<span class="o">}</span>

*ssp_default:<span class="w"> </span>%<span class="o">{</span>!fno-stack-protector:%<span class="o">{</span>!fstack-protector-all:
<span class="w">              </span>%<span class="o">{</span>!ffreestanding:%<span class="o">{</span>!nostdlib:-fstack-protector<span class="o">}}}}</span>
…
</code></pre></div>
<p>The "SSP" above stands for Stack Smashing Protector. SSP is a reimplementation of Hiroaki Etoh's work on IBM Pro Police Stack Detector. See Hiroaki Etoh's patch <em><a href="https://gcc.gnu.org/ml/gcc-patches/2001-06/msg01753.html">gcc stack-smashing protector</a></em> and IBM's <em><a href="https://pdfs.semanticscholar.org/9d92/fa9eaa6ca12888d303deffe8bc392b85c09f.pdf">GCC extension for protecting applications from stack-smashing attacks</a></em> for details.</p>
<h3 id="gccbinutils">GCC/Binutils<a class="headerlink" href="#gccbinutils" title="Permanent link">&para;</a></h3>
<p>GCC (the compiler collection) and Binutils (the assemblers, linkers, and other tools) are separate projects that work together to produce a final executable. Both the compiler and linker offer options to help you write safer and more secure code. The linker will produce code which takes advantage of platform security features offered by the kernel and PaX, such as no-exec stacks and heaps (NX) and Position Independent Executable (PIE).</p>
<p>The table below offers a set of compiler options to build your program. Static analysis warnings help catch mistakes early, while the linker options harden the executable at runtime. In the table below, "GCC" should be loosely taken as "non-ancient distributions." While the GCC team considers 4.2 ancient, you will still encounter it on Apple and BSD platforms due to changes in GPL licensing around 2007. Refer to <em><a href="https://gcc.gnu.org/onlinedocs/gcc/Option-Summary.html">GCC Option Summary</a></em>, <em><a href="https://gcc.gnu.org/onlinedocs/gcc/Warning-Options.html">Options to Request or Suppress Warnings</a></em> and <em><a href="https://sourceware.org/binutils/docs-2.21/ld/Options.html">Binutils (LD) Command Line Options</a></em> for usage details.</p>
<p>Noteworthy of special mention are <code>-fno-strict-overflow</code> and <code>-fwrapv</code>ₐ. The flags ensure the compiler does not remove statements that result in overflow or wrap. If your program only runs correctly using the flags, it is likely violating C/C++ rules on overflow and illegal. If the program is illegal due to overflow or wrap checking, you should consider using <a href="https://code.google.com/archive/p/safe-iop/">safe-iop</a> for C or David LeBlanc's <a href="https://archive.codeplex.com/?p=safeint">SafeInt</a> in C++.</p>
<p>For a project compiled and linked with hardened settings, some of those settings can be verified with the <a href="https://www.trapkit.de/tools/checksec.html">Checksec</a> tool written by Tobias Klein. The <code>checksec.sh</code> script is designed to test standard Linux OS and PaX security features being used by an application. See the <a href="https://www.trapkit.de/tools/checksec.html">Trapkit</a> web page for details.</p>
<p>GCC C Warning Options table:</p>
<p><img alt="GCCCWarningOptionsTable" src="../assets/C-Based_Toolchain_Hardening_GCCCWarningOptionsTable.png" /></p>
<ul>
<li><a href="https://github.com/google/sanitizers">AddressSanitizer</a></li>
<li><a href="https://github.com/google/sanitizers/wiki/ThreadSanitizerCppManual">ThreadSanitizer</a></li>
</ul>
<p>a) Unlike Clang and -Weverything, GCC does not provide a switch to truly enable all warnings.
b) -fstack-protector guards functions with high risk objects such as C strings, while -fstack-protector-all guards all objects.</p>
<p>Additional C++ warnings which can be used include the following in Table 3. See <em><a href="https://gcc.gnu.org/onlinedocs/gcc/C_002b_002b-Dialect-Options.html">GCC's Options Controlling C++ Dialect</a></em> for additional options and details.</p>
<p>GCC C++ Warning Options table:</p>
<p><img alt="GCCCPPWarningOptionsTable" src="../assets/C-Based_Toolchain_Hardening_GCCCPPWarningOptionsTable.png" /></p>
<p><a href="https://www.aristeia.com/books.html">Effective C++, Second Edition book</a>.</p>
<p>And additional Objective C warnings which are often useful include the following. See <em><a href="https://gcc.gnu.org/onlinedocs/gcc-4.6.0/gcc/Objective_002dC-and-Objective_002dC_002b_002b-Dialect-Options.html">Options Controlling Objective-C and Objective-C++ Dialects</a></em> for additional options and details.</p>
<p>GCC Objective C Warning Options table:</p>
<p><img alt="GCCObjectiveCWarningOptionsTable" src="../assets/C-Based_Toolchain_Hardening_GCCObjectiveCWarningOptionsTable.png" /></p>
<p>The use of aggressive warnings will produce spurious noise. The noise is a tradeoff - you can learn of potential problems at the cost of wading through some chaff. The following will help reduce spurious noise from the warning system:</p>
<ul>
<li><code>-Wno-unused-parameter</code> (GCC)</li>
<li><code>-Wno-type-limits</code> (GCC 4.3)</li>
<li><code>-Wno-tautological-compare</code> (Clang)</li>
</ul>
<p>Finally, a simple version based makefile example is shown below. This is different than a feature based makefile produced by Autotools (which will test for a particular feature and then define a symbol or configure a template file). Not all platforms use all options and flags. To address the issue you can pursue one of two strategies. First, you can ship with a weakened posture by servicing the lowest common denominator or, second, you can ship with everything in force. In the latter case, those who don't have a feature available will edit the makefile to accommodate their installation.</p>
<div class="highlight"><pre><span></span><code><span class="nv">CXX</span><span class="o">=</span>g++
<span class="nv">EGREP</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>egrep
…

<span class="nv">GCC_COMPILER</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">$(</span>shell<span class="w"> </span><span class="k">$(</span>CXX<span class="k">)</span><span class="w"> </span>-v<span class="w"> </span><span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="k">$(</span>EGREP<span class="k">)</span><span class="w"> </span>-i<span class="w"> </span>-c<span class="w"> </span><span class="s1">&#39;^gcc version&#39;</span><span class="k">)</span>
<span class="nv">GCC41_OR_LATER</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">$(</span>shell<span class="w"> </span><span class="k">$(</span>CXX<span class="k">)</span><span class="w"> </span>-v<span class="w"> </span><span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="k">$(</span>EGREP<span class="k">)</span><span class="w"> </span>-i<span class="w"> </span>-c<span class="w"> </span><span class="s1">&#39;^gcc version (4\.[1-9]|[5-9])&#39;</span><span class="k">)</span>
…

<span class="nv">GNU_LD210_OR_LATER</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">$(</span>shell<span class="w"> </span><span class="k">$(</span>LD<span class="k">)</span><span class="w"> </span>-v<span class="w"> </span><span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="k">$(</span>EGREP<span class="k">)</span><span class="w"> </span>-i<span class="w"> </span>-c<span class="w"> </span><span class="s1">&#39;^gnu ld .* (2\.1[0-9]|2\.[2-9])&#39;</span><span class="k">)</span>
<span class="nv">GNU_LD214_OR_LATER</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">$(</span>shell<span class="w"> </span><span class="k">$(</span>LD<span class="k">)</span><span class="w"> </span>-v<span class="w"> </span><span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="k">$(</span>EGREP<span class="k">)</span><span class="w"> </span>-i<span class="w"> </span>-c<span class="w"> </span><span class="s1">&#39;^gnu ld .* (2\.1[4-9]|2\.[2-9])&#39;</span><span class="k">)</span>
…

ifeq<span class="w"> </span><span class="o">(</span><span class="k">$(</span>GCC_COMPILER<span class="k">)</span>,1<span class="o">)</span>
<span class="w">    </span><span class="nv">MY_CC_FLAGS</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span>-Wall<span class="w"> </span>-Wextra<span class="w"> </span>-Wconversion
<span class="w">    </span><span class="nv">MY_CC_FLAGS</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span>-Wformat<span class="o">=</span><span class="m">2</span><span class="w"> </span>-Wformat-security
<span class="w">    </span><span class="nv">MY_CC_FLAGS</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span>-Wno-unused-parameter
endif

ifeq<span class="w"> </span><span class="o">(</span><span class="k">$(</span>GCC41_OR_LATER<span class="k">)</span>,1<span class="o">)</span>
<span class="w">    </span><span class="nv">MY_CC_FLAGS</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span>-fstack-protector-all
endif

ifeq<span class="w"> </span><span class="o">(</span><span class="k">$(</span>GCC42_OR_LATER<span class="k">)</span>,1<span class="o">)</span>
<span class="w">    </span><span class="nv">MY_CC_FLAGS</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span>-Wstrict-overflow
endif

ifeq<span class="w"> </span><span class="o">(</span><span class="k">$(</span>GCC43_OR_LATER<span class="k">)</span>,1<span class="o">)</span>
<span class="w">    </span><span class="nv">MY_CC_FLAGS</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span>-Wtrampolines
endif

ifeq<span class="w"> </span><span class="o">(</span><span class="k">$(</span>GNU_LD210_OR_LATER<span class="k">)</span>,1<span class="o">)</span>
<span class="w">    </span><span class="nv">MY_LD_FLAGS</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span>-z,nodlopen<span class="w"> </span>-z,nodump
endif

ifeq<span class="w"> </span><span class="o">(</span><span class="k">$(</span>GNU_LD214_OR_LATER<span class="k">)</span>,1<span class="o">)</span>
<span class="w">    </span><span class="nv">MY_LD_FLAGS</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span>-z,noexecstack<span class="w"> </span>-z,noexecheap
endif

ifeq<span class="w"> </span><span class="o">(</span><span class="k">$(</span>GNU_LD215_OR_LATER<span class="k">)</span>,1<span class="o">)</span>
<span class="w">    </span><span class="nv">MY_LD_FLAGS</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span>-z,relro<span class="w"> </span>-z,now
endif

ifeq<span class="w"> </span><span class="o">(</span><span class="k">$(</span>GNU_LD216_OR_LATER<span class="k">)</span>,1<span class="o">)</span>
<span class="w">    </span><span class="nv">MY_CC_FLAGS</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span>-fPIE
<span class="w">    </span><span class="nv">MY_LD_FLAGS</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span>-pie
endif

<span class="c1">## Use &#39;override&#39; to honor the user&#39;s command line</span>
override<span class="w"> </span>CFLAGS<span class="w"> </span>:<span class="o">=</span><span class="w"> </span><span class="k">$(</span>MY_CC_FLAGS<span class="k">)</span><span class="w"> </span><span class="k">$(</span>CFLAGS<span class="k">)</span>
override<span class="w"> </span>CXXFLAGS<span class="w"> </span>:<span class="o">=</span><span class="w"> </span><span class="k">$(</span>MY_CC_FLAGS<span class="k">)</span><span class="w"> </span><span class="k">$(</span>CXXFLAGS<span class="k">)</span>
override<span class="w"> </span>LDFLAGS<span class="w"> </span>:<span class="o">=</span><span class="w"> </span><span class="k">$(</span>MY_LD_FLAGS<span class="k">)</span><span class="w"> </span><span class="k">$(</span>LDFLAGS<span class="k">)</span>
…
</code></pre></div>
<h3 id="clangxcode">Clang/Xcode<a class="headerlink" href="#clangxcode" title="Permanent link">&para;</a></h3>
<p><a href="https://clang.llvm.org">Clang</a> and <a href="https://llvm.org">LLVM</a> have been aggressively developed since Apple lost its GPL compiler back in 2007 (due to Tivoization which resulted in GPLv3). Since that time, a number of developers and Google have joined the effort. While Clang will consume most (all?) GCC/Binutil flags and switches, the project supports a number of its own options, including a static analyzer. In addition, Clang is relatively easy to build with additional diagnostics, such as Dr. John Regher and Peng Li's <a href="https://embed.cs.utah.edu/ioc/">Integer Overflow Checker (IOC)</a>.</p>
<p>IOC is incredibly useful, and has found bugs in a number of projects, from the Linux Kernel (<code>include/linux/bitops.h</code>, still unfixed), SQLite, PHP, Firefox (many still unfixed), LLVM, and Python. Future versions of Clang (Clang 3.3 and above) will allow you to enable the checks out of the box with <code>-fsanitize=integer</code> and <code>-fsanitize=shift</code>.</p>
<p>Clang options can be found at <a href="https://clang.llvm.org/docs/UsersManual.html">Clang Compiler User's Manual</a>. Clang does include an option to turn on all warnings - <code>-Weverything</code>. Use it with care but use it regularly since you will get back a lot of noise and issues you missed. For example, add <code>-Weverything</code> for production builds and make non-spurious issues a quality gate. Under Xcode, simply add <code>-Weverything</code> to <code>CFLAGS</code> and <code>CXXFLAGS</code>.</p>
<p>In addition to compiler warnings, both static analysis and additional security checks can be performed. Readings on Clang's static analysis capabilities can be found at <a href="https://clang-analyzer.llvm.org">Clang Static Analyzer</a>. Figure 1 below shows some of the security checks utilized by Xcode.</p>
<p><img alt="XCode1" src="../assets/C-Based_Toolchain_Hardening_XCode1.png" /></p>
<h3 id="visual-studio">Visual Studio<a class="headerlink" href="#visual-studio" title="Permanent link">&para;</a></h3>
<p>Visual Studio offers a convenient Integrated Development Environment (IDE) for managing solutions and their settings. The section called "Visual Studio Options" discusses options which should be used with Visual Studio, and the section called "Project Properties" demonstrates incorporating those options into a solution's project.</p>
<p>The table below lists the compiler and linker switches which should be used under Visual Studio. Refer to Howard and LeBlanc's Writing Secure Code (Microsoft Press) for a detailed discussion or <em><a href="https://docs.microsoft.com/en-us/archive/msdn-magazine/2008/march/security-briefs-protecting-your-code-with-visual-c-defenses">Protecting Your Code with Visual C++ Defenses</a></em> in Security Briefs by Michael Howard. In the table below, "Visual Studio" refers to nearly all versions of the development environment, including Visual Studio 5.0 and 6.0.</p>
<p>For a project compiled and linked with hardened settings, those settings can be verified with BinScope. BinScope is a verification tool from Microsoft that analyzes binaries to ensure that they have been built-in compliance with Microsoft's Security Development Lifecycle (SDLC) requirements and recommendations. See the <em><a href="https://www.microsoft.com/en-us/download/details.aspx?id=44995">BinScope Binary Analyzer</a></em> download page for details.</p>
<p><img alt="VStudioWarningOptionsTable" src="../assets/C-Based_Toolchain_Hardening_VStudioWarningOptionsTable.png" /></p>
<p>a) See Jon Sturgeon's discussion of the switch at <em><a href="https://devblogs.microsoft.com/cppblog/off-by-default-compiler-warnings-in-visual-c/">Off By Default Compiler Warnings in Visual C++</a></em>.</p>
<p>a) When using /GS, there are a number of circumstances which affect the inclusion of a security cookie. For example, the guard is not used if there is no buffer in the stack frame, optimizations are disabled, or the function is declared naked or contains inline assembly.</p>
<p>b) <code>#pragma</code> <code>strict_gs_check(on)</code> should be used sparingly, but is recommended in high risk situations, such as when a source file parses input from the internet.</p>
<h3 id="warning-suppression">Warning Suppression<a class="headerlink" href="#warning-suppression" title="Permanent link">&para;</a></h3>
<p>From the tables above, a lot of warnings have been enabled to help detect possible programming mistakes. The potential mistakes are detected via a compiler which carries around a lot of contextual information during its code analysis phase. At times, you will receive spurious warnings because the compiler is not <em>that</em> smart. It's understandable and even a good thing (how would you like to be out of a job because a program writes its own programs?). At times you will have to learn how to work with the compiler's warning system to suppress warnings. Notice what was not said: turn off the warnings.</p>
<p>Suppressing warnings placates the compiler for spurious noise so you can get to the issues that matter (you are separating the wheat from the chaff). This section will offer some hints and point out some potential minefields. First is an unused parameter (for example, <code>argc</code> or <code>argv</code>). Suppressing unused parameter warnings is especially helpful for C++ and interface programming, where parameters are often unused. For this warning, simply define an "UNUSED" macro and warp the parameter:</p>
<div class="highlight"><pre><span></span><code><span class="cp">##define UNUSED_PARAMETER(x) ((void)x)</span>
<span class="err">…</span>

<span class="kt">int</span><span class="w"> </span><span class="n">main</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">argv</span><span class="p">[])</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">UNUSED_PARAMETER</span><span class="p">(</span><span class="n">argc</span><span class="p">);</span>
<span class="w">    </span><span class="n">UNUSED_PARAMETER</span><span class="p">(</span><span class="n">argv</span><span class="p">);</span>
<span class="w">    </span><span class="err">…</span>
<span class="p">}</span>
</code></pre></div>
<p>A potential minefield lies near "comparing unsigned and signed" values, and <code>-Wconversion</code> will catch it for you. This is because C/C++ promotion rules state the signed value will be promoted to an unsigned value and then compared. That means <code>-1</code> <code>&gt;</code> <code>1</code> after promotion! To fix this, you cannot blindly cast - you must first range test the value:</p>
<div class="highlight"><pre><span></span><code><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetX</span><span class="p">();</span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetY</span><span class="p">();</span>

<span class="n">ASSERT</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">0</span><span class="p">))</span>
<span class="w">    </span><span class="n">throw</span><span class="w"> </span><span class="n">runtime_error</span><span class="p">(</span><span class="s">&quot;WTF??? X is negative.&quot;</span><span class="p">);</span>

<span class="k">if</span><span class="p">(</span><span class="n">static_cast</span><span class="o">&lt;</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">y</span><span class="p">)</span>
<span class="w">    </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;x is greater than y&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">endl</span><span class="p">;</span>
<span class="k">else</span>
<span class="w">    </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;x is not greater than y&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">endl</span><span class="p">;</span>
</code></pre></div>
<p>Notice the code above will debug itself - you don't need to set a breakpoint to see if there is a problem with <code>x</code>. Just run the program and wait for it to tell you there is a problem. If there is a problem, the program will snap the debugger (and more importantly, not call a useless <code>abort()</code> as specified by Posix). It beats the snot out of <code>printf</code>s that are removed when no longer needed or that pollute outputs.</p>
<p>Another conversion problem you will encounter is conversion between types, and <code>-Wconversion</code> will also catch it for you. The following will always have an opportunity to fail, and should light up like a Christmas tree:</p>
<div class="highlight"><pre><span></span><code><span class="k">struct</span><span class="w"> </span><span class="nc">sockaddr_in</span><span class="w"> </span><span class="n">addr</span><span class="p">;</span>
<span class="err">…</span>

<span class="n">addr</span><span class="p">.</span><span class="n">sin_port</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">htons</span><span class="p">(</span><span class="n">atoi</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]));</span>
</code></pre></div>
<p>The following would probably serve you much better. Notice <code>atoi</code> and friends are not used because they can silently fail. In addition, the code is instrumented so you don't need to waste a lot of time debugging potential problems:</p>
<div class="highlight"><pre><span></span><code><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">cstr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetPortString</span><span class="p">();</span>

<span class="n">ASSERT</span><span class="p">(</span><span class="n">cstr</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>
<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">cstr</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">))</span>
<span class="w">    </span><span class="n">throw</span><span class="w"> </span><span class="n">runtime_error</span><span class="p">(</span><span class="s">&quot;WTF??? Port string is not valid.&quot;</span><span class="p">);</span>

<span class="n">istringstream</span><span class="w"> </span><span class="nf">iss</span><span class="p">(</span><span class="n">cstr</span><span class="p">);</span>
<span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="n">iss</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">t</span><span class="p">;</span>

<span class="n">ASSERT</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">iss</span><span class="p">.</span><span class="n">fail</span><span class="p">()));</span>
<span class="k">if</span><span class="p">(</span><span class="n">iss</span><span class="p">.</span><span class="n">fail</span><span class="p">())</span>
<span class="w">    </span><span class="n">throw</span><span class="w"> </span><span class="n">runtime_error</span><span class="p">(</span><span class="s">&quot;WTF??? Failed to read port.&quot;</span><span class="p">);</span>

<span class="c1">// Should this be a port above the reserved range ([0-1024] on Unix)?</span>
<span class="n">ASSERT</span><span class="p">(</span><span class="n">t</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">t</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">))</span>
<span class="w">    </span><span class="n">throw</span><span class="w"> </span><span class="n">runtime_error</span><span class="p">(</span><span class="s">&quot;WTF??? Port is too small&quot;</span><span class="p">);</span>

<span class="n">ASSERT</span><span class="p">(</span><span class="n">t</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">static_cast</span><span class="o">&lt;</span><span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="o">&gt;</span><span class="p">(</span><span class="n">numeric_limits</span><span class="o">&lt;</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="o">&gt;::</span><span class="n">max</span><span class="p">()));</span>
<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">t</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">static_cast</span><span class="o">&lt;</span><span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="o">&gt;</span><span class="p">(</span><span class="n">numeric_limits</span><span class="o">&lt;</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="o">&gt;::</span><span class="n">max</span><span class="p">())))</span>
<span class="w">    </span><span class="n">throw</span><span class="w"> </span><span class="n">runtime_error</span><span class="p">(</span><span class="s">&quot;WTF??? Port is too large&quot;</span><span class="p">);</span>

<span class="c1">// OK to use port</span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">port</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">static_cast</span><span class="o">&lt;</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="o">&gt;</span><span class="p">(</span><span class="n">t</span><span class="p">);</span>
<span class="err">…</span>
</code></pre></div>
<p>Again, notice the code above will debug itself - you don't need to set a breakpoint to see if there is a problem with <code>port</code>. This code will continue checking conditions, years after being instrumented (assuming to write code to read a config file early in the project). There's no need to remove the <code>ASSERT</code>s as with <code>printf</code> since they are silent guardians.</p>
<p>Another useful suppression trick is to avoid ignoring return values. Not only is it useful to suppress the warning, it's required for correct code. For example, <code>snprint</code> will alert you to truncations through its return value. You should not make them silent truncations by ignoring the warning or casting to <code>void</code>:</p>
<div class="highlight"><pre><span></span><code><span class="kt">char</span><span class="w"> </span><span class="n">path</span><span class="p">[</span><span class="n">PATH_MAX</span><span class="p">];</span>
<span class="err">…</span>

<span class="kt">int</span><span class="w"> </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">snprintf</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">path</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;%s/%s&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">GetDirectory</span><span class="p">(),</span><span class="w"> </span><span class="n">GetObjectName</span><span class="p">());</span>
<span class="n">ASSERT</span><span class="p">(</span><span class="n">ret</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">-1</span><span class="p">);</span>
<span class="n">ASSERT</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">ret</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">path</span><span class="p">)));</span>

<span class="k">if</span><span class="p">(</span><span class="n">ret</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">-1</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">ret</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>
<span class="w">    </span><span class="n">throw</span><span class="w"> </span><span class="n">runtime_error</span><span class="p">(</span><span class="s">&quot;WTF??? Unable to build full object name&quot;</span><span class="p">);</span>

<span class="c1">// OK to use path</span>
<span class="err">…</span>
</code></pre></div>
<p>The problem is pandemic, and not just boring user-land programs. Projects which offer high integrity code, such as SELinux, suffer silent truncations. The following is from an approved SELinux patch even though a comment was made that it suffered silent truncations in its <code>security_compute_create_name</code> function from <code>compute_create.c</code>.</p>
<div class="highlight"><pre><span></span><code><span class="mi">12</span><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">security_compute_create_raw</span><span class="p">(</span><span class="n">security_context_t</span><span class="w"> </span><span class="n">scon</span><span class="p">,</span>
<span class="mi">13</span><span class="w">                                  </span><span class="n">security_context_t</span><span class="w"> </span><span class="n">tcon</span><span class="p">,</span>
<span class="mi">14</span><span class="w">                                  </span><span class="n">security_class_t</span><span class="w">   </span><span class="n">tclass</span><span class="p">,</span>
<span class="mi">15</span><span class="w">                                  </span><span class="n">security_context_t</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">newcon</span><span class="p">)</span>
<span class="mi">16</span><span class="w">  </span><span class="p">{</span>
<span class="mi">17</span><span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">path</span><span class="p">[</span><span class="n">PATH_MAX</span><span class="p">];</span>
<span class="mi">18</span><span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">buf</span><span class="p">;</span>
<span class="mi">19</span><span class="w">    </span><span class="kt">size_t</span><span class="w"> </span><span class="n">size</span><span class="p">;</span>
<span class="mi">20</span><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">fd</span><span class="p">,</span><span class="w"> </span><span class="n">ret</span><span class="p">;</span>
<span class="mi">21</span>
<span class="mi">22</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">selinux_mnt</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="mi">23</span><span class="w">      </span><span class="n">errno</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ENOENT</span><span class="p">;</span>
<span class="mi">24</span><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<span class="mi">25</span><span class="w">    </span><span class="p">}</span>
<span class="mi">26</span>
<span class="mi">27</span><span class="w">    </span><span class="n">snprintf</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="w"> </span><span class="n">path</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;%s/create&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">selinux_mnt</span><span class="p">);</span>
<span class="mi">28</span><span class="w">    </span><span class="n">fd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="w"> </span><span class="n">O_RDWR</span><span class="p">);</span>
</code></pre></div>
<p>Unlike other examples, the above code will not debug itself, and you will have to set breakpoints and trace calls to determine the point of first failure. (And the code above gambles that the truncated file does not exist or is not under an adversary's control by blindly performing the <code>open</code>).</p>
<h2 id="runtime">Runtime<a class="headerlink" href="#runtime" title="Permanent link">&para;</a></h2>
<p>The previous sections concentrated on setting up your project for success. This section will examine additional hints for running with increased diagnostics and defenses. Not all platforms are created equal - GNU Linux is difficult to impossible to <a href="https://sourceware.org/ml/binutils/2012-03/msg00309.html">add hardening to a program after compiling and static linking</a>, while Windows allows post-build hardening through a download. Remember, the goal is to find the point of first failure quickly so you can improve the reliability and security of the code.</p>
<h3 id="xcode">Xcode<a class="headerlink" href="#xcode" title="Permanent link">&para;</a></h3>
<p>Xcode offers additional <a href="https://developer.apple.com/documentation/code_diagnostics">Code Diagnostics</a> that can help find memory errors and object use problems. Schemes can be managed through <em>Products</em> menu item, <em>Scheme</em> submenu item, and then <em>Edit</em>. From the editor, navigate to the <em>Diagnostics</em> tab. In the figure below, four additional instruments are enabled for the debugging cycle: Scribble guards, Edge guards, Malloc guards, and Zombies.</p>
<p><img alt="XCode2" src="../assets/C-Based_Toolchain_Hardening_XCode2.png" /></p>
<p>There is one caveat with using some of the guards: Apple only provides them for the simulator, and not a device. In the past, the guards were available for both devices and simulators.</p>
<h4 id="windows">Windows<a class="headerlink" href="#windows" title="Permanent link">&para;</a></h4>
<p>Visual Studio offers a number of debugging aids for use during development. The aids are called <a href="https://docs.microsoft.com/en-us/dotnet/framework/debug-trace-profile/diagnosing-errors-with-managed-debugging-assistants">Managed Debugging Assistants (MDAs)</a>. You can find the MDAs on the <em>Debug</em> menu, then <em>Exceptions</em> submenu. MDAs allow you to tune your debugging experience by, for example, filtering exceptions for which the debugger should snap. For more details, see Stephen Toub's <em><a href="https://docs.microsoft.com/en-us/archive/msdn-magazine/2006/may/let-the-clr-find-bugs-for-you-with-managed-debugging-assistants">Let The CLR Find Bugs For You With Managed Debugging Assistants</a></em>.</p>
<p><img alt="Windows1" src="../assets/C-Based_Toolchain_Hardening_Windows1.png" /></p>
<p>Finally, for runtime hardening, Microsoft provides <strong>Windows Defender Exploit Guard</strong> and the <strong>Process Mitigation Management Tool</strong>.<br />
<a href="https://docs.microsoft.com/en-us/windows/security/threat-protection/windows-defender-exploit-guard/exploit-protection">Windows Defender Exploit Guard</a> replaces EMET and offers advanced exploit protection features.  </p>
<p>Additionally, the <a href="https://docs.microsoft.com/en-us/windows/security/threat-protection/windows-defender-exploit-guard/customize-exploit-protection">Process Mitigation Management Tool</a> (<code>ProcessMitigations</code> module) allows administrators to configure exploit mitigation policies via PowerShell and Group Policy.</p>
<p><img alt="Windows2" src="exploit-protection-guard.png" /></p>







  
  






                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      ©Copyright <script>document.write(new Date().getFullYear())</script> - Cheat Sheets Series Team - This work is licensed under <a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International</a>.
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.sections", "navigation.expand"], "search": "../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.83f73b43.min.js"></script>
      
    
  </body>
</html>